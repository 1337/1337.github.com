<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Safety-Critical Python Projects | Brian&#39;s Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Working with large projects is hard. Anyone who has worked on a large-scale Perl project would tell you that such a project is impossible to understand after a while–not because Perl is hard–but becau">
<meta property="og:type" content="article">
<meta property="og:title" content="Safety-Critical Python Projects">
<meta property="og:url" content="https://blog.ohai.ca/2015/Safety-Critical-Python-Projects/index.html">
<meta property="og:site_name" content="Brian's Blog">
<meta property="og:description" content="Working with large projects is hard. Anyone who has worked on a large-scale Perl project would tell you that such a project is impossible to understand after a while–not because Perl is hard–but becau">
<meta property="og:updated_time" content="2017-10-05T15:59:22.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Safety-Critical Python Projects">
<meta name="twitter:description" content="Working with large projects is hard. Anyone who has worked on a large-scale Perl project would tell you that such a project is impossible to understand after a while–not because Perl is hard–but becau">
  
    <link rel="alternative" href="/atom.xml" title="Brian&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.ohai.ca"></form>
	</div>
</header>
    <div id="main">
      <article id="post-Safety-Critical-Python-Projects" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2015/Safety-Critical-Python-Projects/" class="article-date">
  <time datetime="2015-09-19T00:22:51.000Z" itemprop="datePublished">2015-09-18</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      Safety-Critical Python Projects
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Working with large projects is hard. Anyone who has worked on a large-scale Perl project would tell you that such a project is impossible to understand after a while–not because Perl is hard–but because Perl lets you do everything. Ruby, aka PerlImproved, also suffers similarly that the language allows too much to happen. What, then, does it say about large-scale Python projects, especially when a failure can cost your company dozens of dollars?</p>
<p><a href="http://lars-lab.jpl.nasa.gov/" target="_blank" rel="external">Jet Propulsion Laboratory (JPL)</a>, a unit of CalTech, knows all about writing mission-critical software. They have released documents regarding <a href="http://lars-lab.jpl.nasa.gov/JPL_Coding_Standard_C.pdf" target="_blank" rel="external">High-quality C code</a>; and the <a href="http://lars-lab.jpl.nasa.gov/jpl-java-standard.pdf" target="_blank" rel="external">Java coding standard</a>, which sets a high bar in the field. They need to do that because dividing by zero, by mistake, can cost multiple human lives. <a href="http://www.rideco.com/" target="_blank" rel="external">My company project</a>, which also concerns many human lives everyday, has a lot to learn from JPL. Here is what I have learnt.</p>
<h2 id="“Must”-and-“Should”"><a href="#“Must”-and-“Should”" class="headerlink" title="“Must” and “Should”"></a>“Must” and “Should”</h2><p><strong>Must</strong> is just the same as <a href="https://en.wikipedia.org/wiki/MISRA_C#Compliance" target="_blank" rel="external">MISRA’s definition</a> of “shall”, which means a rule must be followed, or the code is to be <a href="https://github.com/munificent/vigil" target="_blank" rel="external"><em>vigilante</em>d</a> and destroyed.</p>
<p><strong>Should</strong>, on the other hand, means that a rule is a recommendation; a competent developer like you should follow it, but it is ultimately up to you (and/or your peers).</p>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>New projects <strong>SHOULD</strong> Python3 if their libraries support it.</p>
<h3 id="Assertions"><a href="#Assertions" class="headerlink" title="Assertions"></a>Assertions</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">The assertion density of the code should average a minimum of two assertions per function. Assertions must always be side effect-free and should be defined as Boolean tests.</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bad!</span></span><br><span class="line"><span class="keyword">assert</span> another_function_returns_true()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Good (better with a message)</span></span><br><span class="line"><span class="keyword">assert</span> value_from_another_function &lt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Because assertions are stripped if python is run with `-O` or `-OO`,</span></span><br><span class="line"><span class="comment"># this is possibly th safest option when it comes to assertions.</span></span><br><span class="line"><span class="comment"># http://stackoverflow.com/questions/944592/best-practice-for-python-assert</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_assert</span><span class="params">(condition, message=<span class="string">''</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> condition:</span><br><span class="line">        <span class="comment"># This is never optimized away</span></span><br><span class="line">        <span class="keyword">raise</span> AssertionError(message)</span><br><span class="line"></span><br><span class="line">_assert(value_from_another_function &lt; <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h3><p>Python is one of the best languages in exception-handling; so good, in fact, that the core developers recommend exceptions for flow control. However, using exceptions does not mean you should be <a href="http://swreflections.blogspot.ca/2012/03/defensive-programming-being-just-enough.html" target="_blank" rel="external">swallowing errors or hiding bugs</a>. In safety-critical defensive programming, where <a href="http://stackoverflow.com/questions/4109218/do-gamma-rays-from-the-sun-really-flip-bits-every-once-in-a-while" target="_blank" rel="external">not even the value of anything can be trusted</a>, all functions and methods must know how to handle an exception bubbling up to it–even the ones caught by child functions.</p>
<h4 id="try"><a href="#try" class="headerlink" title="try"></a><code>try</code></h4><h4 id="except"><a href="#except" class="headerlink" title="except"></a><code>except</code></h4><h4 id="finally"><a href="#finally" class="headerlink" title="finally"></a><code>finally</code></h4><h2 id="Variables-and-types"><a href="#Variables-and-types" class="headerlink" title="Variables and types"></a>Variables and types</h2><h3 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a><a href="http://mpmath.org/" target="_blank" rel="external">Numbers</a></h3><p>Assume nothing about a numeric input.</p>
<p>While most number types can be duct-typed, most of the time at that, you occasionally see this happening:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span><span class="params">()</span>:</span></span><br><span class="line">    x = foo()  <span class="comment"># A number</span></span><br><span class="line">    y = bar()  <span class="comment"># Another number</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x / y</span><br></pre></td></tr></table></figure>
<p>The trouble is, even if you know x and y to are numbers, you can still get</p>
<ul>
<li><code>ZeroDivisionError</code>, if y is zero,</li>
<li>The return being <code>nan</code>, should both x and y be a variant of <code>inf</code>,</li>
<li><code>InvalidOperation</code>, if both x and y are Decimal infinities instead,</li>
<li>Some truncated number, if both x and y are integers,</li>
<li><code>TypeError</code> for dividing a Decimal with a float, and</li>
<li>A whole new can of worms, if x and y can be complex numbers, whose <code>a+bj</code> syntax is actually built into the language.</li>
</ul>
<p>The recommended approach, albeit flawed, is to <em>fail early</em> and do appropriate bounds and type checks, for example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span><span class="params">()</span>:</span></span><br><span class="line">    x = foo()  <span class="comment"># A number</span></span><br><span class="line">    <span class="keyword">assert</span> x &gt; <span class="number">0</span></span><br><span class="line">    y = bar()  <span class="comment"># Another number</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt; y &lt; float(<span class="string">'inf'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x / y</span><br></pre></td></tr></table></figure>
<p>I say this is flawed, because even such assertions can fail if x or y are complex numbers, and your QA department really is that good: <code>TypeError: no ordering relation is defined for complex numbers</code>.</p>
<h3 id="Mutability"><a href="#Mutability" class="headerlink" title="Mutability"></a>Mutability</h3><h4 id="Lists-and-dicts"><a href="#Lists-and-dicts" class="headerlink" title="Lists and dicts"></a>Lists and dicts</h4><p><em>Lists and dicts are mutable.</em> This means, should a dictionary be accepted by a function, and said function has a side effect that mutates such a dict, it is also changed for the function that called it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(dt)</span>:</span></span><br><span class="line">    dt[<span class="string">'bar'</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    my_dict = &#123;&#125;</span><br><span class="line">    bar(my_dict)</span><br><span class="line">    <span class="keyword">return</span> my_dict</span><br><span class="line"></span><br><span class="line">print(foo())  <span class="comment"># &#123;'bar': 1&#125;</span></span><br></pre></td></tr></table></figure>
<p>This makes the state of a given function hard to guarantee.<br><code>tuple</code>s are frozen <code>list</code>s. They also have the benefit of <a href="http://stackoverflow.com/questions/68630/are-tuples-more-efficient-than-lists-in-python" target="_blank" rel="external">needing fewer CPU instructions to create</a>.</p>
<p>Remember, also, that while <code>list()</code> and <code>dict()</code> create copies of their respective types, they are only shallow copies.<br>This is not good enough. Use <a href="https://docs.python.org/2/library/copy.html#copy.deepcopy" target="_blank" rel="external"><code>copy.deepcopy()</code></a> instead, while avoiding lists and dicts entirely, where possible.</p>
<h4 id="Tuples"><a href="#Tuples" class="headerlink" title="Tuples"></a>Tuples</h4><h4 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h4><p>Sets <em>are</em> mutable through the use of <code>.add()</code>, <code>.remove()</code>, and all set operations like <code>+</code>, <code>-</code>, <code>intersect</code>, …<br>While mutability is not a bad thing, strictly speaking, you might occasionally prefer using <a href="https://docs.python.org/2/library/stdtypes.html#frozenset" target="_blank" rel="external"><code>frozenset</code></a> instead, whose immutability also makes it hashable.</p>
<h3 id="is-not-None"><a href="#is-not-None" class="headerlink" title="is not None"></a><code>is not None</code></h3><p><code>if foo is not None</code> literally only checks if <code>foo</code> is not <code>None</code>, which allows it to be anything else that is also falsy, for example, <a href="https://docs.python.org/2.4/lib/truth.html" target="_blank" rel="external"><code>0, &#39;&#39;, False, {}, [], set(), ...</code></a>. If the code expects a truthy value, never use <code>is not None</code>. On the other hand, if the code must handle falcy values as well, but not <code>None</code> for some reason (notable example: a user name of ‘null’), <code>is not None</code> does have valid uses.</p>
<h3 id="Type-hinting"><a href="#Type-hinting" class="headerlink" title="Type hinting"></a>Type hinting</h3><p><a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="external">PEP 484</a> introduced type hinting. Unfortunately, being a type <em>hinting</em> proposal, having these type hints does not make python check the types. To follow through with the philosophy, either use <a href="http://mypy-lang.org/" target="_blank" rel="external"><code>mypy</code></a>, or implement a <a href="/2015/Python-Airlocks">python airlock</a>.</p>
<h3 id="Scoping"><a href="#Scoping" class="headerlink" title="Scoping"></a>Scoping</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">Variables must be declared at the smallest possible level of scope.</a><br>Don’t instantiate variables where it may be accessed normally by another method or function, in case a developer, who does not have in-depth knowledge of the module, modifies its usage as intended.</p>
<h3 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h3><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><blockquote>
<p><a href="http://swreflections.blogspot.ca/2012/03/defensive-programming-being-just-enough.html" target="_blank" rel="external">Protect your code from invalid data coming from “outside”.</a></p>
</blockquote>
<p>For ordinary functions, “outside” is anything that is not contained in the function block. For class and instance methods, “outside” is anything not encapsulated by the same instance/class.</p>
<p>Functions should accept any number<em> of <a href="https://docs.python.org/3/library/stdtypes.html" target="_blank" rel="external">built-in immutables</a>, and return at most one built-in immutable. (</em>as many as flake8 allows; usually fewer than 5)</p>
<p>Functions should have no side effects; <a href="#Lists_and_dicts">this</a> can happen otherwise.</p>
<blockquote>
<p>The original programmer on this system didn’t trust the network, didn’t trust the O/S, didn’t trust Operations, didn’t trust other people’s code, and didn’t trust his own code – for good reason. He was a chemical engineer turned self-taught system programmer who drank a lot while coding late at night (…)</p>
</blockquote>
<p>You might be drunk, your colleagues might be drunk, your wife might be cheating on you. <strong>Do not trust any other part of your project.</strong></p>
<h3 id="parameters-args-kwargs"><a href="#parameters-args-kwargs" class="headerlink" title="(parameters, *args, **kwargs)"></a><code>(parameters, *args, **kwargs)</code></h3><p><strong>Never use star-args.</strong> <a href="https://pypi.python.org/pypi/flake8" target="_blank" rel="external">flake8</a> makes it very clear.<br>Star args allows <a href="http://stackoverflow.com/questions/1788923/parameter-vs-argument" target="_blank" rel="external">arguments</a> to be passed to a function that does nothing with it, and cause a function’s expected parameter(s) to be <code>None</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""Extreme example."""</span></span><br><span class="line">    <span class="keyword">return</span> kwargs.get(<span class="string">'bar'</span>)</span><br><span class="line"></span><br><span class="line">foo(baz=<span class="number">5</span>)   <span class="comment">#  None, because typo</span></span><br></pre></td></tr></table></figure>
<p>Do not attempt to circumvent flake8’s star-arg detection.</p>
<h3 id="Type-hinting-wiith-star-args"><a href="#Type-hinting-wiith-star-args" class="headerlink" title="Type hinting wiith star args"></a>Type hinting wiith star args</h3><p><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=10631" target="_blank" rel="external">Rob Manderson</a> once said: <a href="http://www.codeproject.com/Articles/7904/Defensive-programming" target="_blank" rel="external">let the compiler do the work.</a><br>The problem with that is:</p>
<ul>
<li>He was talking about C++;</li>
<li>We are talking about Python, and we don’t have compilers.</li>
</ul>
<p>Instead, in Python 3.5, we have <a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="external">type hinting</a>, a mechanism that <em>helps</em> verify the types of all arguments passed into a function.</p>
<p>If you do use Python 3.5+, you should:</p>
<ul>
<li>Type-hint all parameters defined by a function,</li>
<li>Type-hint the return types of all values of a function, and</li>
<li>Do appropriate type and bounds checking anyway, because type hinting literally means, <em>hinting</em>.</li>
</ul>
<p>If you must use something below Python 3.5, you should:</p>
<ul>
<li>Write assertions for all parameters defined by a function, and</li>
<li>Write assertions for all return values of a function before they are returned.</li>
</ul>
<p>Again, <a href="http://mypy-lang.org/" target="_blank" rel="external"><code>mypy</code></a> is here to enforce these type hints, wherever you find this appropriate in your project.</p>
<h3 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">Restrict all code to very simple control flow constructs.</a><br>Since recursion may accidentally cause stack overflow, it may not be used.</p>
<h3 id="Pointers-and-callbacks"><a href="#Pointers-and-callbacks" class="headerlink" title="Pointers and callbacks"></a>Pointers and callbacks</h3><p>Python allows a function or method to be referenced, which has its uses, such as</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * x</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maths</span><span class="params">(func, val)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> func(val)</span><br><span class="line"></span><br><span class="line">print(maths(square, <span class="number">2</span>))  <span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
<p>You are writing safety-critical code, however. This allows any arbitrary input to alter the expected operation of the function that accepts a function, and must not be done, unless you are making a <a href="#Decorators">decorator</a> with it.</p>
<h3 id="Return-types"><a href="#Return-types" class="headerlink" title="Return types"></a>Return types</h3><h4 id="Multiple-returns"><a href="#Multiple-returns" class="headerlink" title="Multiple returns"></a>Multiple returns</h4><p>Should a function or method have multiple return statements–which is better than a ‘return value’ variable in the function or method–these return statements must return the same type of value. If one day it makes more sense to return more than one type (e.g. <code>int|None</code>) for some reason, the docstring of the function or method must make it explicitly clear, and the code that uses the return value must have code that handles all expected return types.</p>
<h3 id="Generators"><a href="#Generators" class="headerlink" title="Generators"></a>Generators</h3><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><h3 id="Cyclomatic-complexity"><a href="#Cyclomatic-complexity" class="headerlink" title="Cyclomatic complexity"></a>Cyclomatic complexity</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">Typically, this means no more than about 60 lines of code per function.</a></p>
<h2 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h2><h3 id="Encapsulation"><a href="#Encapsulation" class="headerlink" title="Encapsulation"></a>Encapsulation</h3><h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><h3 id="all"><a href="#all" class="headerlink" title="__all__"></a><code>__all__</code></h3><p>What <code>__all__</code> does is restrict what gets imported when someone does this to you:</p>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> your_project <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<p>But it does not actually restrict imports if they are literally named. So, this works:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># your_project/__init__.py</span></span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'foo'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_bar</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># my.py</span></span><br><span class="line"><span class="keyword">from</span> your_project <span class="keyword">import</span> _bar</span><br></pre></td></tr></table></figure>
<p>This makes <code>__all__</code> useless within the scope of this article. Of course, Python assumes we are all consenting adults, allowing everyone else to reach into our privates (and puns along those lines), but, after several years of experience in software development, you eventually realise this is not pleasant all the time.<br>The solution is to ban <code>import *</code>.</p>
<h3 id="Required-imports"><a href="#Required-imports" class="headerlink" title="Required imports"></a>Required imports</h3><p>Python coder running version &lt; 3.0 may want to have this line above every file:</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> __future__ <span class="keyword">import</span> (absolute_import,</span><br><span class="line">                        division,</span><br><span class="line">                        print_function,</span><br><span class="line">                        )</span><br></pre></td></tr></table></figure>
<h3 id="Multithreading-and-multiprocessing"><a href="#Multithreading-and-multiprocessing" class="headerlink" title="Multithreading and multiprocessing"></a>Multithreading and multiprocessing</h3><blockquote>
<p><a href="http://swreflections.blogspot.ca/2012/03/defensive-programming-being-just-enough.html" target="_blank" rel="external">Make your code thread-safe unless you have a good reason not to (…)</a></p>
</blockquote>
<p><a href="https://gist.github.com/mangecoeur/9540178" target="_blank" rel="external">https://gist.github.com/mangecoeur/9540178</a></p>
<h2 id="PEP-20"><a href="#PEP-20" class="headerlink" title="PEP 20"></a>PEP 20</h2><h3 id="Return-early"><a href="#Return-early" class="headerlink" title="Return early"></a>Return early</h3><h2 id="PEP-8"><a href="#PEP-8" class="headerlink" title="PEP 8"></a>PEP 8</h2><h3 id="Line-length"><a href="#Line-length" class="headerlink" title="Line length"></a>Line length</h3><p>The maximum line length is 79.<br>Some people <a href="http://stackoverflow.com/questions/88942/why-does-python-pep-8-specify-a-maximum-line-length-of-79-characters" target="_blank" rel="external">advocate</a> that the line length limit is insane or useless, and it can be arbitrarily long, so long as readability is maintained. The truth is, if you want your code to remain readable on a computer terminal built in the 1980s, you will have to keep that line length. Some argue that it is okay to break the 79-line rule occasionally, as Beautiful is better than ugly, and Readability counts. Well, the truth is, 79 is 79, and we ought to get too hung up on linters doing their thing. Bearing in mind that docstrings need to be under 72 characters long, all your code should be under 72 characters long; <em>then</em> you can occasionally break the 72-character rule, into the “75 ish” limit, which does not violate PEP 8.</p>
<h3 id="PEP-3105-print-function"><a href="#PEP-3105-print-function" class="headerlink" title="PEP 3105 (print function)"></a>PEP 3105 (print function)</h3><p>The print function completely replaces the print statement. It is therefore toxic to have the pattern <code>print</code> in your code.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_<span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<h2 id="PEP-257"><a href="#PEP-257" class="headerlink" title="PEP 257"></a>PEP 257</h2><h2 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h2><p>Use only libraries that also conform to this same level of standard.</p>
<h3 id="Error-reporting-and-telemetry"><a href="#Error-reporting-and-telemetry" class="headerlink" title="Error reporting and telemetry"></a>Error reporting and telemetry</h3><h3 id="Outdated-libraries"><a href="#Outdated-libraries" class="headerlink" title="Outdated libraries"></a>Outdated libraries</h3><h2 id="Portability"><a href="#Portability" class="headerlink" title="Portability"></a>Portability</h2><h3 id="Language"><a href="#Language" class="headerlink" title="Language"></a>Language</h3><p>All python files must have <code># coding=utf-*</code> defined, where <code>*</code> is commonly 8. See <a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="external">PEP 263</a> for your encoding options.<br>Despite having such a value defined, the files must only contain <a href="http://chortle.ccsu.edu/java5/Notes/chap85%5Cch85_12.html" target="_blank" rel="external">characters whose <code>ord()</code> is between 0 and 255</a>.</p>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>Ensure your code has accurate, comprehensible comments, and is completely documented. Here is <a href="http://thomas-cokelaer.info/tutorials/sphinx/docstring_python.html" target="_blank" rel="external">a meaningful docstring</a>:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def foo(bar):</span><br><span class="line">    <span class="string">""</span><span class="comment">"Foos a bar. If bar is a baz, bazzes.</span></span><br><span class="line"></span><br><span class="line">    :param bar: A valid <span class="keyword">number</span> <span class="keyword">for</span> the <span class="function"><span class="keyword">function</span>.</span></span><br><span class="line">    :<span class="built_in">type</span> bar: <span class="keyword">int</span></span><br><span class="line">    :<span class="keyword">return</span>: Same <span class="keyword">as</span> bar.</span><br><span class="line">    :rtype: <span class="keyword">int</span></span><br><span class="line">    <span class="string">""</span><span class="comment">"</span></span><br><span class="line">    <span class="keyword">return</span> bar</span><br></pre></td></tr></table></figure>
<p>Correct docstrings allow IDEs like PyCharm to check all usages of such a function, if the IDE is so configured. For frequently-used functions, correct docstrings have immense benefit.</p>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><blockquote>
<p>Premature optimization is the root of all evil.</p>
</blockquote>
<p>Performance should be of low priority on your checklist.<br>Remember, safety is always first.</p>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><h2 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h2><h3 id="Static-analysis"><a href="#Static-analysis" class="headerlink" title="Static analysis"></a><a href="http://pixelscommander.com/en/javascript/nasa-coding-standarts-for-javascript-performance/" target="_blank" rel="external">Static analysis</a></h3><blockquote>
<p>All code must be compiled, from the first day of development, with all compiler warnings enabled at the compiler’s most pedantic setting. All code must compile with these setting without any warnings.</p>
</blockquote>
<p>Crank everything up to 11. The tedium in the beginning is worth it.</p>
<h3 id="Gated-reviews"><a href="#Gated-reviews" class="headerlink" title="Gated reviews"></a>Gated reviews</h3><p><a href="http://sqlzen.blogspot.ca/2012/06/code-reviews-must-be-brutally-honest.html" target="_blank" rel="external">Code reviews must be brutally honest.</a></p>
<h3 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h3><h4 id="grep-test"><a href="#grep-test" class="headerlink" title="grep test"></a><a href="http://jamie-wong.com/2013/07/12/grep-test/" target="_blank" rel="external"><code>grep</code> test</a></h4><p>Code that fails <a href="http://jamie-wong.com/2013/07/12/grep-test/" target="_blank" rel="external">the <code>grep</code> test</a> should not be checked in; it probably has design faults that require a higher level code review.</p>
<h4 id="Tests-that-never-run"><a href="#Tests-that-never-run" class="headerlink" title="Tests that never run"></a>Tests that never run</h4><h4 id="Destructive-testing"><a href="#Destructive-testing" class="headerlink" title="Destructive testing"></a><a href="https://en.wikipedia.org/wiki/Software_testing#Destructive_testing" target="_blank" rel="external">Destructive testing</a></h4><p>When a line is removed from your code, and your program still passes all the tests, you are probably missing a test. Some obvious exceptions apply:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># before</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> x</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># after</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> x</span><br></pre></td></tr></table></figure>
<p>In general, it is great practice to have a mutation testing framework installed and challenge your program. <a href="https://pypi.python.org/pypi/MutPy/0.4.0" target="_blank" rel="external">Libraries exist</a>. Do consider the cost-benefit of mutation testing for your specific project, because it may take some time to write tests that ensure a mutation from <code>2 * 2</code> to <code>2 ** 2</code>, and for ranges of values you already check, <code>2 ** 2</code> might never happen to you.</p>
<h3 id="Gated-integration"><a href="#Gated-integration" class="headerlink" title="Gated integration"></a>Gated integration</h3><h3 id="Soaking"><a href="#Soaking" class="headerlink" title="Soaking"></a>Soaking</h3><h3 id="Release"><a href="#Release" class="headerlink" title="Release"></a>Release</h3>
    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/QA/">QA</a></li></ul>

			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
    <a href="/2016/Quick-Chili/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Quick Chili
        
      </div>
    </a>
  
  
    <a href="/2015/The-ideal-person/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          The Ideal Person
        
      </div>
    </a>
  
</nav>

  
</article>




    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.ohai.ca">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2019 Brian<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="../../js/script.js"></script>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    var sc_project=4446854;
    var sc_invisible=0;
    var sc_security="74785e80";
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write(
      "<sc"+"ript type='text/javascript' src='" +
      scJsHost +
      "statcounter.com/counter/counter_xhtml.js'></" +
      "script>"
    );
    //]]>
  </script>
  <noscript>
    <img style="display: none"
         src="http://c.statcounter.com/4446854/0/74785e80/0/" />
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
