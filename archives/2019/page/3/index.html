<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Archives: 2019 | Brian&#39;s Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Meow">
<meta property="og:type" content="website">
<meta property="og:title" content="Brian's Blog">
<meta property="og:url" content="https://blog.ohai.ca/archives/2019/page/3/index.html">
<meta property="og:site_name" content="Brian's Blog">
<meta property="og:description" content="Meow">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brian's Blog">
<meta name="twitter:description" content="Meow">
  
    <link rel="alternative" href="/atom.xml" title="Brian&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../../../css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.ohai.ca"></form>
	</div>
</header>
    <div id="main">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/AWS/">AWS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Access/">Access</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Accessibility/">Accessibility</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Android/">Android</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Apple/">Apple</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Business/">Business</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Career/">Career</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Cars/">Cars</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Firearms/">Firearms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/General/">General</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Health/">Health</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Java/">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/JavaScript/">JavaScript</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Learning/">Learning</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Lifestyle/">Lifestyle</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Linguistics/">Linguistics</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Linux/">Linux</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Machine-Learning/">Machine Learning</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Mathematics/">Mathematics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Meta/">Meta</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Pokemon/">Pokemon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Psychology/">Psychology</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/PyCon/">PyCon</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Python/">Python</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/QA/">QA</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Recipes/">Recipes</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Science/">Science</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Security/">Security</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Software-Development/">Software Development</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Startups/">Startups</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Travel/">Travel</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/Tumblr/">Tumblr</a><span class="tag-list-count">4</span></li></ul>

  
    <article id="post-Late-game-Django-gotchas" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/Late-game-Django-gotchas/" class="article-date">
  <time datetime="2019-07-03T16:01:06.000Z" itemprop="datePublished">2019-07-03</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2019/Late-game-Django-gotchas/">Late game Django gotchas</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>A guy named Kevin (not <a href="https://www.reddit.com/r/StoriesAboutKevin/" target="_blank" rel="external">that kind of Kevin</a>) once told me personal projects rarely reach the technical depth that your work projects do. And he’s right. I’ve been working on a Django project at work for five straight years, and I have never hit these problems in any of my personal projects.</p>
<h2 id="Your-database-is-not-limitless"><a href="#Your-database-is-not-limitless" class="headerlink" title="Your database is not limitless"></a>Your database is not limitless</h2><p><a href="https://www.honeybadger.io/blog/zero-downtime-migrations-of-large-databases-using-rails-postgres-and-redis/" target="_blank" rel="external">Assume every query returns a billion results</a>, because if you don’t, one day it will return a billion results. (In my case, every query returns a billion of what we call “legs”.)</p>
<p>If you don’t…</p>
<h2 id="Your-database-is-your-single-source-of-truth"><a href="#Your-database-is-your-single-source-of-truth" class="headerlink" title="Your database is your single source of truth"></a>Your database is your single source of truth</h2><p>Unless you are one of those forefront hipsters, you are likely going to <em>start</em> your web project as a monolith. But whether your project has a monolith, or a group of microservices that work together, there will always be a single source of truth: one or more databases, plus or minus shards, slaves, mirrors, what have you. (Let me know if it need not be the case.) If you write one bad query, the whole database server falls apart. And <strong>when the database server goes down, so does your service</strong>.</p>
<p>Solution: test your code. And not just unit test; <a href="https://en.wikipedia.org/wiki/Load_testing" target="_blank" rel="external">load test</a> it.</p>
<h2 id="Migrations-can-crash-servers"><a href="#Migrations-can-crash-servers" class="headerlink" title="Migrations can crash servers"></a>Migrations can crash servers</h2><p>(aka making your code handle both schemas)</p>
<p>Suppose you have version 1.0 of your code running <a href="https://en.wikipedia.org/wiki/Cloud_computing" target="_blank" rel="external">in the clouds</a>. 1.0 runs on database schema 1.0.</p>
<p>One day, you decide to write code (what a stupid idea) and publish website 2.0, with schema 2.0.</p>
<p>But you have a thousand concurrent users, and you have to figure out how to deploy your code without downtime. You draft up some ideas.</p>
<ul>
<li><strong>First deploy v2.0, then migrate database to v2.0</strong>: the project is broken from the time you all the v2 code is live, to the time the migration finishes.</li>
<li><strong>First migrate database to v2.0, and then deploy v2.0</strong>: assuming your schema <a href="https://github.com/tbicr/django-pg-zero-downtime-migrations#django-migrations-hacks" target="_blank" rel="external">doesn’t break anything</a>, it might just work. Except…</li>
</ul>
<h2 id="Migrations-are-atomic"><a href="#Migrations-are-atomic" class="headerlink" title="Migrations are atomic"></a>Migrations are atomic</h2><p>Migrations are atomic. This is the safe, intuitive default. If a migration fails, it simply didn’t happen. This is good.</p>
<p>But what if you have 100+ concurrent users, all of which must (for some reason) start a transaction on the table?</p>
<p>As it turns out, schema migrations, which run <a href="https://en.wikipedia.org/wiki/Data_definition_language" target="_blank" rel="external">DDL statements</a>, require an <a href="https://www.postgresql.org/docs/9.4/explicit-locking.html" target="_blank" rel="external"><code>ACCESS SHARE</code> lock or an <code>ACCESS EXCLUSIVE</code> lock</a> (depending on what you run), and if someone else (say, one of your loyal users) is holding a transaction on your table with <a href="https://www.postgresql.org/docs/9.4/explicit-locking.html" target="_blank" rel="external">a conflicting lock</a>, you cannot migrate on that same table.</p>
<pre><code>  File &quot;/root/site-packages/django/db/backends/utils.py&quot;, line 123, in execute
    return self.cursor.execute(sql, params)
psycopg2.extensions.TransactionRollbackError: deadlock detected
DETAIL:  Process 14524 waits for AccessExclusiveLock on relation 20621 of database 16403; blocked by process 12831.
Process 12831 waits for AccessShareLock on relation 20123 of database 16403; blocked by process 14524.
HINT:  See server log for query details.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &quot;manage.py&quot;, line 123, in &lt;module&gt;
    execute_from_command_line(sys.argv)
  File &quot;/root/site-packages/django/core/management/__init__.py&quot;, line 123, in execute_from_command_line
    utility.execute()
  File &quot;/root/site-packages/django/core/management/__init__.py&quot;, line 123, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File &quot;/root/site-packages/django/core/management/base.py&quot;, line 123, in run_from_argv
    self.execute(*args, **cmd_options)
  File &quot;/root/site-packages/django/core/management/base.py&quot;, line 123, in execute
    output = self.handle(*args, **options)
  File &quot;/root/site-packages/django/core/management/commands/migrate.py&quot;, line 123, in handle
    fake_initial=fake_initial,
  File &quot;/root/site-packages/django/db/migrations/executor.py&quot;, line 123, in migrate
    state = self._migrate_all_backwards(plan, full_plan, fake=fake)
  File &quot;/root/site-packages/django/db/migrations/executor.py&quot;, line 123, in _migrate_all_backwards
    self.unapply_migration(states[migration], migration, fake=fake)
  File &quot;/root/site-packages/django/db/migrations/executor.py&quot;, line 123, in unapply_migration
    state = migration.unapply(state, schema_editor)
  File &quot;/root/site-packages/django/db/migrations/migration.py&quot;, line 123, in unapply
    operation.database_backwards(self.app_label, schema_editor, from_state, to_state)
  File &quot;/root/site-packages/django/db/migrations/operations/fields.py&quot;, line 123, in database_backwards
    self.database_forwards(app_label, schema_editor, from_state, to_state)
  File &quot;/root/site-packages/django/db/migrations/operations/fields.py&quot;, line 123, in database_forwards
    schema_editor.alter_field(from_model, from_field, to_field)
  File &quot;/root/site-packages/django/db/backends/base/schema.py&quot;, line 123, in alter_field
    return self._alter_many_to_many(model, old_field, new_field, strict)
  File &quot;/root/site-packages/django/db/backends/base/schema.py&quot;, line 123, in _alter_many_to_many
    new_field.remote_field.through._meta.get_field(new_field.m2m_field_name()),
  File &quot;/root/site-packages/django/db/backends/base/schema.py&quot;, line 123, in alter_field
    old_db_params, new_db_params, strict)
  File &quot;/root/site-packages/django/db/backends/postgresql/schema.py&quot;, line 123, in _alter_field
    new_db_params, strict,
  File &quot;/root/site-packages/django/db/backends/base/schema.py&quot;, line 123, in _alter_field
    self.execute(self._delete_constraint_sql(self.sql_delete_fk, model, fk_name))
  File &quot;/root/site-packages/django/db/backends/base/schema.py&quot;, line 123, in execute
    cursor.execute(sql, params)
  File &quot;/root/site-packages/django/db/backends/utils.py&quot;, line 123, in execute
    return self.cursor.execute(sql, params)
  File &quot;/root/site-packages/django/db/utils.py&quot;, line 123, in __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File &quot;/root/site-packages/django/utils/six.py&quot;, line 123, in reraise
    raise value.with_traceback(tb)
  File &quot;/root/site-packages/django/db/backends/utils.py&quot;, line 123, in execute
    return self.cursor.execute(sql, params)
django.db.utils.OperationalError: deadlock detected
DETAIL:  Process 14524 waits for AccessExclusiveLock on relation 20621 of database 16403; blocked by process 12831.
Process 12831 waits for AccessShareLock on relation 20123 of database 16403; blocked by process 14524.
HINT:  See server log for query details.
</code></pre><p>The conflicting nature of the two operations also means that, should you try to migrate your schema anyway, and successfully obtain that <code>ACCESS SHARE</code> or <code>ACCESS EXCLUSIVE</code> lock it needed, then all of your loyal users will see database errors during the migration, which can take from minutes to hours (again, depending on what you are doing).</p>
<p><strong>Downtime. Not good.</strong></p>
<p>The solution is yet to be found. I hope to post a solution some day.</p>
<h2 id="Migrations-take-a-long-time"><a href="#Migrations-take-a-long-time" class="headerlink" title="Migrations take a long time"></a>Migrations take a long time</h2><p>Unlike your everyday hobby project, big projects have a tendency to live forever. And if you have a project that lives forever, the schema is bound to change. And if your schema changes, you need a migration. And if you add, god forbid, a <code>ForeignKey</code>… it is bound to run five DDL statements.</p>
<pre><code>1. BEGIN;  -- start the transaction
2. ALTER TABLE &quot;foo_bar&quot; ADD COLUMN &quot;baz&quot; ...;  -- adding a column is actually near-instant, so this is no biggie 
3. CREATE INDEX &quot;foo_bar_baz_123456&quot; ON &quot;foo_bar&quot; (&quot;baz&quot;);  -- creating an index... while locking writes (BAD)
4. ALTER TABLE &quot;foo_bar&quot; ADD CONSTRAINT &quot;foo_bar_baz_fk_qux_...&quot; FOREIGN KEY (&quot;baz&quot;) REFERENCES &quot;qux&quot; (&quot;quux&quot;) DEFERRABLE INITIALLY DEFERRED;  -- this makes the column a foriegn key.
5. COMMIT;
</code></pre><p>Guess what, if you have a billion rows in your database, step 3 and 4 going to take <em>forever</em>. And you don’t have forever. You have 5 seconds. So you need to do something else.</p>
<p>Possible solutions to try:</p>
<ul>
<li><strong>Setting <code>db_index=False</code> to omit step 3 from the migration</strong>: I mean, sure, but step 4 (which checks if the existing values are valid) will take just as long.</li>
<li><strong>Creating those fields ahead of time outside the Django framework</strong>: That’s a lot of work Django’s been doing for you for free!</li>
<li><strong><a href="https://docs.djangoproject.com/en/2.2/ref/migration-operations/#separatedatabaseandstate" target="_blank" rel="external"><code>SeparateDatabaseAndState</code></a></strong>: By running any query you want while keeping state automatic, you trick Django into believing it ran the queries it thinks it should. Novel? Yes. Useful? Also yes. But the migrations will take just as long.</li>
<li><strong>Fuck migrations, do your own thing</strong>: Not bad of an idea if you have enough manpower to deal with migrations. By building a tool that replaces django’s built-in migrations, you can definitely achieve zero-downtime, minimal-lock, free-form schema changes. But at what cost?</li>
</ul>
<h2 id="For-a-table-a-3ms-query-really-isn’t-good-enough"><a href="#For-a-table-a-3ms-query-really-isn’t-good-enough" class="headerlink" title="For a table, a 3ms query really isn’t good enough"></a>For a table, a 3ms query really isn’t good enough</h2><p>So say you have a table that has a billion rows, and you have to add a column to the table. It is near-instantaneous.</p>
<p>However, should you need to <em>populate the column with data</em>, it becomes a whole new <del>world</del>estimate.</p>
<p>Say you have a <a href="https://en.wikipedia.org/wiki/Denormalization" target="_blank" rel="external">denormalisation</a> query to run, that reduces joins to speed up queries, but at the expense of storing extraneous information in that extra column; a lookup for each row costs 3ms. What is the cost to update the entire table?</p>
<p>$$<br>0.003s * 1000000000 / 86400 =  35<br>$$</p>
<p>Solution: no solution. Think long and hard about <a href="/2019/Slow-queries-what-to-do/">table partitioning</a>.</p>
<h2 id="Related-names-seemingly-out-of-nowhere"><a href="#Related-names-seemingly-out-of-nowhere" class="headerlink" title="Related names seemingly out of nowhere"></a>Related names seemingly out of nowhere</h2><p>Imagine you have a <code>Model</code> with a <code>ForeignKey</code> that has a related name:</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Foo</span>(<span class="type">Model</span>):</span></span><br><span class="line"><span class="class">    bar = <span class="type">ForeignKey</span>(<span class="type">Bar</span>, <span class="title">related_name</span>='<span class="title">foos'</span>)</span></span><br></pre></td></tr></table></figure>
<p>Then, whenever you have a <code>Bar</code>, you can easily access its <code>foos</code>.</p>
<p>Now imagine you have a hundred or so foreign keys that point back to <code>Foo</code>.</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Foo(Model):</span><br><span class="line">    bar = ForeignKey(Bar, <span class="attribute">related_name</span>=<span class="string">'foos'</span>)</span><br><span class="line">    baz = ForeignKey(Baz, <span class="attribute">related_name</span>=<span class="string">'foos'</span>)</span><br><span class="line">    qux = ForeignKey(Qux, <span class="attribute">related_name</span>=<span class="string">'foos'</span>)</span><br><span class="line">    quux = ForeignKey(Quux, <span class="attribute">related_name</span>=<span class="string">'foos'</span>)</span><br></pre></td></tr></table></figure>
<p>In the code, whenever you see <code>.foos.all()</code>, you can tell for sure that it gives you instances of <code>Foo</code>, right?</p>
<p>But what if you have an <code>app_1.Foo</code> <em>and</em> an <code>app_2.Foo</code>?</p>
<p>Please don’t do that.</p>
<h2 id="Removing-a-field-with-no-downtime-is-a-nightmare"><a href="#Removing-a-field-with-no-downtime-is-a-nightmare" class="headerlink" title="Removing a field with no downtime is a nightmare"></a>Removing a field with no downtime is a nightmare</h2><p>Let’s say you have a model with two fields.</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Foo</span>(<span class="type">Model</span>):</span></span><br><span class="line"><span class="class">    bar = <span class="type">BooleanField</span>()</span></span><br><span class="line"><span class="class">    baz = <span class="type">BooleanField</span>()</span></span><br></pre></td></tr></table></figure>
<p>and you want to remove one of the fields with on downtime. As it turns out, the moment you deploy a (new) change that removes the field, the existing (old) deployment will sense that the field has been removed, and 500 on you until they are scaled down. <em>This is downtime.</em></p>
<p>To remove a field, this field must go through multiple phases of deprecation.</p>
<ol>
<li><strong>Ensure the field is nullable</strong>.</li>
<li><strong>Remove all code that uses the field.</strong> Deploy this change. Now none of your code touches this field.</li>
<li>But wait… Django’s ORM will still go and look for that field whenever it makes a query. You know what makes these queries anyway? The Django admin. You need to do this in two phases. First, <strong>make a <code>SeparateDatabaseAndState</code> migration that only “deletes” the field from the ORM.</strong> Deploy this change. Now none of your code really touches this field.</li>
<li>Then, <strong>make a <code>SeparateDatabaseAndState</code> migration that only deletes the column from the table</strong>, i.e. the second half of the migration above. Now you have no code running that touches the field, and no column in the table.</li>
</ol>
<h2 id="Adding-a-PositiveIntegerField-freezes-migrations"><a href="#Adding-a-PositiveIntegerField-freezes-migrations" class="headerlink" title="Adding a PositiveIntegerField freezes migrations"></a>Adding a <code>PositiveIntegerField</code> freezes migrations</h2><p>Note that <code>PositiveIntegerField</code> does the following:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">"foo_bar"</span> <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">"baz"</span> <span class="built_in">integer</span> <span class="literal">NULL</span> <span class="keyword">CHECK</span> (<span class="string">"baz"</span> &gt;= <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>Even if you had just created that column <code>baz</code>, postgres <a href="https://www.postgresql.org/docs/10/sql-altertable.html" target="_blank" rel="external">will</a>, however stupid it may seem, scan the entire table to make sure the constraint is valid for all your rows.</p>
<p>If you have a billion rows in that table, your deployment will time out and fail.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Python/">Python</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-Why-do-you-make-more-friends-in-high-school" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/Why-do-you-make-more-friends-in-high-school/" class="article-date">
  <time datetime="2019-06-25T16:20:57.000Z" itemprop="datePublished">2019-06-25</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2019/Why-do-you-make-more-friends-in-high-school/">Why do you make more friends in high school?</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p><a href="https://en.wikipedia.org/wiki/Dunbar%27s_number" target="_blank" rel="external">Dunbar’s number</a> proposes that the average person can hold relationships with at most 150 other people, with <a href="https://www.businessinsider.com/friends-limited-number-of-close-relationships-2018-3" target="_blank" rel="external">5 intimate family members, 15 close friends, 50 other kinds of friends, and 150 acquaintances</a> being the most-commonly quoted. So let’s suppose Robin Dunbar said the average person has 50 friends. Which I don’t. (me irl)</p>
<p>With that figure, I propose a “Double Dunbar factor”, <em>Q</em>, where the requirement for making a new friend goes by this equation:</p>
<p>$$<br>\sqrt{Q} = max(\frac{50}{n}, 1)<br>$$</p>
<p>This means, if you were in a group of n=1 person, you are capable of making one friend (assuming your interests align and all that). If you were in a group of n=150 people, you are capable of making at most (Q * 150 = 50) friends.</p>
<p>With that said, just because you are able to make a friend, it does not automatically mean the other person considers you a friend. We need to double the Dunbar:</p>
<p>$$<br>Q = max(\frac{50}{n}, 1) \cdot max(\frac{50}{n}, 1)<br>$$</p>
<p>In a 30-person classroom, the equation reduces to</p>
<p>$$<br>Q = 1<br>$$</p>
<p>Which means you can make at least one friend in that class, and</p>
<p>$$<br>30Q = 30 \cdot 1 = 30<br>$$</p>
<p>However, if you were in a 300-person lecture hall:</p>
<p>$$<br>Q = max(\frac{50}{300}, 1) \cdot max(\frac{50}{300}, 1) = \frac{1}{6} \cdot \frac{1}{6} = \frac{1}{36}<br>$$</p>
<p>Which means, for any given person in that room, your likelihood of being friends with each other is 3%. Multiplying the probability with the number of people in that lecture hall, you get:</p>
<p>$$<br>300Q = \frac{300}{36} = 8.\dot3<br>$$</p>
<p>This means (if everyone in your Arts lecture is social and like each other) you should be able to make 8 friends in your class.</p>
<p>If you believe yourself (and others) to be less social than ideal, you can redo all the calculations with the Dunbar number being 10 (which means you assume people have 10 friends instead of 50).</p>
<p>$$<br>Q = max(\frac{10}{n}, 1) \cdot max(\frac{10}{n}, 1)<br>$$</p>
<p>In realistic terms, if you want to make friends at work (where you have, say, 20 people on your team), you will likely find:</p>
<p>$$<br>\frac{10}{20} \cdot \frac{10}{20} \cdot 20 = 5<br>$$</p>
<p>Five friends. On the other hand, if you have 50 people on your team, you may be surprised to make fewer friends than before.</p>
<p>$$<br>\frac{10}{50} \cdot \frac{10}{50} \cdot 50 = 2<br>$$</p>
<p>People don’t work in fixed teams though, and people definitely don’t work on the same stuff, so… what I am going to say is, if friendship were so easy to explain, I would have made a few more friends by now.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Lifestyle/">Lifestyle</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-Slow-queries-what-to-do" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/Slow-queries-what-to-do/" class="article-date">
  <time datetime="2019-06-19T21:43:49.000Z" itemprop="datePublished">2019-06-19</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2019/Slow-queries-what-to-do/">Slow queries: what to do</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<h1 id="EXPLAIN-ANALYZE"><a href="#EXPLAIN-ANALYZE" class="headerlink" title="EXPLAIN ANALYZE"></a><code>EXPLAIN ANALYZE</code></h1><p>Method: run EXPLAIN ANALYZE and adjust problematic query sections as necessary.</p>
<ul>
<li>Pro: usually the best way to approach a performance issue.</li>
<li>Con: sometimes you can’t rewrite a bad query.</li>
<li>Con: chances are, you have already done it.</li>
</ul>
<h1 id="Tune-the-server"><a href="#Tune-the-server" class="headerlink" title="Tune the server"></a>Tune the server</h1><p>Method: sometimes parameters like <a href="https://www.postgresql.org/docs/9.5/runtime-config-query.html" target="_blank" rel="external"><code>random_page_cost</code> and <code>seq_page_cost</code></a> need tuning. Sometimes <a href="https://www.postgresql.org/docs/9.6/runtime-config-autovacuum.html" target="_blank" rel="external">autovacuum</a> settings are not tuned for the workload on some of your tables.</p>
<p>Also check if anything else (like zombie connections) is lagging your server.</p>
<ul>
<li>Pro: literally free performance boost if you haven’t done it already.</li>
<li>Con: AWS RDS servers come pre-tuned. Most of what you do is mess it up.</li>
</ul>
<h1 id="Add-indexes"><a href="#Add-indexes" class="headerlink" title="Add indexes"></a>Add indexes</h1><p>Method: if there is no index, add one. If there is already an index and it sucks, try adding a special index for all of your columns at once (called “multi-column index”).</p>
<ul>
<li>Pro: unless you lock the table, an index can be added concurrently.</li>
<li>Con: uses more space.</li>
</ul>
<h1 id="Delete-old-data"><a href="#Delete-old-data" class="headerlink" title="Delete old data"></a>Delete old data</h1><p>Method: make a regular task, perhaps in the form of a cron job, delete old, unused objects from the database.</p>
<ul>
<li>Pro: easy to do.</li>
<li>Con: if the table has a lot of foreign keys, deletion may be extremely slow as postgres checks for cascades and foreign key constraints.</li>
<li>Con: old data may still be valuable. For example, Amazon may have a huge transactions table, but it doesn’t mean they can delete old ones.</li>
</ul>
<h1 id="Copy-old-data-from-one-table-to-another"><a href="#Copy-old-data-from-one-table-to-another" class="headerlink" title="Copy old data from one table to another"></a>Copy old data from one table to another</h1><p>Method: run <code>CREATE TABLE ... AS SELECT ... WHERE (data is old);</code></p>
<ul>
<li>Con: tables created this way are not indexed by default.</li>
<li>Con: all the foreign keys will fail.</li>
</ul>
<h1 id="Copy-new-data-from-one-table-to-another"><a href="#Copy-new-data-from-one-table-to-another" class="headerlink" title="Copy new data from one table to another"></a>Copy new data from one table to another</h1><p>Method: run <code>CREATE TABLE ... AS SELECT ... WHERE (data is not old)</code>;</p>
<ul>
<li>Con: tables created this way are not indexed by default.</li>
<li>Con: all the foreign keys will fail.</li>
</ul>
<h1 id="Create-a-“new-data”-view-that-augments-the-actual-table"><a href="#Create-a-“new-data”-view-that-augments-the-actual-table" class="headerlink" title="Create a “new data” view that augments the actual table"></a>Create a “new data” view that augments the actual table</h1><p>Method: run <code>CREATE VIEW ... AS SELECT ... WHERE (data is not old);</code></p>
<ul>
<li>Pro: easy.</li>
<li>Con: there is actually no performance difference.</li>
</ul>
<h1 id="Create-a-“materialized-new-data”-view-that-augments-the-actual-table"><a href="#Create-a-“materialized-new-data”-view-that-augments-the-actual-table" class="headerlink" title="Create a “materialized new data” view that augments the actual table"></a>Create a “materialized new data” view that augments the actual table</h1><p>Method: run <code>CREATE MATERIALIZED VIEW ... AS SELECT ... WHERE (data is not old);</code></p>
<ul>
<li>Con: cannot insert into this view.</li>
<li>Con: this view needs to be manually refreshed, so new data does not appear until we explicitly run a query.</li>
</ul>
<h1 id="Horizontally-partition-the-table-by-age"><a href="#Horizontally-partition-the-table-by-age" class="headerlink" title="Horizontally partition the table by age"></a>Horizontally partition the table by age</h1><p>Data is broken up into partitions that contain rows from different times. When the table is queried by a time range, postgres will know which partition to hit.</p>
<ul>
<li>Pro: likely <em>the ultimate solution</em>.</li>
<li>Con: I don’t know how.</li>
<li>Con: has downtime.</li>
<li>Con: does not save space.</li>
<li>Con: added complexity.</li>
<li>Con: your ORM or data mapper might not support such a thing.</li>
<li>Con: we must limit how far back in time the code can query data.</li>
<li>Con: queries that do not specify a date range (which is the vast majority of them) will actually increase database workload.</li>
</ul>
<h1 id="Vertically-partition-the-table"><a href="#Vertically-partition-the-table" class="headerlink" title="Vertically partition the table"></a>Vertically partition the table</h1><p>Method: split the table into different columns. If only some columns are queried, the performance should be better.</p>
<ul>
<li>Con: any query that gets data from partitioned tables will not gain performance.</li>
</ul>
<h1 id="Horizontally-shard-the-table-into-different-nodes"><a href="#Horizontally-shard-the-table-into-different-nodes" class="headerlink" title="Horizontally shard the table into different nodes"></a>Horizontally shard the table into different nodes</h1><p>Data is stored in different database nodes by age. Pros and cons are similar to the option: Horizontally partition the table by age.</p>
<h1 id="Read-from-read-only-replica-s"><a href="#Read-from-read-only-replica-s" class="headerlink" title="Read from read-only replica(s)"></a>Read from read-only replica(s)</h1><ul>
<li>Con: data is stale, and sometimes it cannot be.</li>
<li>Con: increased operating cost.</li>
<li>Con: read speed is at most as good as the master, and read speed on the master is not good.</li>
</ul>
<h1 id="Denormalise-foreign-keys"><a href="#Denormalise-foreign-keys" class="headerlink" title="Denormalise foreign keys"></a><a href="https://en.wikipedia.org/wiki/Denormalization" target="_blank" rel="external">Denormalise</a> foreign keys</h1><p>In the case of joins, it may be beneficial for a table to have a direct reference to its joined attribute.<br>For example, if there are tons of products, and you frequently need to query by the product’s manufacturer’s CEO’s birthday, it might just be worthwhile to have that birthday in your products table if performance is a concern. (Remember: you have already done <code>EXPLAIN ANALYZE</code>).</p>
<ul>
<li>Pro: almost certainly faster, without even trying.</li>
<li>Con: denormalisation is itself a con.</li>
<li>Con: slower to create objects now.</li>
<li>Con: the initial cost to update the table’s state is very high.</li>
</ul>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/SQL/">SQL</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-Demystifying-the-for-else-loop" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/Demystifying-the-for-else-loop/" class="article-date">
  <time datetime="2019-06-19T18:57:19.000Z" itemprop="datePublished">2019-06-19</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2019/Demystifying-the-for-else-loop/">Demystifying the for-else loop</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>The <code>for-else</code> loop is perhaps <a href="https://stackoverflow.com/questions/9979970/why-does-python-use-else-after-for-and-while-loops" target="_blank" rel="external">the worst-named construct in python</a> (not the worst construct, just the worst-named). Nothing about the word <code>else</code> suggests the semantic meaning, “otherwise”. To see what we should name / should have named it, let’s see what it does and how it behaves.</p>
<p>(All experiments run with python3.)</p>
<h3 id="Looping-through-a-list-else…"><a href="#Looping-through-a-list-else…" class="headerlink" title="Looping through a list, else…?"></a>Looping through a list, else…?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>]:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'ha'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line">ha</span><br></pre></td></tr></table></figure>
<p>We didn’t <code>break</code> inside the loop, so this is normal.</p>
<h3 id="Looping-through-an-empty-list-else…"><a href="#Looping-through-an-empty-list-else…" class="headerlink" title="Looping through an empty list, else…?"></a>Looping through an empty list, else…?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> []:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'ha'</span>)</span><br><span class="line">...</span><br><span class="line">ha</span><br></pre></td></tr></table></figure>
<p>This time, despite the block having never run, the <code>else</code> block still runs. Then again, we didn’t <code>break</code> in that empty loop either, so this is normal.</p>
<h3 id="Looping-through-a-list-break-else…"><a href="#Looping-through-a-list-break-else…" class="headerlink" title="Looping through a list, break, else…?"></a>Looping through a list, break, else…?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>]:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">break</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'ha'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>So it appears <code>break</code>ing is really the only thing that makes the difference. But what if the list is empty?</p>
<h3 id="Looping-through-an-empty-list-break-else…"><a href="#Looping-through-an-empty-list-break-else…" class="headerlink" title="Looping through an empty list, break, else…?"></a>Looping through an empty list, break, else…?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> []:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">break</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'ha'</span>)</span><br><span class="line">...</span><br><span class="line">ha</span><br></pre></td></tr></table></figure>
<p>It gets more and more reassuring that <code>else</code> is run only if a <code>break</code> statement is reached at any point within the for loop.</p>
<h3 id="Looping-through-a-list-trip-an-exception-else…"><a href="#Looping-through-a-list-trip-an-exception-else…" class="headerlink" title="Looping through a list, trip an exception, else…?"></a>Looping through a list, trip an exception, else…?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>]:</span><br><span class="line"><span class="meta">... </span>        print(i)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">raise</span> Exception</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">break</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'ha'</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span>:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'boo'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line">boo</span><br></pre></td></tr></table></figure>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>These experiments show that the only way to trigger an <code>else</code> block is when <strong>the <code>for</code> loop did not reach any <code>break</code> statements</strong>. Therefore, <a href="https://stackoverflow.com/questions/9979970/why-does-python-use-else-after-for-and-while-loops#comment24046796_9979970" target="_blank" rel="external"><code>else</code> should be thought of as <code>if not break</code></a>.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Python/">Python</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-Can-you-seed-a-random-function-with-random" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/Can-you-seed-a-random-function-with-random/" class="article-date">
  <time datetime="2019-06-18T21:10:33.000Z" itemprop="datePublished">2019-06-18</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2019/Can-you-seed-a-random-function-with-random/">Can you seed a random function with `random()`?</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Let’s find out.</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">random</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test_set_size = <span class="number">10000000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func1():</span><br><span class="line">    eh = []</span><br><span class="line">    <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="built_in">range</span>(test_set_size):</span><br><span class="line">        eh.<span class="built_in">append</span>(<span class="built_in">random</span>.randint(<span class="number">0</span>, test_set_size))</span><br><span class="line">    <span class="built_in">return</span> len(set(eh))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func2():</span><br><span class="line">    eh = []</span><br><span class="line">    <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="built_in">range</span>(test_set_size):</span><br><span class="line">        ran = <span class="built_in">random</span>.randint(<span class="number">0</span>, test_set_size)</span><br><span class="line">        eh.<span class="built_in">append</span>(ran)</span><br><span class="line">        <span class="built_in">random</span>.seed(ran)</span><br><span class="line">    <span class="built_in">return</span> len(set(eh))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(func1())  # <span class="number">6321602</span></span><br><span class="line"><span class="built_in">print</span>(func2())  # <span class="number">2696</span></span><br></pre></td></tr></table></figure>
<p>Answer: yes you can, but no, it makes numbers much less random. <strong>Don’t ever do it.</strong></p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Mathematics/">Mathematics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Python/">Python</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="../2/">&laquo; Prev</a><a class="page-number" href="../../">1</a><a class="page-number" href="../2/">2</a><span class="page-number current">3</span><a class="page-number" href="../4/">4</a><a class="page-number" href="../5/">5</a><span class="space">&hellip;</span><a class="page-number" href="../8/">8</a><a class="extend next" rel="next" href="../4/">Next &raquo;</a>
    </nav>
  


    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.ohai.ca">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2020 Brian<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="../../../../js/script.js"></script>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    var sc_project=4446854;
    var sc_invisible=0;
    var sc_security="74785e80";
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write(
      "<sc"+"ript type='text/javascript' src='" +
      scJsHost +
      "statcounter.com/counter/counter_xhtml.js'></" +
      "script>"
    );
    //]]>
  </script>
  <noscript>
    <img style="display: none"
         src="http://c.statcounter.com/4446854/0/74785e80/0/" />
  </noscript><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
