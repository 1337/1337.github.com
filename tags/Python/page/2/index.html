<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Tag: Python | Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Why do you ask my name? It is beyond understanding.">
<meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="http://blog.ohai.ca/tags/Python/page/2/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="Why do you ask my name? It is beyond understanding.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog">
<meta name="twitter:description" content="Why do you ask my name? It is beyond understanding.">
  
    <link rel="alternative" href="/atom.xml" title="Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../../../css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ohai.ca"></form>
	</div>
</header>
    <div id="main">
      
  
    <article id="post-Cheapest-booze-from-LCBO" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Cheapest-booze-from-LCBO/" class="article-date">
  <time datetime="2016-05-13T23:59:41.000Z" itemprop="datePublished">2016-05-13</time>
</a>
		</span>
		<span class="meta-elements author">Author</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Cheapest-booze-from-LCBO/">Cheapest Booze From LCBO</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p><strong>tl;dr</strong>: Buy sherry.</p>
<p>Sure, sure, LCBO rips you off. Sure, sure, dangers of alcohol consumption. But, for the poor and desperate, the quest for the cheapest booze must continue. But what if you are already drunk, and cannot do the maths? This is the post for you.</p>
<h2 id="Sourcing"><a href="#Sourcing" class="headerlink" title="Sourcing"></a>Sourcing</h2><p>Back in 2013, it was possible to search for <code>*</code> on lcbo.com, and have it throw up an entire database worth of data. Data mining was easy. All you needed was a web browser and some script. Such a scraping effort was recorded <a href="https://gist.github.com/1337/6190299/cd04e29988a4ca78f4e682e7f38dece56e310e23" target="_blank" rel="external">in the form of a JSON file</a>.</p>
<p>It was good while it lasted. Today, you can no longer search for <code>*</code> and get something reasonable. You will need <a href="https://lcboapi.com/" target="_blank" rel="external">an API</a> for that.<br>Thankfully, the unofficial LCBO API, for whatever reason, allows me to paginate through their entire database. Here is my sloppy code:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">page = <span class="number">1</span></span><br><span class="line">next_page_path = <span class="string">'/products?per_page=100&amp;page=&#123;&#125;&amp;where_not=is_dead,is_discontinued'</span>.format(page)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    resp = requests.<span class="keyword">get</span>(<span class="string">'https://lcboapi.com&#123;&#125;'</span>.format(next_page_path),</span><br><span class="line">                        headers=&#123;</span><br><span class="line">                            <span class="string">'Authorization'</span>: <span class="string">'Token (get your own token)'</span></span><br><span class="line">                        &#125;)</span><br><span class="line">    <span class="keyword">data</span> = resp.json()</span><br><span class="line">    print(<span class="keyword">data</span>)</span><br><span class="line"></span><br><span class="line">    with <span class="keyword">open</span>(<span class="string">'lcbo-2016.json'</span>, <span class="string">'a+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.writelines(json.dumps(<span class="keyword">data</span>[<span class="string">'result'</span>], indent=<span class="number">4</span>) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">data</span>[<span class="string">'pager'</span>][<span class="string">'next_page_path'</span>]:</span><br><span class="line">        next_page_path = <span class="keyword">data</span>[<span class="string">'pager'</span>][<span class="string">'next_page_path'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>Once you manage to run it, you will end up with a <code>lcbo-2016.json</code>, full of raw entries like this one:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"origin"</span>: <span class="string">"Canada, Ontario"</span>,</span><br><span class="line">    <span class="attr">"is_ocb"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"package_unit_type"</span>: <span class="string">"bottle"</span>,</span><br><span class="line">    <span class="attr">"secondary_category"</span>: <span class="string">"Lager"</span>,</span><br><span class="line">    <span class="attr">"serving_suggestion"</span>: <span class="string">"Party fare"</span>,</span><br><span class="line">    <span class="attr">"updated_at"</span>: <span class="string">"2016-05-13T14:28:22.216Z"</span>,</span><br><span class="line">    <span class="attr">"price_in_cents"</span>: <span class="number">3950</span>,</span><br><span class="line">    <span class="attr">"sugar_content"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"stock_type"</span>: <span class="string">"LCBO"</span>,</span><br><span class="line">    <span class="attr">"inventory_volume_in_milliliters"</span>: <span class="number">613800</span>,</span><br><span class="line">    <span class="attr">"sugar_in_grams_per_liter"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"inventory_count"</span>: <span class="number">75</span>,</span><br><span class="line">    <span class="attr">"producer_name"</span>: <span class="string">"Labatt Breweries Ontario"</span>,</span><br><span class="line">    <span class="attr">"is_vqa"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"primary_category"</span>: <span class="string">"Beer"</span>,</span><br><span class="line">    <span class="attr">"price_per_liter_of_alcohol_in_cents"</span>: <span class="number">965</span>,</span><br><span class="line">    <span class="attr">"style"</span>: <span class="string">"Light &amp; Malty"</span>,</span><br><span class="line">    <span class="attr">"has_bonus_reward_miles"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"is_discontinued"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"is_dead"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"package_unit_volume_in_milliliters"</span>: <span class="number">341</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">914028</span>,</span><br><span class="line">    <span class="attr">"inventory_price_in_cents"</span>: <span class="number">296250</span>,</span><br><span class="line">    <span class="attr">"total_package_units"</span>: <span class="number">24</span>,</span><br><span class="line">    <span class="attr">"volume_in_milliliters"</span>: <span class="number">8184</span>,</span><br><span class="line">    <span class="attr">"limited_time_offer_ends_on"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"product_no"</span>: <span class="number">914028</span>,</span><br><span class="line">    <span class="attr">"value_added_promotion_description"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"image_thumb_url"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"bonus_reward_miles"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tags"</span>: <span class="string">"labatt genuine draft beer lager canada ontario breweries bottle"</span>,</span><br><span class="line">    <span class="attr">"tertiary_category"</span>: <span class="string">"pale lager"</span>,</span><br><span class="line">    <span class="attr">"tasting_note"</span>: <span class="string">"Pale amber; cooked cereal, light hop aroma; light, crisp flavour."</span>,</span><br><span class="line">    <span class="attr">"varietal"</span>: <span class="string">"North American Lager"</span>,</span><br><span class="line">    <span class="attr">"price_per_liter_in_cents"</span>: <span class="number">482</span>,</span><br><span class="line">    <span class="attr">"is_kosher"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"bonus_reward_miles_ends_on"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"clearance_sale_savings_in_cents"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"alcohol_content"</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">"released_on"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"has_clearance_sale"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Labatt Genuine Draft"</span>,</span><br><span class="line">    <span class="attr">"has_value_added_promotion"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"package"</span>: <span class="string">"24x341 mL bottle"</span>,</span><br><span class="line">    <span class="attr">"has_limited_time_offer"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"regular_price_in_cents"</span>: <span class="number">3950</span>,</span><br><span class="line">    <span class="attr">"image_url"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"is_seasonal"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"limited_time_offer_savings_in_cents"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Too much information. No one needs that.</p>
<h2 id="Extraction"><a href="#Extraction" class="headerlink" title="Extraction"></a>Extraction</h2><p>Since you are only interested in the products that are the best bang for the buck, you feed that raw JSON into a filter:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">replacements = []</span><br><span class="line">entries = json.load(open(<span class="symbol">'lcbo</span>-<span class="number">2016</span>.json', <span class="string">'r'</span>))</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">entry</span> <span class="keyword">in</span> entries:</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">entry</span>[<span class="symbol">'regular_price_in_cents</span>']:</span><br><span class="line">            continue</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">entry</span>[<span class="symbol">'volume_in_milliliters</span>']:</span><br><span class="line">            continue</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">entry</span>[<span class="symbol">'alcohol_content</span>']:</span><br><span class="line">            continue</span><br><span class="line">        replacements.append(&#123;</span><br><span class="line">            <span class="symbol">'id</span>': <span class="keyword">entry</span>[<span class="symbol">'id</span>'],</span><br><span class="line">            <span class="symbol">'name</span>': <span class="keyword">entry</span>[<span class="symbol">'name</span>'],</span><br><span class="line">            <span class="symbol">'package</span>': <span class="keyword">entry</span>[<span class="symbol">'package</span>'],</span><br><span class="line">            <span class="symbol">'primary_category</span>': <span class="keyword">entry</span>[<span class="symbol">'primary_category</span>'],</span><br><span class="line">            <span class="symbol">'regular_price</span>': <span class="keyword">entry</span>[<span class="symbol">'regular_price_in_cents</span>'] / <span class="number">100.0</span>,</span><br><span class="line">            <span class="symbol">'alcohol_content</span>': <span class="keyword">entry</span>[<span class="symbol">'alcohol_content</span>'] / <span class="number">100.0</span>,</span><br><span class="line">            <span class="symbol">'volume</span>': <span class="keyword">entry</span>[<span class="symbol">'volume_in_milliliters</span>'],</span><br><span class="line">        &#125;)</span><br><span class="line">    except KeyError:</span><br><span class="line">        continue</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="symbol">'lcbo</span>-<span class="number">2016</span>-<span class="keyword">new</span>.json', <span class="string">'w'</span>) as f:</span><br><span class="line">    sorted_replacements = sorted(replacements, key=lambda <span class="keyword">entry</span>: (<span class="keyword">entry</span>[<span class="symbol">'regular_price</span>'] <span class="keyword">or</span> <span class="number">100</span>) / (<span class="keyword">entry</span>[<span class="symbol">'volume</span>'] <span class="keyword">or</span> <span class="number">1</span>) / (<span class="keyword">entry</span>[<span class="symbol">'alcohol_content</span>'] <span class="keyword">or</span> <span class="number">1</span>))</span><br><span class="line">    json.dump(sorted_replacements[:<span class="number">1000</span>], f, indent=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>The entries are now sorted by ‘the most bang for the buck’, i.e. (price / volume / alcohol %). It looks like this:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Kelly's"</span>,</span><br><span class="line">        <span class="attr">"regular_price"</span>: <span class="number">9.44</span>,</span><br><span class="line">        <span class="attr">"package"</span>: <span class="string">"1000 mL bottle"</span>,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">113332</span>,</span><br><span class="line">        <span class="attr">"volume"</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</span><br><span class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Andr\u00e8s Fine Old Apera"</span>,</span><br><span class="line">        <span class="attr">"regular_price"</span>: <span class="number">7.45</span>,</span><br><span class="line">        <span class="attr">"package"</span>: <span class="string">"750 mL bottle"</span>,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">19265</span>,</span><br><span class="line">        <span class="attr">"volume"</span>: <span class="number">750</span>,</span><br><span class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</span><br><span class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Imperial Apera"</span>,</span><br><span class="line">        <span class="attr">"regular_price"</span>: <span class="number">7.95</span>,</span><br><span class="line">        <span class="attr">"package"</span>: <span class="string">"750 mL bottle"</span>,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">69351</span>,</span><br><span class="line">        <span class="attr">"volume"</span>: <span class="number">750</span>,</span><br><span class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</span><br><span class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Brights Pale Dry Select"</span>,</span><br><span class="line">        <span class="attr">"regular_price"</span>: <span class="number">7.95</span>,</span><br><span class="line">        <span class="attr">"package"</span>: <span class="string">"750 mL bottle"</span>,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">111476</span>,</span><br><span class="line">        <span class="attr">"volume"</span>: <span class="number">750</span>,</span><br><span class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</span><br><span class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Looking good. From what we can see here, Kelly’s (whatever it is) is the cheapest offering by LCBO.</p>
<h2 id="The-Winners"><a href="#The-Winners" class="headerlink" title="The Winners"></a>The Winners</h2><p>For the record, here is a list of the province’s cheapest offerings by alcohol content.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>price ($)</th>
<th>alcohol (%)</th>
<th>volume (mL)</th>
</tr>
</thead>
<tbody>
<tr>
<td>113332<br>Kelly’s 1000 mL bottle<br>Wine</td>
<td>9.44</td>
<td>20.0</td>
<td>1000</td>
</tr>
<tr>
<td>19265<br>Andrès Fine Old Apera 750 mL bottle<br>Wine</td>
<td>7.45</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>69351<br>Imperial Apera 750 mL bottle<br>Wine</td>
<td>7.95</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>111476<br>Brights Pale Dry Select 750 mL bottle<br>Wine</td>
<td>7.95</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>19273<br>Brights Cream Apera 750 mL bottle<br>Wine</td>
<td>7.95</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>90860<br>Kittling Ridge Kingsgate Apera 750 mL bottle<br>Wine</td>
<td>8.25</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>5579<br>Andrès Golden Cream Apera 750 mL bottle<br>Wine</td>
<td>7.45</td>
<td>18.0</td>
<td>750</td>
</tr>
<tr>
<td>20248<br>Andrès Almond Cream Apera 750 mL bottle<br>Wine</td>
<td>7.45</td>
<td>18.0</td>
<td>750</td>
</tr>
<tr>
<td>6759<br>Brights 74 Apera 1000 mL bottle<br>Wine</td>
<td>11.95</td>
<td>20.0</td>
<td>1000</td>
</tr>
<tr>
<td>444539<br>Yanghe Daqu 750 mL bottle<br>Spirits</td>
<td>26.95</td>
<td>55.0</td>
<td>750</td>
</tr>
<tr>
<td>4382<br>Brights 74 Tawny 750 mL bottle<br>Wine</td>
<td>8.94</td>
<td>18.0</td>
<td>750</td>
</tr>
<tr>
<td>9530<br>Cartier Private Stock Tawny 750 mL bottle<br>Wine</td>
<td>9.94</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>306019<br>Colio Extra Dry White Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>306001<br>Colio Dry White Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>108688<br>Domaine D’Or Red 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>257998<br>Emu Amontillado Medium Dry 750 mL bottle<br>Wine</td>
<td>8.8</td>
<td>17.5</td>
<td>750</td>
</tr>
<tr>
<td>600486<br>Arak Al Shallal 750 mL bottle<br>Spirits</td>
<td>25.3</td>
<td>50.0</td>
<td>750</td>
</tr>
<tr>
<td>123133<br>Ouzo 12 750 mL bottle<br>Spirits</td>
<td>20.45</td>
<td>40.0</td>
<td>750</td>
</tr>
<tr>
<td>37184<br>Fontana Di Papa Castelli Romani 2000 mL bottle<br>Wine</td>
<td>16.45</td>
<td>12.0</td>
<td>2000</td>
</tr>
<tr>
<td>341511<br>Greek Spirit Romios 700 mL bottle<br>Spirits</td>
<td>19.25</td>
<td>40.0</td>
<td>700</td>
</tr>
<tr>
<td>512335<br>Fantini Farnese Montepulciano Dabruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>78840<br>Citra Montepulciano D’Abruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>588988<br>Spinelli Quartana Montepulciano D’Abruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>510008<br>Luxardo Sambuca Dei Cesari 1140 mL bottle<br>Spirits</td>
<td>29.95</td>
<td>38.0</td>
<td>1140</td>
</tr>
<tr>
<td>237792<br>Icebox Long Island Iced Tea 1140 mL bottle<br>Spirits</td>
<td>30.0</td>
<td>38.0</td>
<td>1140</td>
</tr>
<tr>
<td>106179<br>Domaine D’Or White 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>497032<br>Faxe 10% Extra Strong 500 mL can<br>Beer</td>
<td>3.5</td>
<td>10.0</td>
<td>500</td>
</tr>
<tr>
<td>456202<br>Crest Super Lager 500 mL can<br>Beer</td>
<td>3.5</td>
<td>10.0</td>
<td>500</td>
</tr>
<tr>
<td>40196<br>Luxardo Sambuca Dei Cesari 750 mL bottle<br>Spirits</td>
<td>19.95</td>
<td>38.0</td>
<td>750</td>
</tr>
<tr>
<td>544312<br>Foris Pinot Gris 750 mL bottle<br>Wine</td>
<td>7.35</td>
<td>14.0</td>
<td>750</td>
</tr>
<tr>
<td>35659<br>Bosco Anice 750 mL bottle<br>Spirits</td>
<td>22.1</td>
<td>42.0</td>
<td>750</td>
</tr>
<tr>
<td>184143<br>Boxer Ice 710 mL can<br>Beer</td>
<td>2.75</td>
<td>5.5</td>
<td>710</td>
</tr>
<tr>
<td>224840<br>Colt 45 710 mL can<br>Beer</td>
<td>4.0</td>
<td>8.0</td>
<td>710</td>
</tr>
<tr>
<td>459222<br>Dry Hopped Keg 58000 mL can<br>Beer</td>
<td>306.5</td>
<td>7.5</td>
<td>58000</td>
</tr>
<tr>
<td>321687<br>Schlitz Malt Liquor 946 mL bottle<br>Beer</td>
<td>4.0</td>
<td>6.0</td>
<td>946</td>
</tr>
<tr>
<td>465849<br>Concha Y Toro Frontera Chardonnay 1500 mL bottle<br>Wine</td>
<td>13.85</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>113019<br>Concha Y Toro Frontera Sauvignon Blanc 1500 mL bottle<br>Wine</td>
<td>13.85</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>676783<br>Faxe Strong 500 mL can<br>Beer</td>
<td>2.85</td>
<td>8.0</td>
<td>500</td>
</tr>
<tr>
<td>447466<br>Santa Carolina Cabernet Merlot 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>306472<br>Cono Sur Tocornal Sauvignon Blanc 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>589069<br>French Cross Red Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>80788<br>Hochtaler 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>589028<br>French Cross Blush Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>188292<br>Hochtaler Dry 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>28647<br>Cantine Due Palme Canonico Negroamaro Salento Igp 2000 mL bottle<br>Wine</td>
<td>17.95</td>
<td>12.5</td>
<td>2000</td>
</tr>
<tr>
<td>275099<br>Jackson-Triggs Vidal 4000 mL bagnbox<br>Wine</td>
<td>35.95</td>
<td>12.5</td>
<td>4000</td>
</tr>
<tr>
<td>572891<br>Sola Nero White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>128520<br>L’Epayrie Special Reserve Rouge 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>165308<br>Colio Extra Dry White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>87981<br>Domaine D’Or White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>193821<br>Domaine D’Or Superieur White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>85456<br>Colio Dry White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>3038<br>Fontana Di Papa Castelli Romani 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>85464<br>Colio Dry Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>87965<br>Domaine D’Or Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>193813<br>Domaine D’Or Superieur Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>572917<br>Sola Nero Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>16139<br>Brights 74 Tawny 1000 mL bottle<br>Wine</td>
<td>12.95</td>
<td>18.0</td>
<td>1000</td>
</tr>
<tr>
<td>218891<br>Dos Amigos Tinto Red 3000 mL bottle<br>Wine</td>
<td>25.95</td>
<td>12.0</td>
<td>3000</td>
</tr>
<tr>
<td>315846<br>Wellington Pub Pack 4x473 mL can<br>Beer</td>
<td>10.95</td>
<td>8.0</td>
<td>1892</td>
</tr>
<tr>
<td>217182<br>Pabst Olde English 800 1180 mL bottle<br>Beer</td>
<td>6.75</td>
<td>7.9</td>
<td>1180</td>
</tr>
<tr>
<td>199851<br>Okocim Mocne 500 mL can<br>Beer</td>
<td>2.54</td>
<td>7.0</td>
<td>500</td>
</tr>
<tr>
<td>346247<br>Dab Maibock 500 mL can<br>Beer</td>
<td>2.54</td>
<td>7.0</td>
<td>500</td>
</tr>
<tr>
<td>88815<br>Tatra Beer 500 mL can<br>Beer</td>
<td>2.0</td>
<td>5.5</td>
<td>500</td>
</tr>
<tr>
<td>431239<br>Faxe Premium Lager 500 mL can<br>Beer</td>
<td>2.0</td>
<td>5.5</td>
<td>500</td>
</tr>
<tr>
<td>589051<br>French Cross Dry White 4000 mL bagnbox<br>Wine</td>
<td>34.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>68544<br>Sawmill Creek Dry Red Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>34.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>378158<br>Pabst Blue Ribbon 5.9%. 6x473 mL can<br>Beer</td>
<td>12.25</td>
<td>5.9</td>
<td>2838</td>
</tr>
<tr>
<td>253914<br>Martini Dry Vermouth White 1000 mL bottle<br>Wine</td>
<td>13.25</td>
<td>18.0</td>
<td>1000</td>
</tr>
<tr>
<td>160358<br>Donini Merlot 1000 mL bottle<br>Wine</td>
<td>9.94</td>
<td>13.5</td>
<td>1000</td>
</tr>
<tr>
<td>318337<br>Er Qu 500 mL bottle<br>Spirits</td>
<td>18.95</td>
<td>51.4</td>
<td>500</td>
</tr>
<tr>
<td>605709<br>Ramazzotti Sambuca 1140 mL bottle<br>Spirits</td>
<td>31.95</td>
<td>38.0</td>
<td>1140</td>
</tr>
<tr>
<td>280719<br>Gato Negro Cabernet Sauvignon 1500 mL bottle<br>Wine</td>
<td>14.95</td>
<td>13.5</td>
<td>1500</td>
</tr>
<tr>
<td>286187<br>Concha Y Toro Frontera Cabernet Sauvignon 1500 mL bottle<br>Wine</td>
<td>13.85</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>322727<br>Santa Carolina Chardonnay 1500 mL bottle<br>Wine</td>
<td>14.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>14878<br>Velletri Le Contrade Red Igp 2000 mL bottle<br>Wine</td>
<td>17.8</td>
<td>12.0</td>
<td>2000</td>
</tr>
<tr>
<td>213900<br>Alpenbitter No. 7 750 mL bottle<br>Spirits</td>
<td>22.25</td>
<td>40.0</td>
<td>750</td>
</tr>
<tr>
<td>540468<br>Lezajsk Beer 500 mL bottle<br>Beer</td>
<td>2.04</td>
<td>5.5</td>
<td>500</td>
</tr>
<tr>
<td>679860<br>Red Bull Beer 710 mL can<br>Beer</td>
<td>3.75</td>
<td>7.1</td>
<td>710</td>
</tr>
<tr>
<td>504340<br>Santa Carolina Merlot 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>226969<br>Pelee Pebbles Vidal Hibernal 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>554527<br>Kourtakis Apelia Agiorgitiko Red Peloponnese Igp 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>679738<br>James Ready 5.5. 24x341 mL bottle<br>Beer</td>
<td>33.5</td>
<td>5.5</td>
<td>8184</td>
</tr>
<tr>
<td>615112<br>Lakeport Ice 24x341 mL bottle<br>Beer</td>
<td>33.5</td>
<td>5.5</td>
<td>8184</td>
</tr>
<tr>
<td>31971<br>Fantini Farnese Sangiovese IGT 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>79046<br>Citra Trebbiano D’Abruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>48140<br>Fontana Di Papa Colli Albani 2000 mL bottle<br>Wine</td>
<td>16.45</td>
<td>11.0</td>
<td>2000</td>
</tr>
<tr>
<td>107193<br>Gray Fox Chardonnay 1500 mL bottle<br>Wine</td>
<td>14.6</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>107201<br>Gray Fox Cabernet Sauvignon 1500 mL bottle<br>Wine</td>
<td>14.6</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>207852<br>L’Ambiance Red 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.0</td>
<td>4000</td>
</tr>
<tr>
<td>207860<br>L’Ambiance White 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.0</td>
<td>4000</td>
</tr>
<tr>
<td>68528<br>Sawmill Creek Autumn Blush Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.0</td>
<td>4000</td>
</tr>
<tr>
<td>363507<br>Prince Igor Extreme Vodka 1750 mL bottle<br>Spirits</td>
<td>59.0</td>
<td>45.0</td>
<td>1750</td>
</tr>
<tr>
<td>248146<br>Laker Ice 15x355 mL can<br>Beer</td>
<td>21.95</td>
<td>5.5</td>
<td>5325</td>
</tr>
<tr>
<td>142620<br>Laker Ice 473 mL can<br>Beer</td>
<td>1.95</td>
<td>5.5</td>
<td>473</td>
</tr>
<tr>
<td>382291<br>Laker Red 473 mL can<br>Beer</td>
<td>1.95</td>
<td>5.5</td>
<td>473</td>
</tr>
<tr>
<td>28951<br>Paarl Cape Ruby 750 mL bottle<br>Wine</td>
<td>9.85</td>
<td>17.5</td>
<td>750</td>
</tr>
<tr>
<td>109017<br>L’Epayrie Blanc 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>11.5</td>
<td>1500</td>
</tr>
<tr>
<td>203646<br>Andrès Sparkling 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>11.5</td>
<td>1500</td>
</tr>
<tr>
<td>273268<br>Spirytus Gdanski 76% 700 mL bottle<br>Spirits</td>
<td>39.95</td>
<td>76.0</td>
<td>700</td>
</tr>
<tr>
<td>280644<br>Carlo Rossi California Red 3000 mL bottle<br>Wine</td>
<td>25.95</td>
<td>11.5</td>
<td>3000</td>
</tr>
</tbody>
</table>
<p>Guess what, that is also made with Python. Here is the code:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with open(<span class="string">'lcbo-2016-new.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> <span class="string">f:</span></span><br><span class="line">    writer = csv.DictWriter(f, fieldnames=[<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'package'</span>, <span class="string">'primary_category'</span>, <span class="string">'regular_price'</span>, <span class="string">'alcohol_content'</span>, <span class="string">'volume'</span>])</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    <span class="keyword">for</span> repl <span class="keyword">in</span> <span class="string">sorted_replacements:</span></span><br><span class="line">        writer.writerow(repl)</span><br></pre></td></tr></table></figure>
<p><a href="https://gist.github.com/1337/6190299" target="_blank" rel="external">Click here</a> for the complete dump.</p>
<p>At last, Ontarians need not be ripped off by the LCBO. Or, you know, you can always brew…</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../General/">General</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">Python</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Safety-Critical-Python-Projects" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2015/Safety-Critical-Python-Projects/" class="article-date">
  <time datetime="2015-09-19T00:22:51.000Z" itemprop="datePublished">2015-09-18</time>
</a>
		</span>
		<span class="meta-elements author">Author</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2015/Safety-Critical-Python-Projects/">Safety-Critical Python Projects</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Working with large projects is hard. Anyone who has worked on a large-scale Perl project would tell you that such a project is impossible to understand after a while–not because Perl is hard–but because Perl lets you do everything. Ruby, aka PerlImproved, also suffers similarly that the language allows too much to happen. What, then, does it say about large-scale Python projects, especially when a failure can cost your company dozens of dollars?</p>
<p><a href="http://lars-lab.jpl.nasa.gov/" target="_blank" rel="external">Jet Propulsion Laboratory (JPL)</a>, a unit of CalTech, knows all about writing mission-critical software. They have released documents regarding <a href="http://lars-lab.jpl.nasa.gov/JPL_Coding_Standard_C.pdf" target="_blank" rel="external">High-quality C code</a>; and the <a href="http://lars-lab.jpl.nasa.gov/jpl-java-standard.pdf" target="_blank" rel="external">Java coding standard</a>, which sets a high bar in the field. They need to do that because dividing by zero, by mistake, can cost multiple human lives. <a href="http://www.rideco.com/" target="_blank" rel="external">My company project</a>, which also concerns many human lives everyday, has a lot to learn from JPL. Here is what I have learnt.</p>
<h2 id="“Must”-and-“Should”"><a href="#“Must”-and-“Should”" class="headerlink" title="“Must” and “Should”"></a>“Must” and “Should”</h2><p><strong>Must</strong> is just the same as <a href="https://en.wikipedia.org/wiki/MISRA_C#Compliance" target="_blank" rel="external">MISRA’s definition</a> of “shall”, which means a rule must be followed, or the code is to be <a href="https://github.com/munificent/vigil" target="_blank" rel="external"><em>vigilante</em>d</a> and destroyed.</p>
<p><strong>Should</strong>, on the other hand, means that a rule is a recommendation; a competent developer like you should follow it, but it is ultimately up to you (and/or your peers).</p>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>New projects <strong>SHOULD</strong> Python3 if their libraries support it.</p>
<h3 id="Assertions"><a href="#Assertions" class="headerlink" title="Assertions"></a>Assertions</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">The assertion density of the code should average a minimum of two assertions per function. Assertions must always be side effect-free and should be defined as Boolean tests.</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bad!</span></span><br><span class="line"><span class="keyword">assert</span> another_function_returns_true()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Good (better with a message)</span></span><br><span class="line"><span class="keyword">assert</span> value_from_another_function &lt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Because assertions are stripped if python is run with `-O` or `-OO`,</span></span><br><span class="line"><span class="comment"># this is possibly th safest option when it comes to assertions.</span></span><br><span class="line"><span class="comment"># http://stackoverflow.com/questions/944592/best-practice-for-python-assert</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_assert</span><span class="params">(condition, message=<span class="string">''</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> condition:</span><br><span class="line">        <span class="comment"># This is never optimized away</span></span><br><span class="line">        <span class="keyword">raise</span> AssertionError(message)</span><br><span class="line"></span><br><span class="line">_assert(value_from_another_function &lt; <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h3><p>Python is one of the best languages in exception-handling; so good, in fact, that the core developers recommend exceptions for flow control. However, using exceptions does not mean you should be <a href="http://swreflections.blogspot.ca/2012/03/defensive-programming-being-just-enough.html" target="_blank" rel="external">swallowing errors or hiding bugs</a>. In safety-critical defensive programming, where <a href="http://stackoverflow.com/questions/4109218/do-gamma-rays-from-the-sun-really-flip-bits-every-once-in-a-while" target="_blank" rel="external">not even the value of anything can be trusted</a>, all functions and methods must know how to handle an exception bubbling up to it–even the ones caught by child functions.</p>
<h4 id="try"><a href="#try" class="headerlink" title="try"></a><code>try</code></h4><h4 id="except"><a href="#except" class="headerlink" title="except"></a><code>except</code></h4><h4 id="finally"><a href="#finally" class="headerlink" title="finally"></a><code>finally</code></h4><h2 id="Variables-and-types"><a href="#Variables-and-types" class="headerlink" title="Variables and types"></a>Variables and types</h2><h3 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a><a href="http://mpmath.org/" target="_blank" rel="external">Numbers</a></h3><p>Assume nothing about a numeric input.</p>
<p>While most number types can be duct-typed, most of the time at that, you occasionally see this happening:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span><span class="params">()</span>:</span></span><br><span class="line">    x = foo()  <span class="comment"># A number</span></span><br><span class="line">    y = bar()  <span class="comment"># Another number</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x / y</span><br></pre></td></tr></table></figure>
<p>The trouble is, even if you know x and y to are numbers, you can still get</p>
<ul>
<li><code>ZeroDivisionError</code>, if y is zero,</li>
<li>The return being <code>nan</code>, should both x and y be a variant of <code>inf</code>,</li>
<li><code>InvalidOperation</code>, if both x and y are Decimal infinities instead,</li>
<li>Some truncated number, if both x and y are integers,</li>
<li><code>TypeError</code> for dividing a Decimal with a float, and</li>
<li>A whole new can of worms, if x and y can be complex numbers, whose <code>a+bj</code> syntax is actually built into the language.</li>
</ul>
<p>The recommended approach, albeit flawed, is to <em>fail early</em> and do appropriate bounds and type checks, for example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span><span class="params">()</span>:</span></span><br><span class="line">    x = foo()  <span class="comment"># A number</span></span><br><span class="line">    <span class="keyword">assert</span> x &gt; <span class="number">0</span></span><br><span class="line">    y = bar()  <span class="comment"># Another number</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt; y &lt; float(<span class="string">'inf'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x / y</span><br></pre></td></tr></table></figure>
<p>I say this is flawed, because even such assertions can fail if x or y are complex numbers, and your QA department really is that good: <code>TypeError: no ordering relation is defined for complex numbers</code>.</p>
<h3 id="Mutability"><a href="#Mutability" class="headerlink" title="Mutability"></a>Mutability</h3><h4 id="Lists-and-dicts"><a href="#Lists-and-dicts" class="headerlink" title="Lists and dicts"></a>Lists and dicts</h4><p><em>Lists and dicts are mutable.</em> This means, should a dictionary be accepted by a function, and said function has a side effect that mutates such a dict, it is also changed for the function that called it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(dt)</span>:</span></span><br><span class="line">    dt[<span class="string">'bar'</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    my_dict = &#123;&#125;</span><br><span class="line">    bar(my_dict)</span><br><span class="line">    <span class="keyword">return</span> my_dict</span><br><span class="line"></span><br><span class="line">print(foo())  <span class="comment"># &#123;'bar': 1&#125;</span></span><br></pre></td></tr></table></figure>
<p>This makes the state of a given function hard to guarantee.<br><code>tuple</code>s are frozen <code>list</code>s. They also have the benefit of <a href="http://stackoverflow.com/questions/68630/are-tuples-more-efficient-than-lists-in-python" target="_blank" rel="external">needing fewer CPU instructions to create</a>.</p>
<p>Remember, also, that while <code>list()</code> and <code>dict()</code> create copies of their respective types, they are only shallow copies.<br>This is not good enough. Use <a href="https://docs.python.org/2/library/copy.html#copy.deepcopy" target="_blank" rel="external"><code>copy.deepcopy()</code></a> instead, while avoiding lists and dicts entirely, where possible.</p>
<h4 id="Tuples"><a href="#Tuples" class="headerlink" title="Tuples"></a>Tuples</h4><h4 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h4><p>Sets <em>are</em> mutable through the use of <code>.add()</code>, <code>.remove()</code>, and all set operations like <code>+</code>, <code>-</code>, <code>intersect</code>, …<br>While mutability is not a bad thing, strictly speaking, you might occasionally prefer using <a href="https://docs.python.org/2/library/stdtypes.html#frozenset" target="_blank" rel="external"><code>frozenset</code></a> instead, whose immutability also makes it hashable.</p>
<h3 id="is-not-None"><a href="#is-not-None" class="headerlink" title="is not None"></a><code>is not None</code></h3><p><code>if foo is not None</code> literally only checks if <code>foo</code> is not <code>None</code>, which allows it to be anything else that is also falsy, for example, <a href="https://docs.python.org/2.4/lib/truth.html" target="_blank" rel="external"><code>0, &#39;&#39;, False, {}, [], set(), ...</code></a>. If the code expects a truthy value, never use <code>is not None</code>. On the other hand, if the code must handle falcy values as well, but not <code>None</code> for some reason (notable example: a user name of ‘null’), <code>is not None</code> does have valid uses.</p>
<h3 id="Type-hinting"><a href="#Type-hinting" class="headerlink" title="Type hinting"></a>Type hinting</h3><p><a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="external">PEP 484</a> introduced type hinting. Unfortunately, being a type <em>hinting</em> proposal, having these type hints does not make python check the types. To follow through with the philosophy, either use <a href="http://mypy-lang.org/" target="_blank" rel="external"><code>mypy</code></a>, or implement a <a href="/2015/Python-Airlocks">python airlock</a>.</p>
<h3 id="Scoping"><a href="#Scoping" class="headerlink" title="Scoping"></a>Scoping</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">Variables must be declared at the smallest possible level of scope.</a><br>Don’t instantiate variables where it may be accessed normally by another method or function, in case a developer, who does not have in-depth knowledge of the module, modifies its usage as intended.</p>
<h3 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h3><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><blockquote>
<p><a href="http://swreflections.blogspot.ca/2012/03/defensive-programming-being-just-enough.html" target="_blank" rel="external">Protect your code from invalid data coming from “outside”.</a></p>
</blockquote>
<p>For ordinary functions, “outside” is anything that is not contained in the function block. For class and instance methods, “outside” is anything not encapsulated by the same instance/class.</p>
<p>Functions should accept any number<em> of <a href="https://docs.python.org/3/library/stdtypes.html" target="_blank" rel="external">built-in immutables</a>, and return at most one built-in immutable. (</em>as many as flake8 allows; usually fewer than 5)</p>
<p>Functions should have no side effects; <a href="#Lists_and_dicts">this</a> can happen otherwise.</p>
<blockquote>
<p>The original programmer on this system didn’t trust the network, didn’t trust the O/S, didn’t trust Operations, didn’t trust other people’s code, and didn’t trust his own code – for good reason. He was a chemical engineer turned self-taught system programmer who drank a lot while coding late at night (…)</p>
</blockquote>
<p>You might be drunk, your colleagues might be drunk, your wife might be cheating on you. <strong>Do not trust any other part of your project.</strong></p>
<h3 id="parameters-args-kwargs"><a href="#parameters-args-kwargs" class="headerlink" title="(parameters, *args, **kwargs)"></a><code>(parameters, *args, **kwargs)</code></h3><p><strong>Never use star-args.</strong> <a href="https://pypi.python.org/pypi/flake8" target="_blank" rel="external">flake8</a> makes it very clear.<br>Star args allows <a href="http://stackoverflow.com/questions/1788923/parameter-vs-argument" target="_blank" rel="external">arguments</a> to be passed to a function that does nothing with it, and cause a function’s expected parameter(s) to be <code>None</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""Extreme example."""</span></span><br><span class="line">    <span class="keyword">return</span> kwargs.get(<span class="string">'bar'</span>)</span><br><span class="line"></span><br><span class="line">foo(baz=<span class="number">5</span>)   <span class="comment">#  None, because typo</span></span><br></pre></td></tr></table></figure>
<p>Do not attempt to circumvent flake8’s star-arg detection.</p>
<h3 id="Type-hinting-wiith-star-args"><a href="#Type-hinting-wiith-star-args" class="headerlink" title="Type hinting wiith star args"></a>Type hinting wiith star args</h3><p><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=10631" target="_blank" rel="external">Rob Manderson</a> once said: <a href="http://www.codeproject.com/Articles/7904/Defensive-programming" target="_blank" rel="external">let the compiler do the work.</a><br>The problem with that is:</p>
<ul>
<li>He was talking about C++;</li>
<li>We are talking about Python, and we don’t have compilers.</li>
</ul>
<p>Instead, in Python 3.5, we have <a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="external">type hinting</a>, a mechanism that <em>helps</em> verify the types of all arguments passed into a function.</p>
<p>If you do use Python 3.5+, you should:</p>
<ul>
<li>Type-hint all parameters defined by a function,</li>
<li>Type-hint the return types of all values of a function, and</li>
<li>Do appropriate type and bounds checking anyway, because type hinting literally means, <em>hinting</em>.</li>
</ul>
<p>If you must use something below Python 3.5, you should:</p>
<ul>
<li>Write assertions for all parameters defined by a function, and</li>
<li>Write assertions for all return values of a function before they are returned.</li>
</ul>
<p>Again, <a href="http://mypy-lang.org/" target="_blank" rel="external"><code>mypy</code></a> is here to enforce these type hints, wherever you find this appropriate in your project.</p>
<h3 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">Restrict all code to very simple control flow constructs.</a><br>Since recursion may accidentally cause stack overflow, it may not be used.</p>
<h3 id="Pointers-and-callbacks"><a href="#Pointers-and-callbacks" class="headerlink" title="Pointers and callbacks"></a>Pointers and callbacks</h3><p>Python allows a function or method to be referenced, which has its uses, such as</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * x</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maths</span><span class="params">(func, val)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> func(val)</span><br><span class="line"></span><br><span class="line">print(maths(square, <span class="number">2</span>))  <span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
<p>You are writing safety-critical code, however. This allows any arbitrary input to alter the expected operation of the function that accepts a function, and must not be done, unless you are making a <a href="#Decorators">decorator</a> with it.</p>
<h3 id="Return-types"><a href="#Return-types" class="headerlink" title="Return types"></a>Return types</h3><h4 id="Multiple-returns"><a href="#Multiple-returns" class="headerlink" title="Multiple returns"></a>Multiple returns</h4><p>Should a function or method have multiple return statements–which is better than a ‘return value’ variable in the function or method–these return statements must return the same type of value. If one day it makes more sense to return more than one type (e.g. <code>int|None</code>) for some reason, the docstring of the function or method must make it explicitly clear, and the code that uses the return value must have code that handles all expected return types.</p>
<h3 id="Generators"><a href="#Generators" class="headerlink" title="Generators"></a>Generators</h3><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><h3 id="Cyclomatic-complexity"><a href="#Cyclomatic-complexity" class="headerlink" title="Cyclomatic complexity"></a>Cyclomatic complexity</h3><p><a href="http://sdtimes.com/nasas-10-rules-developing-safety-critical-code/" target="_blank" rel="external">Typically, this means no more than about 60 lines of code per function.</a></p>
<h2 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h2><h3 id="Encapsulation"><a href="#Encapsulation" class="headerlink" title="Encapsulation"></a>Encapsulation</h3><h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><h3 id="all"><a href="#all" class="headerlink" title="__all__"></a><code>__all__</code></h3><p>What <code>__all__</code> does is restrict what gets imported when someone does this to you:</p>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> your_project <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<p>But it does not actually restrict imports if they are literally named. So, this works:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># your_project/__init__.py</span></span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'foo'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_bar</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># my.py</span></span><br><span class="line"><span class="keyword">from</span> your_project <span class="keyword">import</span> _bar</span><br></pre></td></tr></table></figure>
<p>This makes <code>__all__</code> useless within the scope of this article. Of course, Python assumes we are all consenting adults, allowing everyone else to reach into our privates (and puns along those lines), but, after several years of experience in software development, you eventually realise this is not pleasant all the time.<br>The solution is to ban <code>import *</code>.</p>
<h3 id="Required-imports"><a href="#Required-imports" class="headerlink" title="Required imports"></a>Required imports</h3><p>Python coder running version &lt; 3.0 may want to have this line above every file:</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> __future__ <span class="keyword">import</span> (absolute_import,</span><br><span class="line">                        division,</span><br><span class="line">                        print_function,</span><br><span class="line">                        )</span><br></pre></td></tr></table></figure>
<h3 id="Multithreading-and-multiprocessing"><a href="#Multithreading-and-multiprocessing" class="headerlink" title="Multithreading and multiprocessing"></a>Multithreading and multiprocessing</h3><blockquote>
<p><a href="http://swreflections.blogspot.ca/2012/03/defensive-programming-being-just-enough.html" target="_blank" rel="external">Make your code thread-safe unless you have a good reason not to (…)</a></p>
</blockquote>
<p><a href="https://gist.github.com/mangecoeur/9540178" target="_blank" rel="external">https://gist.github.com/mangecoeur/9540178</a></p>
<h2 id="PEP-20"><a href="#PEP-20" class="headerlink" title="PEP 20"></a>PEP 20</h2><h3 id="Return-early"><a href="#Return-early" class="headerlink" title="Return early"></a>Return early</h3><h2 id="PEP-8"><a href="#PEP-8" class="headerlink" title="PEP 8"></a>PEP 8</h2><h3 id="Line-length"><a href="#Line-length" class="headerlink" title="Line length"></a>Line length</h3><p>The maximum line length is 79.<br>Some people <a href="http://stackoverflow.com/questions/88942/why-does-python-pep-8-specify-a-maximum-line-length-of-79-characters" target="_blank" rel="external">advocate</a> that the line length limit is insane or useless, and it can be arbitrarily long, so long as readability is maintained. The truth is, if you want your code to remain readable on a computer terminal built in the 1980s, you will have to keep that line length. Some argue that it is okay to break the 79-line rule occasionally, as Beautiful is better than ugly, and Readability counts. Well, the truth is, 79 is 79, and we ought to get too hung up on linters doing their thing. Bearing in mind that docstrings need to be under 72 characters long, all your code should be under 72 characters long; <em>then</em> you can occasionally break the 72-character rule, into the “75 ish” limit, which does not violate PEP 8.</p>
<h3 id="PEP-3105-print-function"><a href="#PEP-3105-print-function" class="headerlink" title="PEP 3105 (print function)"></a>PEP 3105 (print function)</h3><p>The print function completely replaces the print statement. It is therefore toxic to have the pattern <code>print</code> in your code.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_<span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<h2 id="PEP-257"><a href="#PEP-257" class="headerlink" title="PEP 257"></a>PEP 257</h2><h2 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h2><p>Use only libraries that also conform to this same level of standard.</p>
<h3 id="Error-reporting-and-telemetry"><a href="#Error-reporting-and-telemetry" class="headerlink" title="Error reporting and telemetry"></a>Error reporting and telemetry</h3><h3 id="Outdated-libraries"><a href="#Outdated-libraries" class="headerlink" title="Outdated libraries"></a>Outdated libraries</h3><h2 id="Portability"><a href="#Portability" class="headerlink" title="Portability"></a>Portability</h2><h3 id="Language"><a href="#Language" class="headerlink" title="Language"></a>Language</h3><p>All python files must have <code># coding=utf-*</code> defined, where <code>*</code> is commonly 8. See <a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="external">PEP 263</a> for your encoding options.<br>Despite having such a value defined, the files must only contain <a href="http://chortle.ccsu.edu/java5/Notes/chap85%5Cch85_12.html" target="_blank" rel="external">characters whose <code>ord()</code> is between 0 and 255</a>.</p>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>Ensure your code has accurate, comprehensible comments, and is completely documented. Here is <a href="http://thomas-cokelaer.info/tutorials/sphinx/docstring_python.html" target="_blank" rel="external">a meaningful docstring</a>:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def foo(bar):</span><br><span class="line">    <span class="string">""</span><span class="comment">"Foos a bar. If bar is a baz, bazzes.</span></span><br><span class="line"></span><br><span class="line">    :param bar: A valid <span class="keyword">number</span> <span class="keyword">for</span> the <span class="function"><span class="keyword">function</span>.</span></span><br><span class="line">    :<span class="built_in">type</span> bar: <span class="keyword">int</span></span><br><span class="line">    :<span class="keyword">return</span>: Same <span class="keyword">as</span> bar.</span><br><span class="line">    :rtype: <span class="keyword">int</span></span><br><span class="line">    <span class="string">""</span><span class="comment">"</span></span><br><span class="line">    <span class="keyword">return</span> bar</span><br></pre></td></tr></table></figure>
<p>Correct docstrings allow IDEs like PyCharm to check all usages of such a function, if the IDE is so configured. For frequently-used functions, correct docstrings have immense benefit.</p>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><blockquote>
<p>Premature optimization is the root of all evil.</p>
</blockquote>
<p>Performance should be of low priority on your checklist.<br>Remember, safety is always first.</p>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><h2 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h2><h3 id="Static-analysis"><a href="#Static-analysis" class="headerlink" title="Static analysis"></a><a href="http://pixelscommander.com/en/javascript/nasa-coding-standarts-for-javascript-performance/" target="_blank" rel="external">Static analysis</a></h3><blockquote>
<p>All code must be compiled, from the first day of development, with all compiler warnings enabled at the compiler’s most pedantic setting. All code must compile with these setting without any warnings.</p>
</blockquote>
<p>Crank everything up to 11. The tedium in the beginning is worth it.</p>
<h3 id="Gated-reviews"><a href="#Gated-reviews" class="headerlink" title="Gated reviews"></a>Gated reviews</h3><p><a href="http://sqlzen.blogspot.ca/2012/06/code-reviews-must-be-brutally-honest.html" target="_blank" rel="external">Code reviews must be brutally honest.</a></p>
<h3 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h3><h4 id="grep-test"><a href="#grep-test" class="headerlink" title="grep test"></a><a href="http://jamie-wong.com/2013/07/12/grep-test/" target="_blank" rel="external"><code>grep</code> test</a></h4><p>Code that fails <a href="http://jamie-wong.com/2013/07/12/grep-test/" target="_blank" rel="external">the <code>grep</code> test</a> should not be checked in; it probably has design faults that require a higher level code review.</p>
<h4 id="Tests-that-never-run"><a href="#Tests-that-never-run" class="headerlink" title="Tests that never run"></a>Tests that never run</h4><h4 id="Destructive-testing"><a href="#Destructive-testing" class="headerlink" title="Destructive testing"></a><a href="https://en.wikipedia.org/wiki/Software_testing#Destructive_testing" target="_blank" rel="external">Destructive testing</a></h4><p>When a line is removed from your code, and your program still passes all the tests, you are probably missing a test. Some obvious exceptions apply:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># before</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> x</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># after</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> x</span><br></pre></td></tr></table></figure>
<p>In general, it is great practice to have a mutation testing framework installed and challenge your program. <a href="https://pypi.python.org/pypi/MutPy/0.4.0" target="_blank" rel="external">Libraries exist</a>. Do consider the cost-benefit of mutation testing for your specific project, because it may take some time to write tests that ensure a mutation from <code>2 * 2</code> to <code>2 ** 2</code>, and for ranges of values you already check, <code>2 ** 2</code> might never happen to you.</p>
<h3 id="Gated-integration"><a href="#Gated-integration" class="headerlink" title="Gated integration"></a>Gated integration</h3><h3 id="Soaking"><a href="#Soaking" class="headerlink" title="Soaking"></a>Soaking</h3><h3 id="Release"><a href="#Release" class="headerlink" title="Release"></a>Release</h3>
    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../QA/">QA</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Python-Airlocks" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2015/Python-Airlocks/" class="article-date">
  <time datetime="2015-02-22T17:02:23.000Z" itemprop="datePublished">2015-02-22</time>
</a>
		</span>
		<span class="meta-elements author">Author</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2015/Python-Airlocks/">Python Airlocks</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<blockquote>
<p>The best way to attack (problems), as with many things in Python, is to be explicit.</p>
</blockquote>
<p><a href="http://www.azavea.com/blogs/labs/2014/03/solving-unicode-problems-in-python-2-7/" target="_blank" rel="external">This article</a> describes the practice of <em>airlocks</em>: functions and methods that don’t ever fail.<br>Because production code must be ready for customers, and your code obviously<br><em>is</em> customer code, you <a href="http://blog.smartbear.com/sqc/4-reasons-developers-resist-code-review-and-why-they-shouldnt/" target="_blank" rel="external"><em>must</em> adopt practices</a> to perfect your code before<br>submitting your first patchset.<br>This post will attempt <em>best</em> practices for building robust, reliable Python code.</p>
<h1 id="ensure-return"><a href="#ensure-return" class="headerlink" title="@ensure_return"></a><code>@ensure_return</code></h1><p><code>ensure_return</code> will always raise if the function somehow returns <code>None</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ensure_return</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="string">"""Always raise if a function somehow returns `None`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param func  function</span></span><br><span class="line"><span class="string">    :returns &#123;mixed&#125;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Always raise if the function somehow returns `None`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param args    can be anything.</span></span><br><span class="line"><span class="string">        :param kwargs  can be anything.</span></span><br><span class="line"><span class="string">        :raises AssertionError</span></span><br><span class="line"><span class="string">        :returns &#123;mixed&#125;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(<span class="string">u'Return is None'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapped</span><br></pre></td></tr></table></figure>
<h1 id="ensure-return-type"><a href="#ensure-return-type" class="headerlink" title="@ensure_return_type"></a><code>@ensure_return_type</code></h1><p>Generalising the solution, we can enforce the <a href="https://docs.python.org/2/library/types.html" target="_blank" rel="external">return type of a function</a> by<br>wrapping it in a hypothetical <code>@ensure_return(...)</code> decorator.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ensure_return</span><span class="params">(types)</span>:</span></span><br><span class="line">    <span class="string">"""Always raise if a function returns an incorrect type.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param types  iterable of types allowed.</span></span><br><span class="line"><span class="string">    :returns function</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">assert</span> isinstance(types, collections.Iterable)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="string">"""Wraps the original function."""</span></span><br><span class="line"><span class="meta">        @functools.wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            <span class="string">"""Always raise if the function somehow returns `None`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            :param args    can be anything.</span></span><br><span class="line"><span class="string">            :param kwargs  can be anything.</span></span><br><span class="line"><span class="string">            :raises AssertionError</span></span><br><span class="line"><span class="string">            :returns &#123;mixed&#125;</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> return_type <span class="keyword">in</span> types:</span><br><span class="line">                <span class="keyword">if</span> isinstance(result, return_type):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> AssertionError(<span class="string">u'Return is of incorrect type'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> wrapped</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure>
<h1 id="Why-stop-there"><a href="#Why-stop-there" class="headerlink" title="Why stop there"></a>Why stop there</h1><p>Why stop there? You can also check the function’s arguments.<br>~This post will be updated with argument-checking in mind.~<br>Using <a href="https://news.ycombinator.com/item?id=11801993" target="_blank" rel="external">PyContracts</a>, not only can you check the arguments’ types, you can also check for their value ranges. Use that!</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../QA/">QA</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-PEP8-for-the-working-class" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2015/PEP8-for-the-working-class/" class="article-date">
  <time datetime="2015-02-22T03:35:37.000Z" itemprop="datePublished">2015-02-21</time>
</a>
		</span>
		<span class="meta-elements author">Author</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2015/PEP8-for-the-working-class/">PEP8 for the Working Class</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Do you think <a href="https://www.python.org/dev/peps/" target="_blank" rel="external">Python</a>? Congratulations! You are in for a world of work. <em>Work</em> means that, in order to upset fewer of your colleagues, you have to follow a set of rules that is not present in the current PEP8 (or the previous iteration, for that matter.) This post prepares you to become the world’s most compliant python (at this time, python2…) developer for times to come.</p>
<h1 id="Definitions"><a href="#Definitions" class="headerlink" title="Definitions"></a>Definitions</h1><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”,  “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt" target="_blank" rel="external">RFC 2119</a>.</p>
<h1 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h1><p>Builds <strong>SHOULD NOT</strong> pass if:</p>
<ul>
<li>any <code>*args</code> are used other than package compatibility, and</li>
<li>any <code>**kwargs</code> are used other than package compatibility.</li>
</ul>
<h1 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h1><p>Builds <strong>MUST</strong> fail if:</p>
<ul>
<li>The code-to-comment (by line count) ratio is less than 1:3;</li>
<li>The first line of every character of non-block comments is not in upper case.</li>
</ul>
<h1 id="Dictionaries"><a href="#Dictionaries" class="headerlink" title="Dictionaries"></a>Dictionaries</h1><p><code>dict</code>s:</p>
<ul>
<li><strong>MUST</strong> have keys of type <code>str</code>. Not <code>unicode</code>, not anything else; <code>str</code>.</li>
</ul>
<h1 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h1><ul>
<li>Files with <code>/</code> anywhere <a href="https://mail.python.org/pipermail/tutor/2008-March/060886.html" target="_blank" rel="external">MUST</a> implement:</li>
</ul>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br></pre></td></tr></table></figure>
<ul>
<li>Division <strong>MUST</strong> take place with both sides of the operator as:<ul>
<li><code>float</code></li>
<li><code>decimal.Decimal</code></li>
<li>something more precise than <code>decimal.Decimal</code></li>
</ul>
</li>
</ul>
<h1 id="Docstrings"><a href="#Docstrings" class="headerlink" title="Docstrings"></a>Docstrings</h1><p>Docstrings <strong>MUST</strong> be of <a href="https://www.python.org/dev/peps/pep-0287/" target="_blank" rel="external">reStructuredText Docstring Format</a>.<br>Docstrings <strong>MUST</strong> fail a build if:</p>
<ul>
<li>They do not describe what is happening;</li>
<li>They describe incorrect parameters;</li>
<li>They describe parameter(s) incorrectly.</li>
</ul>
<p>Docstrings <strong>MUST</strong>:</p>
<ul>
<li>Be under 72 characters long per line;</li>
<li><a href="https://www.python.org/dev/peps/pep-0257/" target="_blank" rel="external">Have a blank second line</a>;</li>
<li>Declare the return type; and</li>
<li>Declare the exceptions returned (None if never).</li>
</ul>
<h1 id="Encoding"><a href="#Encoding" class="headerlink" title="Encoding"></a>Encoding</h1><p><a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="external">All files <strong>MUST</strong> have an encoding</a>, such as</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># coding=utf8</span></span><br></pre></td></tr></table></figure>
<h1 id="Functions-and-Methods"><a href="#Functions-and-Methods" class="headerlink" title="Functions and Methods"></a>Functions and Methods</h1><ul>
<li><p>Function name <strong>SHOULD NOT</strong> be under 5 characters long, and <strong>MUST NOT</strong> be under three characters long.<br>This is largely due to <code>val()</code> being a sensible function name.</p>
</li>
<li><p>Functions and methods <strong>MUST</strong>:</p>
<ul>
<li>Be under 100 lines long.</li>
<li>Have fewer than 5 return statements.</li>
<li>Accept fewer than 5 parameters. <code>*args</code> and <code>**kwargs</code> each count as one parameter.</li>
</ul>
</li>
<li><p>Builds <strong>MUST</strong> fail if a method’s signature is different from its parent method’s signature.</p>
</li>
<li>Functions <strong>SHOULD</strong> always check its signature and raise <code>AssertionError</code> if the parameters are not of spec.</li>
</ul>
<h1 id="Ignores"><a href="#Ignores" class="headerlink" title="Ignores"></a>Ignores</h1><ul>
<li>There <strong>MUST NOT</strong> be any ignore statements that skip this document for any<br>project files (excluding third-party packages).</li>
</ul>
<h1 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h1><ul>
<li>Imports <strong>MUST</strong> use the <code>import x.y.z</code> notation.</li>
<li>Builds <strong>MUST</strong> fail if an imported module is renamed: <code>import x as y</code></li>
<li>All imports <strong>MUST</strong> be included in a separate line. No <code>from x import y, z</code>.</li>
<li>Builds <strong>MUST</strong> fail if the <code>from x.y import x</code> notation is used.</li>
<li>Builds <strong>MUST</strong> fail if the imports are ordered in any way, other than alphabetically, using the first character after <code>import</code>.</li>
</ul>
<h1 id="Lines-and-Statements"><a href="#Lines-and-Statements" class="headerlink" title="Lines and Statements"></a>Lines and Statements</h1><p>A statement <strong>MUST</strong> contain <a href="http://docs.python-guide.org/en/latest/writing/style/#pep-8" target="_blank" rel="external">only one statement</a>.</p>
<p>Each line <strong>MUST</strong> be under <strong>72</strong> characters long – because Python docstrings<br>are 72 characters long. Code lengths are understandably 79 characters long,<br>but if you are going to set a limit on docstrings anyway, you might as well<br>limit the code to 72 characters long also.</p>
<h1 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h1><p>Any <code>logging</code> module functions <strong>MUST NOT</strong> accept a string that is already formatted:</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.warn(<span class="string">"oh no! &#123;&#125;"</span>.<span class="keyword">format</span>(<span class="string">"I am already formatted, that's bad"</span>))</span><br></pre></td></tr></table></figure>
<h1 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h1><p>Developer <strong>MUST NOT</strong> use a third-party package with fewer than one unit test(s).</p>
<h1 id="print-function"><a href="#print-function" class="headerlink" title="print function"></a><code>print</code> function</h1><p>Files with the statement <code>print</code> <a href="http://stackoverflow.com/questions/388069/python-graceful-future-feature-future-import" target="_blank" rel="external">MUST</a> implement:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_<span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>There <strong>MUST NOT</strong>  be instances:</p>
<ul>
<li>of “class factories”.</li>
</ul>
<h1 id="Regular-expressions"><a href="#Regular-expressions" class="headerlink" title="Regular expressions"></a>Regular expressions</h1><ul>
<li>Regex <strong>MUST</strong> be compiled before being used, even if the regex is used only once.</li>
<li>Regular expressions <strong>MUST NOT</strong> contain <code>.</code>, except if <code>.</code> comes after <code>\</code> or <code>[</code>.</li>
</ul>
<h1 id="Shabangs"><a href="#Shabangs" class="headerlink" title="Shabangs"></a>Shabangs</h1><p>Developer <strong>MUST NOT</strong> append a shebang of absolute path:</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python  # good</span></span><br><span class="line"><span class="meta">#!/usr/bin/python      # bad</span></span><br></pre></td></tr></table></figure>
<h1 id="Spaces"><a href="#Spaces" class="headerlink" title="Spaces"></a>Spaces</h1><p><a href="https://www.python.org/dev/peps/pep-0008/" target="_blank" rel="external">Understandably</a>, PEP 8 got soft. It now allows tabs rather than spaces.<br>Unfortunately, you are at work. Indents are either 4 spaces wide, or you<br><strong>MUST</strong> fail the build.</p>
<h1 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h1><ul>
<li>Display strings, or “whatever the user can see”, <strong>MUST</strong> be of type <code>unicode</code>.</li>
<li>Non-display strings <strong>MUST</strong> be of type <code>str</code>.</li>
</ul>
<h1 id="Trailing-commas"><a href="#Trailing-commas" class="headerlink" title="Trailing commas"></a>Trailing commas</h1><ul>
<li>Where trailing commas are applicable, trailing commas <strong>MUST</strong> be used.</li>
</ul>
<h1 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h1><ul>
<li>Variables <strong>MUST</strong> be named in suffix form, i.e.</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foo = something()</span><br><span class="line">foo_concise = ...  <span class="comment"># good</span></span><br><span class="line">concise_foo = ...  <span class="comment"># bad</span></span><br></pre></td></tr></table></figure>
<p>Bad code is like Buzzfeed articles. Every line of bad code makes you want to throw up a little bit, and leaves an impression that you either have no attention to detail, no affiliation with the code, or, and do not commit yourself as a professional.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../QA/">QA</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Python-software-quality-checklist" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2015/Python-software-quality-checklist/" class="article-date">
  <time datetime="2015-02-19T14:26:55.000Z" itemprop="datePublished">2015-02-19</time>
</a>
		</span>
		<span class="meta-elements author">Author</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2015/Python-software-quality-checklist/">Python Software Quality Checklist</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<blockquote>
<p>You either commit yourself as a professional racing driver that’s designed to win races or you come second or you come third or fifth and am not design to come third, fourth or fifth. I race to win. And if you no longer go for a gap that exists, you are no longer a racing driver because we are competing, we are competing to win. ― Ayrton Senna</p>
</blockquote>
<p><a href="http://en.wikipedia.org/wiki/Software_quality" target="_blank" rel="external">Shit code is not code. Shit code is shit.</a></p>
<h1 id="Databases"><a href="#Databases" class="headerlink" title="Databases"></a>Databases</h1><ul>
<li>Are all database calls resistant to <a href="http://stackoverflow.com/questions/2235318/how-do-i-deal-with-this-race-condition-in-django" target="_blank" rel="external">race conditions</a>?</li>
<li>For transactional queries, are they definitely not idempotent<br>(e.g. you don’t want to subtract value and still read the same balance again)?</li>
</ul>
<h1 id="Docstrings-and-Comments"><a href="#Docstrings-and-Comments" class="headerlink" title="Docstrings and Comments"></a>Docstrings and Comments</h1><ul>
<li>Are all files documented?</li>
<li>Are all function and method parameters documented?</li>
<li>Are all lines under 72 characters long?</li>
</ul>
<h1 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h1><ul>
<li>Does the code <a href="https://www.python.org/dev/peps/pep-0020/" target="_blank" rel="external">fail early</a>?<ul>
<li>And is there anything catching <em>all</em> of these exceptions?</li>
</ul>
</li>
<li>Are all custom exceptions based on <a href="https://docs.python.org/2/library/exceptions.html#exceptions.Exception" target="_blank" rel="external"><code>Exception</code></a>?</li>
<li>Do these exceptions <a href="http://stackoverflow.com/questions/13256777/possible-to-raise-exception-that-includes-non-english-characters-in-python-2" target="_blank" rel="external">handle unicode characters</a>?<ul>
<li>Messages are empty if the string fails to encode.</li>
</ul>
</li>
</ul>
<h1 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h1><ul>
<li>Are all lines under 79 characters long?</li>
<li>Are any files too long? (pylint checks this.)</li>
<li>Are any files organised inappropriately?</li>
<li>If it is an executable file, is there a shebang (<code>#!/usr/bin/env python...</code>)?<ul>
<li>Should it be executable?</li>
<li>Does the shebang point to <a href="http://www.cyberciti.biz/tips/finding-bash-perl-python-portably-using-env.html" target="_blank" rel="external">something relative</a>?</li>
<li>Does the file have executable permissions?</li>
</ul>
</li>
<li><a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="external">Does it declare an encoding</a>?</li>
<li>Does it have a docstring? See <a href="#Docstrings and comments">Docstrings and comments</a></li>
</ul>
<h1 id="Forward-Compatibility"><a href="#Forward-Compatibility" class="headerlink" title="Forward Compatibility"></a>Forward Compatibility</h1><ul>
<li>Is there anything that prevents migration to <a href="http://nbviewer.ipython.org/github/rasbt/python_reference/blob/master/tutorials/key_differences_between_python_2_and_3.ipynb" target="_blank" rel="external">python3</a>?\</li>
<li>Are classes for supporting compatibility named with the 3K notation?<ul>
<li>Python 2.7: <code>python_2700</code></li>
<li><a href="https://github.com/jcrocholl/pep8/blob/master/pep8.py#L1121" target="_blank" rel="external">Python 3.0: <code>python_3000</code></a></li>
<li>Python 3.4: <code>python_3400</code></li>
</ul>
</li>
</ul>
<h1 id="Functions-and-Methods"><a href="#Functions-and-Methods" class="headerlink" title="Functions and Methods"></a>Functions and Methods</h1><ul>
<li>Is the code reinventing the wheel? Are there existing functions that do the same thing?</li>
<li>Does the function use keyword and star-args unnecessarily?</li>
<li>Can it be a pure function? See <a href="#Tests">Tests</a></li>
<li>If it returns just a boolean, does the function have a name that appropriately reflects that?</li>
<li>Do number parameters have min/max/allowed_values check(s) in place?</li>
<li>Are there any magic strings, numbers, and/or values?</li>
<li>Are all function arguments given with keywords where appropriate?</li>
<li>Do your functions survive <a href="http://jamie-wong.com/2013/07/12/grep-test/" target="_blank" rel="external">the <code>grep</code> test</a>?<br>If you cannot grep a function by name and get all its usages, it fails the grep test.</li>
</ul>
<h2 id="Function-lengths"><a href="#Function-lengths" class="headerlink" title="Function lengths"></a>Function lengths</h2><blockquote>
<p>“The first rule of functions is that they should be small. The second rule of funct`ions is that they should be smaller than that. Functions should not be 100 lines long. Functions should hardly ever be 20 lines long.” - <a href="http://www.javacodegeeks.com/2012/12/rule-of-30-when-is-a-method-class-or-subsystem-too-big.html" target="_blank" rel="external">Bob Martin, Clean Code</a></p>
</blockquote>
<blockquote>
<p>“Every function was just 2, or 3, or 4 lines long, each was transparently obvious, each told a story, and each led you to the next in a compelling order.” - <a href="http://programmers.stackexchange.com/questions/133404/what-is-the-ideal-length-of-a-method" target="_blank" rel="external">Kent Beck</a></p>
</blockquote>
<p>NetBeans <a href="http://stackoverflow.com/questions/18147171/netbeans-7-4-introduces-10-lines-max-per-method-rule-where-does-this-rule-com" target="_blank" rel="external">heavy recommends</a> a 10-line function length to keep them testable.<br>Others say 10 lines is too short and should be under <a href="http://davetayls.me/blog/2013/07/01/how-will-i-keep-javascript-code-quality-hight-jshint/" target="_blank" rel="external">8</a>, 20, 60, or <a href="http://programmers.stackexchange.com/questions/133404/what-is-the-ideal-length-of-a-method" target="_blank" rel="external">53</a>.<br>The takeaway is: keep it under 7 to be compliant with all of these recommendations.</p>
<h1 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h1><ul>
<li><a href="https://pypi.python.org/pypi/isort" target="_blank" rel="external">Are all imports ordered</a>?</li>
<li>Besides <code>__future__</code>, are there <a href="http://stackoverflow.com/questions/9916878/importing-modules-in-python-best-practice#comment42694692_15780908" target="_blank" rel="external"><code>from x import y</code></a> line(s) <code>x.y</code> could have been used instead?</li>
<li>Do <code>__init__.py</code> files declare a <a href="http://stackoverflow.com/questions/44834/can-someone-explain-all-in-python" target="_blank" rel="external"><code>__all__</code></a>?</li>
</ul>
<h1 id="Iterables"><a href="#Iterables" class="headerlink" title="Iterables"></a>Iterables</h1><ul>
<li>Are there any instances where iterables are unnecessarily lists instead of generators?</li>
<li>Are there any usages of the <a href="https://docs.python.org/2/library/sets.html" target="_blank" rel="external">deprecated</a> <code>sets</code> library instead of <code>set/frozenset</code>?</li>
<li>Are there any instances where <code>frozenset</code> could have been used in place of <code>set</code>?</li>
<li>Are all iterables iterated using <code>enumerate()</code>, <code>iteritems()</code>, or <code>itervalues()</code>?</li>
<li>Are there instances of <code>not x in y</code> instead of the better <code>x not in y</code>? (pylint checks this.)</li>
</ul>
<h1 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h1><ul>
<li>Are all logging calls important?</li>
<li>Is the string formatted by logging? <code>logging.info(u&#39;%s&#39;, &#39;foo&#39;)</code></li>
</ul>
<h1 id="Migrations"><a href="#Migrations" class="headerlink" title="Migrations"></a>Migrations</h1><ul>
<li>Are migration files missing?</li>
</ul>
<h1 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h1><ul>
<li>Is there a <code>from __future__ import division</code> import?<ul>
<li>If not, are there instances of division where one of the numbers can be an integer?</li>
</ul>
</li>
<li>Does code that perform <code>float(some_string)</code> <a href="http://stackoverflow.com/a/1369357" target="_blank" rel="external">also catch <code>UnicodeEncodeError</code></a>?</li>
</ul>
<h1 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h1><ul>
<li>Is it necessary?</li>
<li>Does any of them contain unnecessary <em>and</em> unsafe <code>.</code>?</li>
</ul>
<h1 id="Speed"><a href="#Speed" class="headerlink" title="Speed"></a>Speed</h1><ul>
<li>Write <code>x &lt; y &lt; z</code> instead of <code>x &lt; y and y &lt; z</code>.</li>
<li>Are there any database queries occurring unnecessarily in loops?</li>
<li>Are there instances of <code>while True</code> where <a href="https://wiki.python.org/moin/PythonSpeed" target="_blank" rel="external"><code>while 1</code></a> can be used instead?</li>
<li>Are there any <a href="https://wiki.python.org/moin/PythonSpeed" target="_blank" rel="external">for loops that could have been faster list/dict/generator comprehensions</a>?</li>
<li>Is the code <a href="http://stackoverflow.com/questions/536300/what-is-the-shortest-perceivable-application-response-delay" target="_blank" rel="external">“perceivably fast”</a>?</li>
</ul>
<h1 id="Statements"><a href="#Statements" class="headerlink" title="Statements"></a>Statements</h1><ul>
<li>Do lines contain <a href="http://docs.python-guide.org/en/latest/writing/style/#pep-8" target="_blank" rel="external">more than one statement</a>?</li>
<li>The <strong>We Are All Consenting Adults Principle</strong>: are you or anyone in the team a child? Do you know for sure? Would you risk it?</li>
</ul>
<h1 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h1><ul>
<li>Adapting <a href="http://stackoverflow.com/a/56190" target="_blank" rel="external">this person’s practice</a>, does this double-quoted string contain variables?</li>
<li>If it is visible to the user, is it a <code>unicode</code> instance?</li>
<li>Besides <a href="#Logging">logging</a>, are all strings formatted using <a href="https://docs.python.org/2/library/string.html#format-string-syntax" target="_blank" rel="external"><code>.format()</code></a> instead of <code>%</code>?</li>
<li>Are all <code>format()</code> calls made using keyword arguments?</li>
</ul>
<h1 id="Templating"><a href="#Templating" class="headerlink" title="Templating"></a>Templating</h1><ul>
<li>Are there untranslated strings?</li>
<li>Are there hard-coded values?</li>
<li>Is the template coupled to what provides its variables?</li>
</ul>
<h1 id="Tests"><a href="#Tests" class="headerlink" title="Tests"></a>Tests</h1><ul>
<li>Is there at least one test case for every pure function?</li>
<li>Are most (if not all) code paths tested? This can be detected through coverage.</li>
<li><a href="https://pythonhosted.org/kitchen/unicode-frustrations.html#when-writing-unittests-include-non-ascii-values-and-both-unicode-and-str-type" target="_blank" rel="external">Is there a test involving unexpected input types</a>?</li>
<li>Did you test your changes locally, no matter `how small, before re/submitting a change?</li>
<li>Did you test locally, again, after a rebase?</li>
<li>Tests with conditional statements (e.g. <code>for</code>, <code>if</code>, <code>with</code>, <code>while</code>) <strong>MUST</strong> double-check if it is testing anything.</li>
</ul>
<h1 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h1><ul>
<li>Are there unused variables? (pylint checks this.)</li>
</ul>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../QA/">QA</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="../../">&laquo; Prev</a><a class="page-number" href="../../">1</a><span class="page-number current">2</span><a class="page-number" href="../3/">3</a><a class="extend next" rel="next" href="../3/">Next &raquo;</a>
    </nav>
  

    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.ohai.ca">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2019 Author<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="../../../../js/script.js"></script>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    var sc_project=4446854;
    var sc_invisible=0;
    var sc_security="74785e80";
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write(
      "<sc"+"ript type='text/javascript' src='" +
      scJsHost +
      "statcounter.com/counter/counter_xhtml.js'></" +
      "script>"
    );
    //]]>
  </script>
  <noscript>
    <img style="display: none"
         src="http://c.statcounter.com/4446854/0/74785e80/0/" />
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
