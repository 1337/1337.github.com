<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Tag: JavaScript | Brian&#39;s Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Meow">
<meta property="og:type" content="website">
<meta property="og:title" content="Brian's Blog">
<meta property="og:url" content="https://blog.ohai.ca/tags/JavaScript/page/2/index.html">
<meta property="og:site_name" content="Brian's Blog">
<meta property="og:description" content="Meow">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brian's Blog">
<meta name="twitter:description" content="Meow">
  
    <link rel="alternative" href="/atom.xml" title="Brian&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../../../css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.ohai.ca"></form>
	</div>
</header>
    <div id="main">
      
  
    <article id="post-Flattening-Promise-Chains-by-Example" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Flattening-Promise-Chains-by-Example/" class="article-date">
  <time datetime="2016-07-08T19:35:18.000Z" itemprop="datePublished">2016-07-08</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Flattening-Promise-Chains-by-Example/">Flattening Promise Chains by Example</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>For all intents and purposes, these examples use <a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="external"><code>bluebird</code></a>, a library that passes the <a href="https://promisesaplus.com/" target="_blank" rel="external">Promises/A+ spec</a>.</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">"bluebird"</span>),</span><br><span class="line">    assertDoesNotHappen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Should not happen'</span>);    </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Resolving-a-promise-calls-the-fulfil-function"><a href="#Resolving-a-promise-calls-the-fulfil-function" class="headerlink" title="Resolving a promise calls the fulfil function"></a>Resolving a promise calls the fulfil function</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Rejecting-a-promise-calls-the-reject-function"><a href="#Rejecting-a-promise-calls-the-reject-function" class="headerlink" title="Rejecting a promise calls the reject function"></a>Rejecting a promise calls the reject function</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    reject();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// called</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Chained-resolves-all-resolve-given-undefined-as-next-resolution"><a href="#Chained-resolves-all-resolve-given-undefined-as-next-resolution" class="headerlink" title="Chained resolves all resolve given undefined as next resolution"></a>Chained resolves all resolve given undefined as next resolution</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// called</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// called</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="If-any-fulfil-function-returns-a-value-the-next-then-is-resolved-with-it"><a href="#If-any-fulfil-function-returns-a-value-the-next-then-is-resolved-with-it" class="headerlink" title="If any fulfil function returns a value, the next then is resolved with it"></a>If any fulfil function returns a value, the next <code>then</code> is resolved with it</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1 gave '</span> + success);  <span class="comment">// 1 gave 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">6</span>;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2 gave '</span> + success);  <span class="comment">// 2 gave 6</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="If-any-fulfil-function-throws-an-error-the-subsequent-then-is-rejected"><a href="#If-any-fulfil-function-throws-an-error-the-subsequent-then-is-rejected" class="headerlink" title="If any fulfil function throws an error, the subsequent then is rejected"></a>If any fulfil function throws an error, the subsequent <code>then</code> is rejected</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="number">6</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error was'</span>, error);  <span class="comment">// error was (Error with a message 6)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="But-all-thens-after-that-are-resolved-because-the-reject-function-didn’t-fail"><a href="#But-all-thens-after-that-are-resolved-because-the-reject-function-didn’t-fail" class="headerlink" title="But all thens after that are resolved because the reject function didn’t fail"></a>But all <code>thens</code> after <em>that</em> are resolved because the reject function didn’t fail</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="number">6</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error was'</span>, error);  <span class="comment">// error was (Error with a message 6)</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'success was'</span>, success);  <span class="comment">// success was undefined</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>How is this reasonable?</p>
<h2 id="If-any-rejection-happens-along-the-chain-only-one-then-after-it-gets-rejected"><a href="#If-any-rejection-happens-along-the-chain-only-one-then-after-it-gets-rejected" class="headerlink" title="If any rejection happens along the chain, only one then after it gets rejected"></a>If any rejection happens along the chain, only one <code>then</code> after it gets rejected</h2><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">new Promise(<span class="function"><span class="keyword">function</span> <span class="params">(resolve, reject)</span> &#123;</span></span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(success)</span> &#123;</span></span><br><span class="line">    <span class="keyword">return</span> new Promise(<span class="function"><span class="keyword">function</span> <span class="params">(resolve, reject)</span> &#123;</span></span><br><span class="line">        reject(<span class="number">6</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(success)</span> &#123;</span></span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">'error was'</span>, <span class="built_in">error</span>);  <span class="comment">// error was 6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(success)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">'success was'</span>, success);  <span class="comment">// success was 7</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">error</span> was <span class="number">6</span></span><br><span class="line">success was <span class="number">7</span></span><br></pre></td></tr></table></figure>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-Writing-Fast-JavaScript" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Writing-Fast-JavaScript/" class="article-date">
  <time datetime="2016-06-22T18:04:54.000Z" itemprop="datePublished">2016-06-22</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Writing-Fast-JavaScript/">Writing Fast JavaScript</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>As a JavaScript user of one of the companies you may or may not have heard of, I am scheduled to give a talk about writing fast and maintainable JavaScript, perhaps by reading off this blog post.<br>However, as many of us may know, <a href="https://www.w3.org/community/webed/wiki/A_Short_History_of_JavaScript" target="_blank" rel="external">JS was created by Brendan Eich in ten days</a>, meant to move monkeys around on the screen (even <a href="https://brendaneich.com/2011/06/new-javascript-engine-module-owner/" target="_blank" rel="external">he said it himself</a>, so you know it’s legit), it is impossible even for a god like Eich to have his cake and eat it too.</p>
<p>This post addresses the <em>fast</em> part of writing fast and maintainable JavaScript.</p>
<h1 id="quot-use-strict-quot"><a href="#quot-use-strict-quot" class="headerlink" title="&quot;use strict&quot;"></a><code>&quot;use strict&quot;</code></h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode" target="_blank" rel="external">Using <code>&quot;use strict&quot;</code> removes many run-time checks that would otherwise have considerable performance cost</a>:</p>
<blockquote>
<p>A few strict mode tweaks, plus requiring that user-submitted JavaScript be strict mode code and that it be invoked in a certain manner, substantially reduce the need for those runtime checks.</p>
</blockquote>
<p>This is also one of the few tips here that actually make the code more maintainable, though not by much.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><p>Function declarations are faster than function expressions. <a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a> Function declarations are compiled ahead of time.<br>In other words, named functions are faster than anonymous functions. Unless you waste your time assigning a declaration to an expression again.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"><span class="comment">// Don't</span></span><br><span class="line"><span class="keyword">var</span> foo2 = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// Waste of everyone's time</span></span><br><span class="line"><span class="keyword">var</span> foo4 = <span class="function"><span class="keyword">function</span> <span class="title">foo3</span><span class="params">()</span> </span>&#123;&#125;  <span class="comment">// Quiz 1 (answer below)</span></span><br></pre></td></tr></table></figure>
<p><strong>Quiz 2</strong>: How do you write a declared function in CoffeeScript?</p>
<h2 id="Avoid-Closures"><a href="#Avoid-Closures" class="headerlink" title="Avoid Closures"></a>Avoid Closures</h2><p>Unless you have a reason to, <a href="https://jslinterrors.com/dont-make-functions-within-a-loop" target="_blank" rel="external">avoid making functions</a> or <a href="http://stackoverflow.com/questions/8228281/what-is-the-function-construct-in-javascript" target="_blank" rel="external">IIFEs</a>, especially in a loop.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// Do</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Don't, unless you have a reason to</span></span><br><span class="line">    &#125;());</span><br><span class="line">    </span><br><span class="line">    dom.addEvent(eventHandler);  <span class="comment">// Do</span></span><br><span class="line">    </span><br><span class="line">    dom.addEvent(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Don't    </span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Similarly-avoid-nesting-functions"><a href="#Similarly-avoid-nesting-functions" class="headerlink" title="Similarly, avoid nesting functions"></a>Similarly, avoid nesting functions</h2><p>Even if you use function declarations like this post said earlier, it doesn’t mean much if you do <em>a lot</em> in those function declarations. For example, if you call a function like this:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar3</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://reaktor.com/blog/javascript-performance-fundamentals-make-bluebird-fast/" target="_blank" rel="external">Separate instances of <code>bar1</code>, <code>bar2</code>, and <code>bar3</code> will be created every time <code>foo()</code> is called, whether of not those functions are used at all</a>. So, to write perfectly fast code, you should write:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar3</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(Sometimes, this is not possible.)</p>
<h2 id="Avoid-arguments"><a href="#Avoid-arguments" class="headerlink" title="Avoid arguments"></a>Avoid <code>arguments</code></h2><p><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#2-unsupported-syntax" target="_blank" rel="external">Using arguments improperly</a> may render a function unoptimisable. Assigning a value to any arguments where a function uses <code>arguments</code> will stop optimisation:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        b = <span class="number">5</span>;  <span class="comment">// Don't (modify an argument when you are in an argument condition)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>An easy way to work around this is to assign it elsewhere:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b2 = b;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        b2 = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(But how about just not modifying the argument in the first place, you degenerate?)</p>
<p>###</p>
<h2 id="Don’t-be-clever"><a href="#Don’t-be-clever" class="headerlink" title="Don’t be clever"></a>Don’t be clever</h2><p>If you <a href="http://stackoverflow.com/a/23925102/1558430" target="_blank" rel="external">try to be clever</a>, <a href="https://github.com/twbs/bootstrap/issues/3057#issuecomment-5135512" target="_blank" rel="external">Crockford will kill you.</a> These are function expressions turned into IIFEs through forced evaluation:</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Don't</span></span><br><span class="line">!<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span>  <span class="comment">// =&gt; true</span></span><br><span class="line">~<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span> <span class="comment">// =&gt; -1</span></span><br><span class="line">+<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span> <span class="comment">// =&gt; NaN</span></span><br><span class="line">-<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span>  <span class="comment">// =&gt; NaN</span></span><br></pre></td></tr></table></figure>
<p>Doing these stupid things, as opposed to using a conventional IIFE, has no performance gains.</p>
<p><strong>Quiz 3</strong>: What does CoffeeScript turn this into?</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">foo</span> = <span class="params">()</span> -&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h2><p>Don’t be clever. Each recursion introduces a stack. The higher the stack, the slower the function.<br><a href="http://stackoverflow.com/questions/23260390/node-js-tail-call-optimization-possible-or-not" target="_blank" rel="external">Don’t rely on TCO. As of now, pretend it does not exist.</a></p>
<h2 id="Prototypes"><a href="#Prototypes" class="headerlink" title="Prototypes"></a>Prototypes</h2><p>To be fast, you have to be ugly. <a href="https://developers.google.com/speed/articles/optimizing-javascript" target="_blank" rel="external">Prototypes are best put outside the constructor.</a> </p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do</span></span><br><span class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">Bar.prototype.foo = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don't</span></span><br><span class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.foo = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Avoid-calling-the-same-function-with-multiple-types-of-arguments"><a href="#Avoid-calling-the-same-function-with-multiple-types-of-arguments" class="headerlink" title="Avoid calling the same function with multiple types of arguments"></a><a href="http://mythbusters.js.org/v8-tips/monomorphic.html" target="_blank" rel="external">Avoid calling the same function with multiple types of arguments</a></h2><p>Consider a function <code>add()</code>:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">add</span> (x, y) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">x</span> + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you call <code>add(1, 2)</code> and <code>add(3, 4)</code>, the same function is used.<br>If you then call <code>add(&#39;a&#39;, &#39;b&#39;)</code>, then “the + in add becomes polymorphic”, which hurts performance.</p>
<h1 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h1><h2 id="Avoid-Classes"><a href="#Avoid-Classes" class="headerlink" title="Avoid Classes"></a>Avoid Classes</h2><p>Classes are currently transpiled into simple functions, even in V8 itself. They are syntactic sugar, currently with no performance benefits. It is best to avoid classes for now.</p>
<h2 id="Don’t-assign-random-attributes-to-instances"><a href="#Don’t-assign-random-attributes-to-instances" class="headerlink" title="Don’t assign random attributes to instances"></a>Don’t assign random attributes to instances</h2><p>Apparently, if you assign an unknown attribute to a class with a list of known attributes on construction, then <a href="http://www.html5rocks.com/en/tutorials/speed/v8/" target="_blank" rel="external">the classes diverge</a>, taking time:</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    constructor (x, y) &#123;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="type">Point</span>(<span class="number">11</span>, <span class="number">22</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="type">Point</span>(<span class="number">33</span>, <span class="number">44</span>);</span><br><span class="line"><span class="comment">// At this point, p1 and p2 have a shared hidden class</span></span><br><span class="line">p2.z = <span class="number">55</span>;</span><br><span class="line"><span class="comment">// warning! p1 and p2 now have different hidden classes!</span></span><br></pre></td></tr></table></figure>
<h1 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h1><h2 id="Don’t-use-global-variables"><a href="#Don’t-use-global-variables" class="headerlink" title="Don’t use global variables"></a>Don’t use global variables</h2><p>Global variables are never garbage-collected.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> WILLET = &#123; ... &#125;;  <span class="comment">// No</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Start of module</span></span><br><span class="line"><span class="keyword">var</span> PAYMENTS = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// No</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start of module</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">         <span class="comment">// Yes</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<h2 id="Place-variables-in-the-innermost-scope"><a href="#Place-variables-in-the-innermost-scope" class="headerlink" title="Place variables in the innermost scope"></a>Place variables in the innermost scope</h2><p><img src="/image/js4_0401.gif" alt=""></p>
<p>Declaring variables where they are needed helps with garbage collection. <a href="http://archive.oreilly.com/pub/a/server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html" target="_blank" rel="external">Variable read time is also faster.</a> (The term may be <a href="http://docstore.mik.ua/orelly/webprog/jscript/ch04_07.htm" target="_blank" rel="external">“variable scope resolution”</a>.)</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">function</span> () &#123;</span><br><span class="line">    (<span class="name">function</span> () &#123;</span><br><span class="line">        var i = <span class="number">0</span><span class="comment">;  // Do</span></span><br><span class="line">        i++;</span><br><span class="line">        console.log(<span class="name">i</span>)<span class="comment">;</span></span><br><span class="line">    &#125;())<span class="comment">;</span></span><br><span class="line">&#125;())<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">(<span class="name">function</span> () &#123;</span><br><span class="line">    var i = <span class="number">0</span><span class="comment">;  // Don't</span></span><br><span class="line">    (<span class="name">function</span> () &#123;</span><br><span class="line">        i++;</span><br><span class="line">        console.log(<span class="name">i</span>)<span class="comment">;</span></span><br><span class="line">    &#125;())<span class="comment">;</span></span><br><span class="line">&#125;())<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>Well, that is the theory, anyway. If you leak any of your variables through events and callbacks, then none of the scopes are garbage collected.</p>
<h2 id="Don’t-use-delete"><a href="#Don’t-use-delete" class="headerlink" title="Don’t use delete"></a>Don’t use <code>delete</code></h2><p><code>delete</code> does nothing useful related to memory in JavaScript.</p>
<h2 id="foo-null-does-nothing"><a href="#foo-null-does-nothing" class="headerlink" title="foo = null does nothing"></a><code>foo = null</code> does nothing</h2><p>Do not assign <code>null</code> to any variable with the intention of allowing it to be garbage-collected. If the variable is no longer accessible in any scope, it will be garbage collected automatically.</p>
<h2 id="Compare-with-the-fastest-possible-operator"><a href="#Compare-with-the-fastest-possible-operator" class="headerlink" title="Compare with the fastest possible operator"></a><a href="http://mythbusters.js.org/workflow/boolean-conditions.html" target="_blank" rel="external">Compare with the fastest possible operator</a></h2><p>Since this is about speed, choose whichever one you want here.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span>.length === <span class="number">0</span>  <span class="comment">// faster</span></span><br><span class="line"><span class="built_in">array</span>.length &lt;= <span class="number">0</span>  <span class="comment">// slower</span></span><br></pre></td></tr></table></figure>
<h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p>Arrays are actually objects, so using them does not save you any memory. However, <a href="https://www.smashingmagazine.com/2012/11/writing-fast-memory-efficient-javascript/" target="_blank" rel="external">there are speed differences how an array is constructed</a>:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];  <span class="comment">// Do</span></span><br><span class="line"></span><br><span class="line">var b = new Array();  <span class="comment">// Don't</span></span><br><span class="line">b.push(<span class="number">1</span>);</span><br><span class="line">b.push(<span class="number">2</span>);</span><br><span class="line">b.push(<span class="number">3</span>);</span><br><span class="line">b.push(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">var c = new Array(<span class="number">4</span>);  <span class="comment">// Don't do pre-allocate for large numbers</span></span><br><span class="line">c.push(<span class="number">1</span>);</span><br><span class="line">c.push(<span class="number">2</span>);</span><br><span class="line">c.push(<span class="number">3</span>);</span><br><span class="line">c.push(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<p>Defined array literals can also help the compiler understand when not to optimise one:</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var<span class="built_in"> array </span>= [ 77, 88, 0.5, true ]  // Do</span><br><span class="line"></span><br><span class="line">var<span class="built_in"> array </span>= []</span><br><span class="line">array[0] = 77</span><br><span class="line">array[1] = 88</span><br><span class="line">array[2] = 0.5  // I thought this was supposed to be an<span class="built_in"> array </span>of integers, oh no. Will convert entire<span class="built_in"> array </span>to a more generic Number array</span><br><span class="line">array[3] = true // I thought this was supposed to be an<span class="built_in"> array </span>of integers, oh no. Will convert entire<span class="built_in"> array </span>to a more generic Object array</span><br></pre></td></tr></table></figure>
<h3 id="Don’t-muck-about-with-Arrays"><a href="#Don’t-muck-about-with-Arrays" class="headerlink" title="Don’t muck about with Arrays"></a>Don’t muck about with Arrays</h3><p>If an array has something other than <code>0</code> as its first key, its speed is 2x slower:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = [];</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">1</span>;  <span class="comment">// Ok</span></span><br><span class="line"></span><br><span class="line">var b = [];</span><br><span class="line">b[<span class="number">1</span>] = <span class="number">1</span>;  <span class="comment">// No, start with 0</span></span><br><span class="line">b['foo'] = <span class="number">1</span>;  <span class="comment">// No</span></span><br></pre></td></tr></table></figure>
<h3 id="Don’t-pre-allocate-large-Arrays"><a href="#Don’t-pre-allocate-large-Arrays" class="headerlink" title="Don’t pre-allocate large Arrays"></a>Don’t pre-allocate large Arrays</h3><p>Pre-allocating an array more than 64k elements is a waste of time.</p>
<h3 id="shift-is-slower-than-pop"><a href="#shift-is-slower-than-pop" class="headerlink" title="shift is slower than pop"></a><a href="http://mythbusters.js.org/array/pop-or-shift.html" target="_blank" rel="external"><code>shift</code> is slower than <code>pop</code></a></h3><p><code>pop()</code> simply subtracts 1 from the array’s length, making it a lot faster than <code>shift()</code>, which causes all array items to be readdressed.</p>
<h2 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h2><p><code>foo.bar</code> is faster than <code>foo[&#39;bar&#39;]</code>, but <a href="http://www.slideshare.net/nzakas/writing-efficient-javascript/44-It_doesnt_matter" target="_blank" rel="external">only in Safari</a>.</p>
<p>Since access takes time, retain your references:</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do</span></span><br><span class="line">var a = foo.<span class="built_in">bar</span>.baz.a,</span><br><span class="line">    b = foo.<span class="built_in">bar</span>.baz.b;</span><br><span class="line">foo(a, b, a, b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don't</span></span><br><span class="line">foo(foo.<span class="built_in">bar</span>.baz.a, foo.<span class="built_in">bar</span>.baz.b, foo.<span class="built_in">bar</span>.baz.a, foo.<span class="built_in">bar</span>.baz.b);</span><br></pre></td></tr></table></figure>
<h2 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h2><p>Always <code>throw new Error(&#39;a string&#39;)</code>.</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Error</span>(<span class="comment">'a string')  // Do</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">Error</span>(<span class="comment">'a string')  // Avoid</span></span><br><span class="line"><span class="keyword">throw</span> <span class="comment">'a string'  // Don't</span></span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/a/11502074/1558430" target="_blank" rel="external">Don’t just <code>throw Error(&#39;a string&#39;)</code>, or <code>throw &#39;a string&#39;</code>.</a> The former is just for consistency, but the second one is unforgivable. Errors have <code>.message</code>; strings don’t.<br>Of course, because this is JavaScript we are talking about, <a href="http://jsperf.com/throw-error-vs-string-perf/4" target="_blank" rel="external">throwing a string is faster than throwing Error objects.</a></p>
<h1 id="Flow-control"><a href="#Flow-control" class="headerlink" title="Flow control"></a>Flow control</h1><h2 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h2><p>For the pure sake of being fast, <a href="http://archive.oreilly.com/pub/a/server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html" target="_blank" rel="external">follow these rules</a>, whenever the logic applies:</p>
<ul>
<li>Use <code>if</code> if there are no more than two conditions.</li>
<li>Use <code>switch</code> if there are between three to ten conditions. (See also: <a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#4-switch-case" target="_blank" rel="external">switches not optimisable beyond 128 branches in older engines</a>)</li>
<li>Use a map (key lookup) if there are more than ten conditions.</li>
</ul>
<h2 id="Loops"><a href="#Loops" class="headerlink" title="Loops"></a>Loops</h2><h3 id="For-loops"><a href="#For-loops" class="headerlink" title="For loops"></a>For loops</h3><p>For critical loops for which you know its bounds, consider unrolling them.</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">for <span class="comment">(var i = 0; i &lt; 10; i++)</span> &#123;</span><br><span class="line">    foo<span class="comment">(i)</span>;  <span class="comment">// Do</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo<span class="comment">(0)</span>;  <span class="comment">// Worth a shot</span></span><br><span class="line">foo<span class="comment">(1)</span>;</span><br><span class="line">foo<span class="comment">(2)</span>;</span><br><span class="line">foo<span class="comment">(3)</span>;</span><br><span class="line">foo<span class="comment">(4)</span>;</span><br><span class="line">foo<span class="comment">(5)</span>;</span><br><span class="line">foo<span class="comment">(6)</span>;</span><br><span class="line">foo<span class="comment">(7)</span>;</span><br><span class="line">foo<span class="comment">(8)</span>;</span><br><span class="line">foo<span class="comment">(9)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="Don’t-loop-backwards"><a href="#Don’t-loop-backwards" class="headerlink" title="Don’t loop backwards"></a><a href="https://gamealchemist.wordpress.com/2013/05/01/lets-get-those-javascript-arrays-to-work-fast/" target="_blank" rel="external">Don’t loop backwards</a></h4><p>According to <a href="https://gamealchemist.wordpress.com/2013/05/01/lets-get-those-javascript-arrays-to-work-fast/" target="_blank" rel="external">source 15</a>, although looping backwards (<code>while (i--)</code> sort of thing) saves two CPU instructions, it causes more branch misses than you would like.</p>
<h3 id="For-in"><a href="#For-in" class="headerlink" title="For-in"></a>For-in</h3><p>Avoid the <code>for-in</code> loop. Then again, sometimes you need the for-in loop. I am just here to tell you it is slow.</p>
<p><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#51-the-key-is-not-a-local-variable" target="_blank" rel="external">The <code>for-in</code> loop cannot be optimised by any JS engine if the key is not in the exact scope.</a> Take this, for example:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nonLocalKey1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;  <span class="comment">// key from outside</span></span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The solution is… not to use for-in loops.</p>
<h1 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h1><h2 id="Math"><a href="#Math" class="headerlink" title="Math"></a><code>Math</code></h2><p>Although technically not a library, <code>Math</code> is an object that can be very slow, depending on what you do with it.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.exp(<span class="number">1</span>)  <span class="comment">// Slow</span></span><br><span class="line"><span class="built_in">Math</span>.E  <span class="comment">// Fast</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.log(<span class="number">2</span>)  <span class="comment">// Slow</span></span><br><span class="line"><span class="built_in">Math</span>.LN2  <span class="comment">// Fast</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.floor(<span class="number">2.70</span>)  <span class="comment">// 2</span></span><br><span class="line">~~<span class="number">-2.70</span>  <span class="comment">// Fast floor for everything except NaN</span></span><br></pre></td></tr></table></figure>
<h2 id="Date"><a href="#Date" class="headerlink" title="Date"></a><code>Date</code></h2><p><code>Date.now()</code>, being a static method, is faster than <code>(new Date).getTime()</code>.</p>
<h2 id="Don’t-load-multiple-versions-of-the-same-library"><a href="#Don’t-load-multiple-versions-of-the-same-library" class="headerlink" title="Don’t load multiple versions of the same library"></a><strong>Don’t load multiple versions of the same library</strong></h2><p><a href="/2016/Ionic-2-seems-nice/">Browserify and Webpack <em>et al.</em></a> allow you to pack multiple libraries into your project, essentially doing this bullshit:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"foo.1.2.3.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"foo.1.2.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"foo.1.2.5.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>If you won’t do that yourself, why would you do it with Browserify? <a href="http://stackoverflow.com/questions/27931982/how-do-i-prevent-browserify-from-including-multiple-versions-of-sub-dependencies" target="_blank" rel="external">It comes with a dedupe thing that might or might not work</a>, and <code>npm dedupe</code> has a chance of breaking everything, so good luck with Ionic 2.</p>
<h2 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h2><p>jQuery is a great library that sorts everything out for you, from browser quirks, requests, promises, to animations without CSS. The cost of that is performance, so this post will recommend you not to use it.<br>If you must use jQuery, see if you need to support IE6, 7, and 8. If not, jQuery 3 took out the support code for them, making it faster than jQuery 1.x to run.</p>
<h2 id="Angular"><a href="#Angular" class="headerlink" title="Angular"></a>Angular</h2><h3 id="Avoid-using-useless-functions"><a href="#Avoid-using-useless-functions" class="headerlink" title="Avoid using useless functions"></a>Avoid using useless functions</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> thing === <span class="string">'undefined'</span>  <span class="comment">// Do</span></span><br><span class="line">thing === <span class="literal">undefined</span>  <span class="comment">// Better, if thing is a variable for sure</span></span><br><span class="line">angular.isUndefined(thing)  <span class="comment">// Don't</span></span><br></pre></td></tr></table></figure>
<h3 id="Consider-using-lightweight-functions-instead"><a href="#Consider-using-lightweight-functions-instead" class="headerlink" title="Consider using lightweight functions instead"></a>Consider using lightweight functions instead</h3><p>If you look at the <a href="https://github.com/angular/angular.js/blob/9360aa2d27fd4b35c377ecff3eea2a656ecf7114/src/Angular.js#L954" target="_blank" rel="external">angular source for <code>angular.equals</code></a>, you can see that it supports recursive comparison of objects and arrays, so this works:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">angular.equals(<span class="string">[[1], [2]]</span>, <span class="string">[[1], [2]]</span>)  // <span class="literal">true</span></span><br><span class="line"><span class="string">[[1], [2]]</span> == <span class="string">[[1], [2]]</span>  // <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>It also decides which dates, scopes, and functions are considered equal.</p>
<p>That is a valid use case for <code>angular.equals</code>. However, for any primitive data type, you should use <code>===</code> instead, saving even the function call.</p>
<h3 id="Don’t-use-watch"><a href="#Don’t-use-watch" class="headerlink" title="Don’t use $watch"></a>Don’t use <code>$watch</code></h3><p><code>$watch</code> is awful. It is virtually untestable, and it is inefficient as a way to do things. Here are some things you might have done with <code>$watch</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// No</span></span><br><span class="line">$scope.$watch(<span class="string">'something'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($scope.something === some state) &#123;</span><br><span class="line">        changeTheValueOf($scope.somethingElse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;div ng-<span class="keyword">if</span>=<span class="string">"somethingElse"</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Yes (this is a one-way digest)</span></span><br><span class="line">$scope.isSomethingElse = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $scope.something === some state;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;div ng-<span class="keyword">if</span>=<span class="string">"isSomethingElse()"</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// No</span></span><br><span class="line">$scope.$watch(<span class="string">'something'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $scope.somethingElse = foo($scope...);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Yes</span></span><br><span class="line">&lt;input ng-model=<span class="string">"something"</span> ng-change=<span class="string">"doFoo()"</span>&gt;&lt;...&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ng-bind-just-once"><a href="#ng-bind-just-once" class="headerlink" title="ng-bind just once"></a><code>ng-bind</code> just once</h3><p><a href="http://www.atatus.com/blog/lets-write-faster-angularjs-app/" target="_blank" rel="external"><code>::</code> mean “once” in AngularJS 1.3 and up.</a><br><a href="https://ng-perf.com/" target="_blank" rel="external"><code>ng-bind</code> is twice as fast as &#123;&#123;<code>expression</code>}}</a>. Use <code>ng-bind</code> instead.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Do --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind</span>=<span class="string">"::item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Don't --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&amp;#123;&amp;#123; ::item &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Do --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"item in ::items"</span> <span class="attr">ng-bind</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Place-methods-in-the-smallest-possible-“scope”"><a href="#Place-methods-in-the-smallest-possible-“scope”" class="headerlink" title="Place methods in the smallest possible “scope”"></a>Place methods in the smallest possible “scope”</h3><p>Don’t make “global” controller methods. They are both slow and hard to destroy.</p>
<h3 id="Disable-debugging"><a href="#Disable-debugging" class="headerlink" title="Disable debugging"></a>Disable debugging</h3><p><a href="https://www.toptal.com/angular-js/top-18-most-common-angularjs-developer-mistakes" target="_blank" rel="external">A common mistake that slows down the app.</a></p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$compileProvider.debugInfoEnabled(<span class="literal">false</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h3 id="Avoid-log"><a href="#Avoid-log" class="headerlink" title="Avoid $log"></a>Avoid <code>$log</code></h3><p>You may notice that, even if you set <code>debugInfoEnabled(false)</code>, that <code>adb logcat</code> still contains warnings and errors. Actual errors are cool and all, but <a href="http://stackoverflow.com/questions/12996129/memory-leak-when-logging-complex-objects" target="_blank" rel="external">if you log an object, it cannot be garbage-collected</a>. For this reason, avoid <code>$log</code>ging objects, or better, avoid logging useless things.</p>
<h2 id="Underscore-vs-Lodash"><a href="#Underscore-vs-Lodash" class="headerlink" title="Underscore vs Lodash"></a>Underscore vs Lodash</h2><p>Lodash is a larger, yet <a href="http://filimanjaro.com/blog/2014/introducing-lazy-evaluation/" target="_blank" rel="external">faster</a> fork of underscore. So, for faster code, use lodash.</p>
<h3 id="forEach-vs-each-vs-angular-forEach"><a href="#forEach-vs-each-vs-angular-forEach" class="headerlink" title="[].forEach vs _.each([]) vs angular.forEach([])"></a><code>[].forEach</code> vs <code>_.each([])</code> vs <code>angular.forEach([])</code></h3><p>You may find that <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" target="_blank" rel="external"><code>[].forEach</code> exists</a>. If you have no regard for browser compatibility, you may use it. Otherwise, <code>_.each</code> is faster than the other two, <a href="http://stackoverflow.com/a/18884620/1558430" target="_blank" rel="external">with caveats</a>.</p>
<h3 id="Lazy-evaluation"><a href="#Lazy-evaluation" class="headerlink" title="Lazy evaluation"></a><a href="http://filimanjaro.com/blog/2014/introducing-lazy-evaluation/" target="_blank" rel="external">Lazy evaluation</a></h3><p>Using lodash in a functional manner allows certain <code>map</code> and <code>filter</code> operations to be lazy-evaluated. It has some performance benefits when there is a <code>take()</code> involved.</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">_</span>(phoneNumbers).map(<span class="keyword">String</span>).filter(contains55).take(<span class="number">100</span>);  <span class="comment">// Do</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Don't</span></span><br><span class="line"><span class="literal">_</span>.take(<span class="literal">_</span>.each(phoneNumbers, <span class="function"><span class="keyword">function</span> </span>(phoneNumber) &#123;</span><br><span class="line">    <span class="keyword">if</span> (contains55(phoneNumber)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">String</span>(phoneNumber);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;), <span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Profiling"><a href="#Profiling" class="headerlink" title="Profiling"></a>Profiling</h1><p>Left for another post.</p>
<h2 id="Debuggers"><a href="#Debuggers" class="headerlink" title="Debuggers"></a>Debuggers</h2><h3 id="Don’t-leave-in-debugger-not-even-once"><a href="#Don’t-leave-in-debugger-not-even-once" class="headerlink" title="Don’t leave in debugger, not even once"></a>Don’t leave in <code>debugger</code>, not even once</h3><p>If you leave in <code>debugger;</code> somewhere in the function, even like this:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">debugger</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then <a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#2-unsupported-syntax" target="_blank" rel="external">V8 will not optimise the entire function</a>.</p>
<h1 id="Answers"><a href="#Answers" class="headerlink" title="Answers"></a>Answers</h1><h2 id="Quiz-1"><a href="#Quiz-1" class="headerlink" title="Quiz 1"></a>Quiz 1</h2><p>You can’t</p>
<h2 id="Quiz-2"><a href="#Quiz-2" class="headerlink" title="Quiz 2"></a>Quiz 2</h2><p><code>var foo4 = function foo3() {}</code> generates <code>foo3</code> and <code>foo4</code> that are both the same function, or in the case of IE (8 and under?), <a href="http://kiro.me/blog/nfe_dilemma.html" target="_blank" rel="external">two copies of the function</a> (<code>foo3 !== foo4</code>). </p>
<h2 id="Quiz-3"><a href="#Quiz-3" class="headerlink" title="Quiz 3"></a>Quiz 3</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo;</span><br><span class="line">foo = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-About-peerDependencies" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/About-peerDependencies/" class="article-date">
  <time datetime="2016-01-20T08:44:22.000Z" itemprop="datePublished">2016-01-20</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/About-peerDependencies/">About peerDependencies</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Peer dependencies express the relationship between a “plugin package”, such as <code>jquery-lazy</code>, and its host, <code>jquery</code>. If <code>jquery-lazy</code> claims it works with <code>jquery@&lt;2</code>, then installing it will also install a copy of <a href="mailto:`jquery@1.9" target="_blank" rel="external">`jquery@1.9</a>`.</p>
<h1 id="Fixing-peerDependencies-errors"><a href="#Fixing-peerDependencies-errors" class="headerlink" title="Fixing peerDependencies errors"></a>Fixing <code>peerDependencies</code> errors</h1><p>If you are installing a package, say, <a href="https://github.com/rossmartin/cordova-uglify" target="_blank" rel="external"><code>cordova-uglify</code></a>, and see this in npm 2:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm WARN peerDependencies The<span class="built_in"> peer </span>dependency uglify-js@2.4.14 included <span class="keyword">from</span> cordova-uglify will <span class="literal">no</span></span><br><span class="line">npm WARN peerDependencies longer be automatically installed <span class="keyword">to</span> fulfill the peerDependency</span><br><span class="line">npm WARN peerDependencies <span class="keyword">in</span> npm 3+. Your application will need <span class="keyword">to</span> depend on it explicitly.</span><br><span class="line">npm WARN peerDependencies The<span class="built_in"> peer </span>dependency ng-annotate@0.15.4 included <span class="keyword">from</span> cordova-uglify will <span class="literal">no</span></span><br><span class="line">npm WARN peerDependencies longer be automatically installed <span class="keyword">to</span> fulfill the peerDependency</span><br><span class="line">npm WARN peerDependencies <span class="keyword">in</span> npm 3+. Your application will need <span class="keyword">to</span> depend on it explicitly.</span><br><span class="line">npm WARN peerDependencies The<span class="built_in"> peer </span>dependency clean-css@2.2.2 included <span class="keyword">from</span> cordova-uglify will <span class="literal">no</span></span><br><span class="line">npm WARN peerDependencies longer be automatically installed <span class="keyword">to</span> fulfill the peerDependency</span><br><span class="line">npm WARN peerDependencies <span class="keyword">in</span> npm 3+. Your application will need <span class="keyword">to</span> depend on it explicitly.</span><br></pre></td></tr></table></figure>
<p>It is telling us that <code>cordova-uglify</code> (the package in your <code>package.json</code>) claims to be compatible with <a href="mailto:`uglify-js@2.4.14" target="_blank" rel="external">`uglify-js@2.4.14</a><code>,</code><a href="mailto:ng-annotate@0.15.4" target="_blank" rel="external">ng-annotate@0.15.4</a><code>, and</code><a href="mailto:clean-css@2.2.2" target="_blank" rel="external">clean-css@2.2.2</a>`, but your project does not install them.</p>
<p>The solution is to add these dependencies to your own <code>package.json</code>, or kindly ask your package maintainer to <a href="https://github.com/rossmartin/cordova-uglify/issues/16" target="_blank" rel="external">fix the problem</a>.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-CoffeeScript-is-superior-to-JavaScript" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2014/CoffeeScript-is-superior-to-JavaScript/" class="article-date">
  <time datetime="2014-08-19T19:23:49.000Z" itemprop="datePublished">2014-08-19</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2014/CoffeeScript-is-superior-to-JavaScript/">CoffeeScript Is Superior to JavaScript</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p><strong>CoffeeScript is superior to JavaScript and you know it.</strong></p>
<p><a href="http://en.wikipedia.org/wiki/Jeremy_Ashkenas" target="_blank" rel="external">Jeremy Ashkenas</a> brought <a href="http://en.wikipedia.org/wiki/CoffeeScript" target="_blank" rel="external">CoffeeScript</a> into this World to eliminate quirks in JavaScript, such as fuzzy comparison (amateur usages of the <code>==</code> operator) and <a href="http://stackoverflow.com/questions/444080/do-you-recommend-using-semicolons-after-every-statement-in-javascript" target="_blank" rel="external">optional semicolons</a>, which is very confusing for beginner JavaScript developers like you and me. Naturally, Mr. Ashkenas came up with a neat programming construct that helps the problem by introducing syntax that is simpler, more convenient, and clearer to read.</p>
<h2 id="Rationale"><a href="#Rationale" class="headerlink" title="Rationale"></a>Rationale</h2><p>Suppose you have an array</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]  # this is also [<span class="number">1.</span><span class="number">.5</span>], by the way! go CoffeeScript!</span><br></pre></td></tr></table></figure>
<p>You can write the same array <em>without</em> the commas that CoffeeScript hates.</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">array = [  # now this is a CoffeeScript array</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">    <span class="number">4</span></span><br><span class="line">    <span class="number">5</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Why stop there, we can have objects without commas:</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obj = &#123;</span><br><span class="line"><span class="symbol">    a:</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">    b:</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">    c:</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">    d:</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">    e:</span> <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>, which is no surprise. However, did you know:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obj = &#123;  <span class="comment"># not a SyntaxError</span></span><br><span class="line">    a</span><br><span class="line">    b</span><br><span class="line">    c</span><br><span class="line">    d</span><br><span class="line">    e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj = &#123;a, b, c, d, e&#125;  <span class="comment"># not a SyntaxError AND not a set!</span></span><br><span class="line"></span><br><span class="line">obj = &#123;a b c d e&#125;  <span class="comment"># not a thing</span></span><br></pre></td></tr></table></figure>
<p>Why stop there, we can remove the braces too, because who likes typing braces if you don’t have to?</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obj =</span><br><span class="line"><span class="symbol">    a:</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">    b:</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">    c:</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">    d:</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">    e:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>It’s all well and good until this one turned up</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obj =  <span class="comment"># unexpectedly, you can't omit things whenever you want</span></span><br><span class="line">    a</span><br><span class="line">    b</span><br><span class="line">    c</span><br><span class="line">    d</span><br><span class="line">    e</span><br></pre></td></tr></table></figure>
<p>And that is what makes CoffeeScript better for iterative development.</p>
<h2 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h2><h3 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise 1"></a>Exercise 1</h3><p>What is <code>result</code> for each of these three statements in CoffeeScript?</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="built_in"> array </span>= [1, 2, 3, 4, 5]</span><br><span class="line">&gt;</span><br><span class="line">&gt; result = (item for item in array)</span><br><span class="line">&gt; result = [item for item in array]</span><br><span class="line">&gt; result =  item for item in<span class="built_in"> array </span> <span class="comment"># thanks @ktsimpso</span></span><br></pre></td></tr></table></figure>
<p>The result is, <em>clearly</em> (exact word from Alex):</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">[Object]</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>
<h4 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">result</span> = (<span class="built_in">item</span> <span class="keyword">for</span> <span class="built_in">item</span> <span class="keyword">in</span> array) = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="literal">result</span> = [(<span class="built_in">item</span> <span class="keyword">for</span> <span class="built_in">item</span> <span class="keyword">in</span> array)] = [Object]</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">item</span> <span class="keyword">in</span> array</span><br><span class="line">    (<span class="literal">result</span> = <span class="built_in">item</span>) = <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h3 id="Exercise-2"><a href="#Exercise-2" class="headerlink" title="Exercise 2"></a>Exercise 2</h3><p>Whitespace matters in CoffeeScript. Tell me what these two compile to:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></span><br><span class="line"><span class="class">  <span class="title">constructor</span></span>: -&gt;</span><br><span class="line">    console.log <span class="meta">@c</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> <span class="keyword">extends</span> <span class="title">a</span></span></span><br><span class="line"><span class="class">  <span class="title">c</span> </span>= <span class="number">3</span></span><br><span class="line"></span><br><span class="line">b()</span><br></pre></td></tr></table></figure>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
    <article id="post-gulp-adventures" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2014/gulp-adventures/" class="article-date">
  <time datetime="2014-08-13T23:17:34.000Z" itemprop="datePublished">2014-08-13</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2014/gulp-adventures/">Gulp Adventures</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>I don’t actually know much about JavaScript development when it comes to npm, grunt, gulp, and volo. They all seemed like… things, to me. Do you have a webapp that handles your models, controllers, and views, but somehow you need static files to be generated using these new workflows, but have no idea how? That’s what I am going through! Here outlines my learnings.</p>
<h1 id="Always-specify-your-path"><a href="#Always-specify-your-path" class="headerlink" title="Always specify your path"></a>Always specify your path</h1><p>Before you do anything in your project, tell <code>npm</code> where to put your packages. This is done by running:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=node_modules/.bin:$&#123;PATH&#125;</span><br></pre></td></tr></table></figure>
<p>Alternatively, investigate in some sort of <a href="https://stackoverflow.com/questions/3653495/is-there-an-virtual-environment-for-node-js" target="_blank" rel="external">virtualenv</a>. If they worked the way Python’s virtualenv did, then it would be the way to go, but I have no success with them.</p>
<h1 id="Tell-npm-to-install-bower-components"><a href="#Tell-npm-to-install-bower-components" class="headerlink" title="Tell npm to install bower components"></a>Tell npm to install bower components</h1><p>The typical workflow consists of the following:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span></span><br><span class="line">bowser <span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<p>Don’t you think, why run the second command manually if <code>npm</code> could run it for me? That would be correct – this simple configuration in <code>package.json</code> will do the trick.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"postinstall"</span>: <span class="string">"bower install"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Install-almost-everything-with-save"><a href="#Install-almost-everything-with-save" class="headerlink" title="Install (almost) everything with --save"></a>Install (almost) everything with <code>--save</code></h1><p>Unlike <code>apt-get</code>, nothing you save with <code>npm</code> and <code>bower</code> will be available to your environment by default. To persist these packages across multiple developer machines, run <code>npm install</code> and <code>bower install</code> with the <code>--save</code> flag, which records the packages you installed into <code>package.json</code> and <code>bower.json</code>, respectively.</p>
<h1 id="Always-do-the-hippest-thing"><a href="#Always-do-the-hippest-thing" class="headerlink" title="Always do the hippest thing"></a>Always do the hippest thing</h1><p>Java has a reputation for having robust, tried-and-true methods for doing everything. Want to run a webapp? Install spring’s jars. Want to install a package? You will probably be using maven. However, in JavaScript development, everything is making a new flavour of everything, where no standard is made and/or obeyed. Ignoring the fact that no one has any idea what is going on, it is also apparent that the only way to stay afloat in the web development community is to use the most recent builds of everything, in order to shorten your dependency tree (example: if you need to use an older version of Backbone, then all other dependencies will install newer versions of Backbone alongside yours).</p>
<p>Never settle for Grunt, because Gulp exists. If Gulp has a newer alternative, then switch to it immediately. There is no such thing as resilience in this field – the only thing you need to do is to accept change.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">




  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="../../">&laquo; Prev</a><a class="page-number" href="../../">1</a><span class="page-number current">2</span><a class="page-number" href="../3/">3</a><a class="extend next" rel="next" href="../3/">Next &raquo;</a>
    </nav>
  

    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.ohai.ca">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2019 Brian<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="../../../../js/script.js"></script>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    var sc_project=4446854;
    var sc_invisible=0;
    var sc_security="74785e80";
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write(
      "<sc"+"ript type='text/javascript' src='" +
      scJsHost +
      "statcounter.com/counter/counter_xhtml.js'></" +
      "script>"
    );
    //]]>
  </script>
  <noscript>
    <img style="display: none"
         src="http://c.statcounter.com/4446854/0/74785e80/0/" />
  </noscript><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
