<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Tag: JavaScript | root&#39;s Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Why do you ask my name? It is beyond understanding.">
<meta property="og:type" content="website">
<meta property="og:title" content="root's Blog">
<meta property="og:url" content="http://blog.ohai.ca/tags/JavaScript/index.html">
<meta property="og:site_name" content="root's Blog">
<meta property="og:description" content="Why do you ask my name? It is beyond understanding.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="root's Blog">
<meta name="twitter:description" content="Why do you ask my name? It is beyond understanding.">
  
    <link rel="alternative" href="/atom.xml" title="root&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">root&#39;s Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ohai.ca"></form>
	</div>
</header>
    <div id="main">
      
  
    <article id="post-How-to-install-nodejs" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2019/How-to-install-nodejs/" class="article-date">
  <time datetime="2019-02-28T17:31:46.000Z" itemprop="datePublished">2019-02-28</time>
</a>
		</span>
		<span class="meta-elements author">root</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2019/How-to-install-nodejs/">How to Install Node.js</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>tl;dr: don’t install nodejs.</p>
<p>Here at Maymay Research Institute (MRI), we make things with JavaScript.</p>
<p>To run JavaScript outside a browser, chances are you will need something called <a href="https://nodejs.org/en/" target="_blank" rel="external">Node.js</a>.</p>
<p><a href="https://github.com/nodejs/node/pulls?q=is%3Apr+is%3Aclosed" target="_blank" rel="external">A change is made to Node.js every other day</a>, so as are the binaries. We joke that node and npm should simply be named after the unix timestamp.</p>
<pre><code>A: we should just version js packages by unix timestamp, because 
   there&apos;s a new one every other second
B: That would solve it.
A: that would actually work
A: `npm@1550873940.0.0  // because every change is breaking anyway, this is semver-compliant`
B: Oh my
</code></pre><p>While that was largely a joke, it is not far from the truth, and having so many versions of node and npm can cause problems on developer machines, namely this code review comment (paraphrased):</p>
<blockquote>
<p>There are packages that are built for each particular node distribution (node-sass for example), so when you and I (run) “yarn or npm install” (it will install) different binaries of the same package. … This leads to “On my computer (it) works” problems. (We) should manually enforce the version, and (upgrade) every once in a while if a new LTS version is available (…).</p>
</blockquote>
<p>The comment highlights the importance for all developers to run the exact same version of node and npm for a project. But how do we achieve that?</p>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>You can’t just throw everything at Docker, <del>man</del>person.</p>
<h2 id="nvm-use-specific-version"><a href="#nvm-use-specific-version" class="headerlink" title="nvm use ${specific version}"></a><code>nvm use ${specific version}</code></h2><p>The team can pin node to a specific version (and therefore the version of npm, as well). They do so by running</p>
<pre><code>nvm use v10.15.2
</code></pre><p>Normally I would call it a day, since <code>v10</code> would have been good enough for me, but since “This leads to “On my computer (it) works” problems”, we are going to have to pin it down.</p>
<h2 id="Where-do-these-node-versions-come-from"><a href="#Where-do-these-node-versions-come-from" class="headerlink" title="Where do these node versions come from?"></a>Where do these node versions come from?</h2><p>Nodejs has <a href="https://github.com/nodejs/node" target="_blank" rel="external">its own repository on GitHub</a>, but they don’t provide binaries there. Instead, according to the command that <code>nvm</code> runs:</p>
<pre><code>bash -c &quot;NVM_DIR=$HOME/.nvm &amp;&amp; source $NVM_DIR/nvm.sh  &amp;&amp; NVM_NODEJS_ORG_MIRROR=https://nodejs.org/dist nvm install vx.y.z &amp;&amp; nvm use vx.y.z &amp;&amp; export &gt; env.txt&quot;
</code></pre><p>The binaries come from <a href="https://nodejs.org/dist/" target="_blank" rel="external">https://nodejs.org/dist/</a>. In particular, these are the directories we are concerned about:</p>
<pre><code>https://nodejs.org/dist/v10.15.1/
https://nodejs.org/dist/v10.15.2/
https://nodejs.org/dist/v10.15.3/
</code></pre><p>And they all have SHA 256 checksums for everything you download (assuming you verify them).</p>
<pre><code>https://nodejs.org/dist/v10.15.1/SHASUMS256.txt
https://nodejs.org/dist/v10.15.2/SHASUMS256.txt
https://nodejs.org/dist/v10.15.3/SHASUMS256.txt
</code></pre><p>That’s all well and good. Having SHA 256 allows team members to verify that we downloaded <em>the same version of node</em> from the repository. But wait… </p>
<h2 id="How-do-you-know-their-v10-15-2-is-GitHub’s-v10-15-2"><a href="#How-do-you-know-their-v10-15-2-is-GitHub’s-v10-15-2" class="headerlink" title="How do you know their v10.15.2 is GitHub’s v10.15.2?"></a>How do you know their v10.15.2 is GitHub’s v10.15.2?</h2><p>Surely anyone who hacked <a href="https://nodejs.org/" target="_blank" rel="external">https://nodejs.org/</a> could have replaced <code>https://nodejs.org/dist/v10.15.2/SHASUMS256.txt</code>, <code>https://nodejs.org/dist/v10.15.2/SHASUMS256.txt.asc</code>, <code>https://nodejs.org/dist/v10.15.2/SHASUMS256.txt.sig</code>, and <code>https://nodejs.org/dist/v10.15.2/node-v10.15.2-linux-arm64.tar.gz</code> so you download a hijacked binary. Even if you try to <a href="https://serverfault.com/questions/896228/how-to-verify-a-file-using-an-asc-signature-file" target="_blank" rel="external">verify the GPG signature</a> with <a href="https://github.com/nodejs/node/#verifying-binaries" target="_blank" rel="external">the key displayed in the repository</a>, anyone working for nodejs could have compiled the same version twice. If that happens, you and I may be running different <code>node</code> binaries that both declare themselves to be <code>v10.15.2</code>.</p>
<h2 id="How-do-you-know-you-are-running-GitHub’s-v10-15-2"><a href="#How-do-you-know-you-are-running-GitHub’s-v10-15-2" class="headerlink" title="How do you know you are running GitHub’s v10.15.2?"></a>How do you know <em>you</em> are running GitHub’s v10.15.2?</h2><p>You download from <a href="https://nodejs.org/dist/v10.15.2/" target="_blank" rel="external">https://nodejs.org/dist/v10.15.2/</a>; it does not mean what you download corresponds to <a href="https://github.com/nodejs/node/tree/v10.15.2" target="_blank" rel="external">https://github.com/nodejs/node/tree/v10.15.2</a>. The reasoning is twofold. First, anyone who provides node binaries can compile any code with the version changed to v10.15.2. So you have to trust them. Second, <a href="https://github.com/nodejs/node/commit/7e530ce306792f060f2316345465af72b8ff5f0c" target="_blank" rel="external">the commit that made v10.15.2 was not signed</a>, whereas the ones for <a href="https://github.com/nodejs/node/commit/297c9d1aa9dd97692a33e9c1e863ea9d053c6d58" target="_blank" rel="external">v10.15.1</a> and <a href="https://github.com/nodejs/node/commit/1a96d83a223ff9f05f7d942fb84440d323f7b596" target="_blank" rel="external">v10.15.3</a> are signed with valid GPG keys. This means, no matter how small the probability is, <code>v10.15.2</code> can be moved without anyone knowing, and projects that use version <code>v10.15.2</code> can potentially get a binary that is different eventually.</p>
<h2 id="What-if-everyone-compiles-their-own-v10-15-3-then"><a href="#What-if-everyone-compiles-their-own-v10-15-3-then" class="headerlink" title="What if everyone compiles their own v10.15.3, then?"></a>What if everyone compiles their own <code>v10.15.3</code>, then?</h2><p>(<code>v10.15.3</code> is a signed commit.) Well that’s not good enough either. <a href="https://github.com/BethGriggs" target="_blank" rel="external">BethGriggs</a> can move <a href="https://github.com/nodejs/node/tree/v10.15.3" target="_blank" rel="external"><code>v10.15.3</code></a> and sign the commit again, resulting in a signed <code>v10.15.3</code> tag that points to a different commit.</p>
<p>But if you pin your node version to <a href="https://github.com/nodejs/node/commit/1a96d83a223ff9f05f7d942fb84440d323f7b596" target="_blank" rel="external">a signed commit hash</a> (1a96d83a223ff9f05f7d942fb84440d323f7b596), clone it, and then <em>compile it yourself</em>, you can be sure everyone on your team gets the same <code>v10.15.3</code> binary, then?</p>
<p>Guess what! The answer is no! <a href="https://github.com/nodejs/node/blob/master/BUILDING.md#prerequisites" target="_blank" rel="external">You can mess with compiler flags!</a></p>
<h2 id="What-works"><a href="#What-works" class="headerlink" title="What works?"></a>What works?</h2><p>One person on the team should be responsible for compiling node and npm binaries. Then that person signs these binaries and publishes both the binaries and signatures to an internal repository.</p>
<p>Afterwards, all other team members install nodejs using the command</p>
<pre><code>bash -c &quot;NVM_DIR=$HOME/.nvm &amp;&amp; source $NVM_DIR/nvm.sh  &amp;&amp; NVM_NODEJS_ORG_MIRROR=(your team repository) nvm install vx.y.z &amp;&amp; nvm use vx.y.z &amp;&amp; export &gt; env.txt&quot;
</code></pre><p>When you and your team members all install signed binaries from a known source, you can all be sure you have the same binary.</p>
<p>It doesn’t mean the binaries are trustworthy, though. Your team member could have spiked the source with special source before compiling it. That requires <em>you</em> to compile the binary yourself, and <a href="https://wiki.mozilla.org/Security/Binary_Transparency" target="_blank" rel="external">verify that the build is reproducible</a> on your end. Nodejs builds are <a href="https://github.com/nodejs/build/issues/589" target="_blank" rel="external">not reproducible</a>, as far as I know.</p>
<p>In conclusion: <strong>nothing works</strong>. There is always something wrong. Your teammates don’t trust you. Become a farmer. Live off the grid. Lawyer up.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Ionic-2-seems-nice" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Ionic-2-seems-nice/" class="article-date">
  <time datetime="2016-08-05T21:10:49.000Z" itemprop="datePublished">2016-08-05</time>
</a>
		</span>
		<span class="meta-elements author">root</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Ionic-2-seems-nice/">Ionic 2 Seems Nice</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>aka: <a href="https://medium.com/@wob/the-sad-state-of-web-development-1603a861d29f#.q319fwrt8" target="_blank" rel="external">The sad state of web development</a></p>
<p>As part of my investigation to get Google Maps working with an unexploitable API key (hint: <a href="http://stackoverflow.com/questions/38058711/free-google-maps-api-for-hybrid-applications" target="_blank" rel="external">it’s not that easy</a>), I set out my journey to <a href="https://github.com/mapsplugin/cordova-plugin-googlemaps" target="_blank" rel="external">plugins</a> and <a href="http://ionicframework.com/docs/v2/native/google-maps/" target="_blank" rel="external">frameworks</a>, eventually ending up on <a href="http://ionicframework.com/docs/v2/getting-started/installation/" target="_blank" rel="external">the ionic2 installation page</a>, where the project looks mature enough to use.</p>
<p>So, I set up my spanking new ionic project using their own code:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install </span>-g ionic@<span class="keyword">beta</span></span><br><span class="line"><span class="keyword">ionic </span>start foo --v2  <span class="comment"># You will error here</span></span><br><span class="line">cd foo</span><br><span class="line">ionic serve</span><br><span class="line">ionic platform <span class="keyword">add </span><span class="keyword">android</span></span><br><span class="line"><span class="keyword">ionic </span><span class="keyword">build </span><span class="keyword">android </span>--release</span><br><span class="line">adb <span class="keyword">install </span>-r thing.apk</span><br></pre></td></tr></table></figure>
<p>The app took, oh, I don’t know, <strong>9 seconds</strong> to start. (Later diagnosis reveals Cordova taking 3 seconds alone, and all <a href="http://stackoverflow.com/questions/28090053/how-to-remove-crosswalk-from-a-cordova-project" target="_blank" rel="external">Crosswalk</a> did for Android 5+ was add bulk to the apk, which is expected behaviour.)<br>The app used 150MB of my Nexus 4’s memory.<br>The app contained a 3-Megabyte <code>app.bundle.js</code>, none of which was readable code.</p>
<p>Seems like a nice new platform to get my hands dirty.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Flattening-Promise-Chains-by-Example" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Flattening-Promise-Chains-by-Example/" class="article-date">
  <time datetime="2016-07-08T19:35:18.000Z" itemprop="datePublished">2016-07-08</time>
</a>
		</span>
		<span class="meta-elements author">root</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Flattening-Promise-Chains-by-Example/">Flattening Promise Chains by Example</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>For all intents and purposes, these examples use <a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="external"><code>bluebird</code></a>, a library that passes the <a href="https://promisesaplus.com/" target="_blank" rel="external">Promises/A+ spec</a>.</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">"bluebird"</span>),</span><br><span class="line">    assertDoesNotHappen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Should not happen'</span>);    </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Resolving-a-promise-calls-the-fulfil-function"><a href="#Resolving-a-promise-calls-the-fulfil-function" class="headerlink" title="Resolving a promise calls the fulfil function"></a>Resolving a promise calls the fulfil function</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Rejecting-a-promise-calls-the-reject-function"><a href="#Rejecting-a-promise-calls-the-reject-function" class="headerlink" title="Rejecting a promise calls the reject function"></a>Rejecting a promise calls the reject function</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    reject();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// called</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Chained-resolves-all-resolve-given-undefined-as-next-resolution"><a href="#Chained-resolves-all-resolve-given-undefined-as-next-resolution" class="headerlink" title="Chained resolves all resolve given undefined as next resolution"></a>Chained resolves all resolve given undefined as next resolution</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// called</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// called</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="If-any-fulfil-function-returns-a-value-the-next-then-is-resolved-with-it"><a href="#If-any-fulfil-function-returns-a-value-the-next-then-is-resolved-with-it" class="headerlink" title="If any fulfil function returns a value, the next then is resolved with it"></a>If any fulfil function returns a value, the next <code>then</code> is resolved with it</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1 gave '</span> + success);  <span class="comment">// 1 gave 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">6</span>;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2 gave '</span> + success);  <span class="comment">// 2 gave 6</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="If-any-fulfil-function-throws-an-error-the-subsequent-then-is-rejected"><a href="#If-any-fulfil-function-throws-an-error-the-subsequent-then-is-rejected" class="headerlink" title="If any fulfil function throws an error, the subsequent then is rejected"></a>If any fulfil function throws an error, the subsequent <code>then</code> is rejected</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="number">6</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error was'</span>, error);  <span class="comment">// error was (Error with a message 6)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="But-all-thens-after-that-are-resolved-because-the-reject-function-didn’t-fail"><a href="#But-all-thens-after-that-are-resolved-because-the-reject-function-didn’t-fail" class="headerlink" title="But all thens after that are resolved because the reject function didn’t fail"></a>But all <code>thens</code> after <em>that</em> are resolved because the reject function didn’t fail</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="number">6</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error was'</span>, error);  <span class="comment">// error was (Error with a message 6)</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'success was'</span>, success);  <span class="comment">// success was undefined</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>How is this reasonable?</p>
<h2 id="If-any-rejection-happens-along-the-chain-only-one-then-after-it-gets-rejected"><a href="#If-any-rejection-happens-along-the-chain-only-one-then-after-it-gets-rejected" class="headerlink" title="If any rejection happens along the chain, only one then after it gets rejected"></a>If any rejection happens along the chain, only one <code>then</code> after it gets rejected</h2><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">new Promise(<span class="function"><span class="keyword">function</span> <span class="params">(resolve, reject)</span> &#123;</span></span><br><span class="line">    resolve(<span class="number">5</span>);</span><br><span class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(success)</span> &#123;</span></span><br><span class="line">    <span class="keyword">return</span> new Promise(<span class="function"><span class="keyword">function</span> <span class="params">(resolve, reject)</span> &#123;</span></span><br><span class="line">        reject(<span class="number">6</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(success)</span> &#123;</span></span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">'error was'</span>, <span class="built_in">error</span>);  <span class="comment">// error was 6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(success)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">'success was'</span>, success);  <span class="comment">// success was 7</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    <span class="comment">// not called</span></span><br><span class="line">    assertDoesNotHappen();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">error</span> was <span class="number">6</span></span><br><span class="line">success was <span class="number">7</span></span><br></pre></td></tr></table></figure>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Writing-Fast-JavaScript" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Writing-Fast-JavaScript/" class="article-date">
  <time datetime="2016-06-22T18:04:54.000Z" itemprop="datePublished">2016-06-22</time>
</a>
		</span>
		<span class="meta-elements author">root</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Writing-Fast-JavaScript/">Writing Fast JavaScript</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>As a JavaScript user of one of the companies you may or may not have heard of, I am scheduled to give a talk about writing fast and maintainable JavaScript, perhaps by reading off this blog post.<br>However, as many of us may know, <a href="https://www.w3.org/community/webed/wiki/A_Short_History_of_JavaScript" target="_blank" rel="external">JS was created by Brendan Eich in ten days</a>, meant to move monkeys around on the screen (even <a href="https://brendaneich.com/2011/06/new-javascript-engine-module-owner/" target="_blank" rel="external">he said it himself</a>, so you know it’s legit), it is impossible even for a god like Eich to have his cake and eat it too.</p>
<p>This post addresses the <em>fast</em> part of writing fast and maintainable JavaScript.</p>
<h1 id="quot-use-strict-quot"><a href="#quot-use-strict-quot" class="headerlink" title="&quot;use strict&quot;"></a><code>&quot;use strict&quot;</code></h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode" target="_blank" rel="external">Using <code>&quot;use strict&quot;</code> removes many run-time checks that would otherwise have considerable performance cost</a>:</p>
<blockquote>
<p>A few strict mode tweaks, plus requiring that user-submitted JavaScript be strict mode code and that it be invoked in a certain manner, substantially reduce the need for those runtime checks.</p>
</blockquote>
<p>This is also one of the few tips here that actually make the code more maintainable, though not by much.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><p>Function declarations are faster than function expressions. <a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a> Function declarations are compiled ahead of time.<br>In other words, named functions are faster than anonymous functions. Unless you waste your time assigning a declaration to an expression again.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"><span class="comment">// Don't</span></span><br><span class="line"><span class="keyword">var</span> foo2 = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// Waste of everyone's time</span></span><br><span class="line"><span class="keyword">var</span> foo4 = <span class="function"><span class="keyword">function</span> <span class="title">foo3</span><span class="params">()</span> </span>&#123;&#125;  <span class="comment">// Quiz 1 (answer below)</span></span><br></pre></td></tr></table></figure>
<p><strong>Quiz 2</strong>: How do you write a declared function in CoffeeScript?</p>
<h2 id="Avoid-Closures"><a href="#Avoid-Closures" class="headerlink" title="Avoid Closures"></a>Avoid Closures</h2><p>Unless you have a reason to, <a href="https://jslinterrors.com/dont-make-functions-within-a-loop" target="_blank" rel="external">avoid making functions</a> or <a href="http://stackoverflow.com/questions/8228281/what-is-the-function-construct-in-javascript" target="_blank" rel="external">IIFEs</a>, especially in a loop.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// Do</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Don't, unless you have a reason to</span></span><br><span class="line">    &#125;());</span><br><span class="line">    </span><br><span class="line">    dom.addEvent(eventHandler);  <span class="comment">// Do</span></span><br><span class="line">    </span><br><span class="line">    dom.addEvent(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Don't    </span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Similarly-avoid-nesting-functions"><a href="#Similarly-avoid-nesting-functions" class="headerlink" title="Similarly, avoid nesting functions"></a>Similarly, avoid nesting functions</h2><p>Even if you use function declarations like this post said earlier, it doesn’t mean much if you do <em>a lot</em> in those function declarations. For example, if you call a function like this:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar3</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://reaktor.com/blog/javascript-performance-fundamentals-make-bluebird-fast/" target="_blank" rel="external">Separate instances of <code>bar1</code>, <code>bar2</code>, and <code>bar3</code> will be created every time <code>foo()</code> is called, whether of not those functions are used at all</a>. So, to write perfectly fast code, you should write:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar3</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(Sometimes, this is not possible.)</p>
<h2 id="Avoid-arguments"><a href="#Avoid-arguments" class="headerlink" title="Avoid arguments"></a>Avoid <code>arguments</code></h2><p><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#2-unsupported-syntax" target="_blank" rel="external">Using arguments improperly</a> may render a function unoptimisable. Assigning a value to any arguments where a function uses <code>arguments</code> will stop optimisation:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        b = <span class="number">5</span>;  <span class="comment">// Don't (modify an argument when you are in an argument condition)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>An easy way to work around this is to assign it elsewhere:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b2 = b;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        b2 = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(But how about just not modifying the argument in the first place, you degenerate?)</p>
<p>###</p>
<h2 id="Don’t-be-clever"><a href="#Don’t-be-clever" class="headerlink" title="Don’t be clever"></a>Don’t be clever</h2><p>If you <a href="http://stackoverflow.com/a/23925102/1558430" target="_blank" rel="external">try to be clever</a>, <a href="https://github.com/twbs/bootstrap/issues/3057#issuecomment-5135512" target="_blank" rel="external">Crockford will kill you.</a> These are function expressions turned into IIFEs through forced evaluation:</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Don't</span></span><br><span class="line">!<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span>  <span class="comment">// =&gt; true</span></span><br><span class="line">~<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span> <span class="comment">// =&gt; -1</span></span><br><span class="line">+<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span> <span class="comment">// =&gt; NaN</span></span><br><span class="line">-<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span>  <span class="comment">// =&gt; NaN</span></span><br></pre></td></tr></table></figure>
<p>Doing these stupid things, as opposed to using a conventional IIFE, has no performance gains.</p>
<p><strong>Quiz 3</strong>: What does CoffeeScript turn this into?</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">foo</span> = <span class="params">()</span> -&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h2><p>Don’t be clever. Each recursion introduces a stack. The higher the stack, the slower the function.<br><a href="http://stackoverflow.com/questions/23260390/node-js-tail-call-optimization-possible-or-not" target="_blank" rel="external">Don’t rely on TCO. As of now, pretend it does not exist.</a></p>
<h2 id="Prototypes"><a href="#Prototypes" class="headerlink" title="Prototypes"></a>Prototypes</h2><p>To be fast, you have to be ugly. <a href="https://developers.google.com/speed/articles/optimizing-javascript" target="_blank" rel="external">Prototypes are best put outside the constructor.</a> </p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do</span></span><br><span class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">Bar.prototype.foo = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don't</span></span><br><span class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.foo = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Avoid-calling-the-same-function-with-multiple-types-of-arguments"><a href="#Avoid-calling-the-same-function-with-multiple-types-of-arguments" class="headerlink" title="Avoid calling the same function with multiple types of arguments"></a><a href="http://mythbusters.js.org/v8-tips/monomorphic.html" target="_blank" rel="external">Avoid calling the same function with multiple types of arguments</a></h2><p>Consider a function <code>add()</code>:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">add</span> (x, y) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">x</span> + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you call <code>add(1, 2)</code> and <code>add(3, 4)</code>, the same function is used.<br>If you then call <code>add(&#39;a&#39;, &#39;b&#39;)</code>, then “the + in add becomes polymorphic”, which hurts performance.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Classes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Avoid Classes</span></span><br><span class="line"></span><br><span class="line">Classes are currently transpiled into simple functions, even in V8 itself. They are syntactic sugar, currently <span class="keyword">with</span> <span class="keyword">no</span> <span class="keyword">performance</span> benefits. It <span class="keyword">is</span> best <span class="keyword">to</span> avoid classes <span class="keyword">for</span> now.</span><br><span class="line"></span><br><span class="line"><span class="comment">## Don't assign random attributes to instances</span></span><br><span class="line"></span><br><span class="line">Apparently, <span class="keyword">if</span> you assign an <span class="literal">unknown</span> <span class="keyword">attribute</span> <span class="keyword">to</span> a <span class="keyword">class</span> <span class="keyword">with</span> a <span class="keyword">list</span> <span class="keyword">of</span> known <span class="keyword">attributes</span> <span class="keyword">on</span> construction, <span class="keyword">then</span> [the classes diverge][<span class="number">13</span>], taking <span class="built_in">time</span>:</span><br></pre></td></tr></table></figure></p>
<p>class Point {<br>    constructor (x, y) {<br>        this.x = x;<br>        this.y = y;<br>    }<br>}</p>
<p>var p1 = new Point(11, 22);<br>var p2 = new Point(33, 44);<br>// At this point, p1 and p2 have a shared hidden class<br>p2.z = 55;<br>// warning! p1 and p2 now have different hidden classes!<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Variables</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Don't use global variables</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Global</span> variables are never garbage-collected.</span><br></pre></td></tr></table></figure></p>
<p>var WILLET = { … };  // No</p>
<p>// Start of module<br>var PAYMENTS = function () {<br>    // No<br>};</p>
<p>// Start of module<br>(function () {<br>    export default function () {<br>         // Yes<br>    };<br>}());<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">## Place variables in the innermost scope</span></span><br><span class="line"></span><br><span class="line">![](/image/js4_0401.gif)</span><br><span class="line"></span><br><span class="line">Declaring variables where they are needed helps with garbage collection. [<span class="string">Variable read time is also faster.</span>][<span class="symbol">6</span>] (The term may be [<span class="string">"variable scope resolution"</span>][<span class="symbol">27</span>].)</span><br></pre></td></tr></table></figure></p>
<p>(function () {<br>    (function () {<br>        var i = 0;  // Do<br>        i++;<br>        console.log(i);<br>    }());<br>}());</p>
<p>(function () {<br>    var i = 0;  // Don’t<br>    (function () {<br>        i++;<br>        console.log(i);<br>    }());<br>}());<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Well, that is <span class="keyword">the</span> theory, anyway. If you leak <span class="keyword">any</span> <span class="keyword">of</span> your variables through events <span class="keyword">and</span> callbacks, <span class="keyword">then</span> <span class="literal">none</span> <span class="keyword">of</span> <span class="keyword">the</span> scopes are garbage collected.</span><br><span class="line"></span><br><span class="line"><span class="comment">## Don't use `delete`</span></span><br><span class="line"></span><br><span class="line">`<span class="built_in">delete</span>` does nothing useful related <span class="built_in">to</span> memory <span class="keyword">in</span> JavaScript.</span><br><span class="line"></span><br><span class="line"><span class="comment">## `foo = null` does nothing</span></span><br><span class="line"></span><br><span class="line">Do <span class="keyword">not</span> assign `<span class="literal">null</span>` <span class="built_in">to</span> <span class="keyword">any</span> <span class="built_in">variable</span> <span class="keyword">with</span> <span class="keyword">the</span> intention <span class="keyword">of</span> allowing <span class="keyword">it</span> <span class="built_in">to</span> be garbage-collected. If <span class="keyword">the</span> <span class="built_in">variable</span> is no longer accessible <span class="keyword">in</span> <span class="keyword">any</span> scope, <span class="keyword">it</span> will be garbage collected automatically.</span><br><span class="line"></span><br><span class="line"><span class="comment">## [Compare with the fastest possible operator][32]</span></span><br><span class="line"></span><br><span class="line">Since this is about speed, choose whichever <span class="literal">one</span> you want here.</span><br></pre></td></tr></table></figure></p>
<p>array.length === 0  // faster<br>array.length &lt;= 0  // slower<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">## Arrays</span></span><br><span class="line"></span><br><span class="line">Arrays are actually objects, so using them does not save you any memory. However, [<span class="string">there are speed differences how an array is constructed</span>][<span class="symbol">5</span>]:</span><br></pre></td></tr></table></figure></p>
<p>var a = [1,2,3,4];  // Do</p>
<p>var b = new Array();  // Don’t<br>b.push(1);<br>b.push(2);<br>b.push(3);<br>b.push(4);</p>
<p>var c = new Array(4);  // Don’t do pre-allocate for large numbers<br>c.push(1);<br>c.push(2);<br>c.push(3);<br>c.push(4);<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Defined<span class="built_in"> array </span>literals can also help the compiler understand when<span class="built_in"> not </span>to optimise one:</span><br></pre></td></tr></table></figure></p>
<p>var array = [ 77, 88, 0.5, true ]  // Do</p>
<p>var array = []<br>array[0] = 77<br>array<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> = 88<br>array<a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a> = 0.5  // I thought this was supposed to be an array of integers, oh no. Will convert entire array to a more generic Number array<br>array<a href="http://stackoverflow.com/questions/8228281/what-is-the-function-construct-in-javascript" target="_blank" rel="external">3</a> = true // I thought this was supposed to be an array of integers, oh no. Will convert entire array to a more generic Object array<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### Don't muck about with Arrays</span></span><br><span class="line"></span><br><span class="line">If an<span class="built_in"> array </span>has something other than `0` as its first key, its speed is 2x slower:</span><br></pre></td></tr></table></figure></p>
<p>var a = [];<br>a[0] = 1;  // Ok</p>
<p>var b = [];<br>b<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> = 1;  // No, start with 0<br>b[‘foo’] = 1;  // No<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### Don't pre-allocate large Arrays</span></span><br><span class="line"></span><br><span class="line">Pre-allocating an<span class="built_in"> array </span>more than 64k elements is a waste of time.</span><br><span class="line"></span><br><span class="line"><span class="comment">### [`shift` is slower than `pop`][34]</span></span><br><span class="line"></span><br><span class="line">`pop()` simply subtracts 1 from the array's length, making it a lot faster than `shift()`, which causes all<span class="built_in"> array </span>items to be readdressed.</span><br><span class="line"></span><br><span class="line"><span class="comment">## Objects</span></span><br><span class="line"></span><br><span class="line">`foo.bar` is faster than `foo['bar']`, but [only in Safari][16].</span><br><span class="line"></span><br><span class="line">Since access takes time, retain your references:</span><br></pre></td></tr></table></figure></p>
<p>// Do<br>var a = foo.bar.baz.a,<br>    b = foo.bar.baz.b;<br>foo(a, b, a, b);</p>
<p>// Don’t<br>foo(foo.bar.baz.a, foo.bar.baz.b, foo.bar.baz.a, foo.bar.baz.b);<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">## Errors</span></span><br><span class="line"></span><br><span class="line">Always `<span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Error</span>(<span class="comment">'a string')`.</span></span><br></pre></td></tr></table></figure></p>
<p>throw new Error(‘a string’)  // Do<br>throw Error(‘a string’)  // Avoid<br>throw ‘a string’  // Don’t<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="string">Don't just `throw Error('a string')`, or `throw 'a string'`.</span>][<span class="symbol">10</span>] The former is just for consistency, but the second one is unforgivable. Errors have <span class="code">`.message`</span>; strings don't.</span><br><span class="line">Of course, because this is JavaScript we are talking about, [<span class="string">throwing a string is faster than throwing Error objects.</span>][<span class="symbol">11</span>]</span><br><span class="line"></span><br><span class="line"><span class="section"># Flow control</span></span><br><span class="line"></span><br><span class="line"><span class="section">## Conditionals</span></span><br><span class="line"></span><br><span class="line">For the pure sake of being fast, [<span class="string">follow these rules</span>][<span class="symbol">6</span>], whenever the logic applies:</span><br><span class="line"></span><br><span class="line"><span class="bullet">* </span>Use <span class="code">`if`</span> if there are no more than two conditions.</span><br><span class="line"><span class="bullet">* </span>Use <span class="code">`switch`</span> if there are between three to ten conditions. (See also: [<span class="string">switches not optimisable beyond 128 branches in older engines</span>][<span class="symbol">36</span>])</span><br><span class="line"><span class="bullet">* </span>Use a map (key lookup) if there are more than ten conditions.</span><br><span class="line"></span><br><span class="line"><span class="section">## Loops</span></span><br><span class="line"></span><br><span class="line"><span class="section">### For loops</span></span><br><span class="line"></span><br><span class="line">For critical loops for which you know its bounds, consider unrolling them.</span><br></pre></td></tr></table></figure></p>
<p>for (var i = 0; i &lt; 10; i++) {<br>    foo(i);  // Do<br>}</p>
<p>foo(0);  // Worth a shot<br>foo(1);<br>foo(2);<br>foo(3);<br>foo(4);<br>foo(5);<br>foo(6);<br>foo(7);<br>foo(8);<br>foo(9);<br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### [Don<span class="symbol">'t</span> <span class="keyword">loop</span> backwards][<span class="number">15</span>]</span><br><span class="line"></span><br><span class="line">According <span class="keyword">to</span> [source <span class="number">15</span>][<span class="number">15</span>], although looping backwards (`<span class="keyword">while</span> (i<span class="comment">--)` sort of thing) saves two CPU instructions, it causes more branch misses than you would like.</span></span><br><span class="line"></span><br><span class="line">### <span class="keyword">For</span>-<span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">Avoid the `<span class="keyword">for</span>-<span class="keyword">in</span>` <span class="keyword">loop</span>. <span class="keyword">Then</span> again, sometimes you need the <span class="keyword">for</span>-<span class="keyword">in</span> <span class="keyword">loop</span>. I am just here <span class="keyword">to</span> tell you it <span class="keyword">is</span> slow.</span><br><span class="line"></span><br><span class="line">[The `<span class="keyword">for</span>-<span class="keyword">in</span>` <span class="keyword">loop</span> cannot be optimised by any JS engine <span class="keyword">if</span> the key <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">in</span> the exact scope.][<span class="number">37</span>] Take this, <span class="keyword">for</span> example:</span><br></pre></td></tr></table></figure></p>
<p>function nonLocalKey1() {<br>    var obj = {}<br>    for(var key in obj) {  // key from outside<br>        return key;<br>    };<br>}<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">The solution <span class="keyword">is</span>... <span class="keyword">not</span> <span class="keyword">to</span> use <span class="keyword">for</span>-<span class="keyword">in</span> loops.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Libraries</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## `Math`</span></span><br><span class="line"></span><br><span class="line">Although technically <span class="keyword">not</span> a library, `Math` <span class="keyword">is</span> an object <span class="keyword">that</span> can be very slow, depending <span class="keyword">on</span> what you do <span class="keyword">with</span> <span class="keyword">it</span>.</span><br></pre></td></tr></table></figure></p>
<p>Math.exp(1)  // Slow<br>Math.E  // Fast</p>
<p>Math.log(2)  // Slow<br>Math.LN2  // Fast</p>
<p>Math.floor(2.70)  // 2<br>~~-2.70  // Fast floor for everything except NaN<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">## `Date`</span></span><br><span class="line"></span><br><span class="line"><span class="code">`Date.now()`</span>, being a static method, is faster than <span class="code">`(new Date).getTime()`</span>.</span><br><span class="line"></span><br><span class="line"><span class="section">## **Don't load multiple versions of the same library**</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Browserify and Webpack *et al.*</span>][<span class="symbol">30</span>] allow you to pack multiple libraries into your project, essentially doing this bullshit:</span><br></pre></td></tr></table></figure></p>
<p><script src="foo.1.2.3.js"></script></p>
<p><script src="foo.1.2.4.js"></script></p>
<p><script src="foo.1.2.5.js"></script><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">If you won't <span class="keyword">do</span> that yourself, why would you <span class="keyword">do</span> it <span class="keyword">with</span> Browserify? [It comes <span class="keyword">with</span> a dedupe thing that might <span class="keyword">or</span> might <span class="keyword">not</span> <span class="keyword">work</span>][<span class="number">31</span>], <span class="keyword">and</span> <span class="string">`npm dedupe`</span> has a chance <span class="keyword">of</span> breaking everything, so good luck <span class="keyword">with</span> Ionic <span class="number">2.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## jQuery</span></span><br><span class="line"></span><br><span class="line">jQuery <span class="keyword">is</span> a great <span class="keyword">library</span> that sorts everything <span class="keyword">out</span> <span class="keyword">for</span> you, <span class="keyword">from</span> browser quirks, requests, promises, <span class="keyword">to</span> animations <span class="keyword">without</span> CSS. The <span class="keyword">cost</span> <span class="keyword">of</span> that <span class="keyword">is</span> <span class="keyword">performance</span>, so this post will recommend you <span class="keyword">not</span> <span class="keyword">to</span> <span class="keyword">use</span> it.</span><br><span class="line"><span class="keyword">If</span> you must <span class="keyword">use</span> jQuery, see <span class="keyword">if</span> you need <span class="keyword">to</span> support IE6, <span class="number">7</span>, <span class="keyword">and</span> <span class="number">8.</span> <span class="keyword">If</span> <span class="keyword">not</span>, jQuery <span class="number">3</span> took <span class="keyword">out</span> the support code <span class="keyword">for</span> them, making it faster <span class="keyword">than</span> jQuery <span class="number">1.</span>x <span class="keyword">to</span> run.</span><br><span class="line"></span><br><span class="line"><span class="comment">## Angular</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Avoid using useless functions</span></span><br></pre></td></tr></table></figure></p>
<p>typeof thing === ‘undefined’  // Do<br>thing === undefined  // Better, if thing is a variable for sure<br>angular.isUndefined(thing)  // Don’t<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">### Consider using lightweight functions instead</span></span><br><span class="line"></span><br><span class="line">If you look at the [<span class="string">angular source for `angular.equals`</span>][<span class="symbol">28</span>], you can see that it supports recursive comparison of objects and arrays, so this works:</span><br></pre></td></tr></table></figure></p>
<p>angular.equals([<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>], [<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>])  // true<br>[<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>] == [<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>]  // false<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">It also decides which dates, scopes, and functions are considered equal.</span><br><span class="line"></span><br><span class="line">That is a valid <span class="keyword">use</span> <span class="keyword">case</span> <span class="keyword">for</span> <span class="string">`angular.equals`</span>. However, <span class="keyword">for</span> <span class="keyword">any</span> primitive <span class="keyword">data</span> <span class="keyword">type</span>, you should <span class="keyword">use</span> <span class="string">`===`</span> instead, saving even the <span class="keyword">function</span> call.</span><br><span class="line"></span><br><span class="line"><span class="comment">### Don't use `$watch`</span></span><br><span class="line"></span><br><span class="line"><span class="string">`$watch`</span> <span class="keyword">is</span> awful. It <span class="keyword">is</span> virtually untestable, <span class="keyword">and</span> it <span class="keyword">is</span> inefficient <span class="keyword">as</span> a way <span class="keyword">to</span> <span class="keyword">do</span> things. Here <span class="keyword">are</span> <span class="keyword">some</span> things you might have done <span class="keyword">with</span> <span class="string">`$watch`</span>:</span><br></pre></td></tr></table></figure></p>
<p>// No<br>$scope.$watch(‘something’, function () {<br>    if ($scope.something === some state) {<br>        changeTheValueOf($scope.somethingElse);<br>    }<br>});</p>
<div ng-if="somethingElse"></div>

<p>// Yes (this is a one-way digest)<br>$scope.isSomethingElse = function () {<br>    return $scope.something === some state;<br>};</p>
<div ng-if="isSomethingElse()"></div>

<p>// No<br>$scope.$watch(‘something’, function () {<br>    $scope.somethingElse = foo($scope…);<br>});</p>
<p>// Yes</p>
<p><input ng-model="something" ng-change="doFoo()">&lt;…&gt;<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">### `ng-bind` just once</span></span><br><span class="line"></span><br><span class="line">[<span class="string">`::` mean "once" in AngularJS 1.3 and up.</span>][<span class="symbol">21</span>]</span><br><span class="line">[<span class="string">`ng-bind` is twice as fast as &amp;#123;&amp;#123;` expression `&#125;&#125;</span>][<span class="symbol">22</span>]. Use <span class="code">`ng-bind`</span> instead.</span><br></pre></td></tr></table></figure></p>
<!-- Do -->
<p><div ng-bind="::item"></div><br><!-- Don't --></p>
<p><div>&#123;&#123; ::item }}</div><br><!-- Do --></p>
<p><div ng-repeat="item in ::items" ng-bind="item"></div><br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">### Place methods in the smallest possible "scope"</span></span><br><span class="line"></span><br><span class="line">Don't make "global" controller methods. They are both slow and hard to destroy.</span><br><span class="line"></span><br><span class="line"><span class="section">### Disable debugging</span></span><br><span class="line"></span><br><span class="line">[<span class="string">A common mistake that slows down the app.</span>][<span class="symbol">23</span>]</span><br></pre></td></tr></table></figure></p>
<p>$compileProvider.debugInfoEnabled(false);<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">### Avoid `$log`</span></span><br><span class="line"></span><br><span class="line">You may notice that, even if you set <span class="code">`debugInfoEnabled(false)`</span>, that <span class="code">`adb logcat`</span> still contains warnings and errors. Actual errors are cool and all, but [<span class="string">if you log an object, it cannot be garbage-collected</span>][<span class="symbol">24</span>]. For this reason, avoid <span class="code">`$log`</span>ging objects, or better, avoid logging useless things.</span><br><span class="line"></span><br><span class="line"><span class="section">## Underscore vs Lodash</span></span><br><span class="line"></span><br><span class="line">Lodash is a larger, yet [<span class="string">faster</span>][<span class="symbol">20</span>] fork of underscore. So, for faster code, use lodash.</span><br><span class="line"></span><br><span class="line"><span class="section">### `[].forEach` vs `_.each([])` vs `angular.forEach([])`</span></span><br><span class="line"></span><br><span class="line">You may find that [<span class="string">`[</span>].forEach<span class="code">` exists][18]. If you have no regard for browser compatibility, you may use it. Otherwise, `</span>_.each` is faster than the other two, [<span class="string">with caveats</span>][<span class="symbol">19</span>].</span><br><span class="line"></span><br><span class="line"><span class="section">### [Lazy evaluation][20]</span></span><br><span class="line"></span><br><span class="line">Using lodash in a functional manner allows certain <span class="code">`map`</span> and <span class="code">`filter`</span> operations to be lazy-evaluated. It has some performance benefits when there is a <span class="code">`take()`</span> involved.</span><br></pre></td></tr></table></figure></p>
<p>_(phoneNumbers).map(String).filter(contains55).take(100);  // Do</p>
<p>// Don’t<br><em>.take(</em>.each(phoneNumbers, function (phoneNumber) {<br>    if (contains55(phoneNumber)) {<br>        return String(phoneNumber);<br>    }<br>}), 100);<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Profiling</span></span><br><span class="line"></span><br><span class="line">Left <span class="keyword">for</span> another <span class="built_in">post</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">## Debuggers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Don't leave in `debugger`, not even once</span></span><br><span class="line"></span><br><span class="line">If you leave <span class="keyword">in</span> `debugger;` somewhere <span class="keyword">in</span> <span class="keyword">the</span> <span class="function"><span class="keyword">function</span>, <span class="title">even</span> <span class="title">like</span> <span class="title">this</span>:</span></span><br></pre></td></tr></table></figure></p>
<p>if (false) {<br>    debugger;<br>}<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Then [<span class="string">V8 will not optimise the entire function</span>][<span class="symbol">14</span>].</span><br><span class="line"></span><br><span class="line"><span class="section"># Answers</span></span><br><span class="line"></span><br><span class="line"><span class="section">## Quiz 1</span></span><br><span class="line"></span><br><span class="line">You can't</span><br><span class="line"></span><br><span class="line"><span class="section">## Quiz 2</span></span><br><span class="line"></span><br><span class="line"><span class="code">`var foo4 = function foo3() &#123;&#125;`</span> generates <span class="code">`foo3`</span> and <span class="code">`foo4`</span> that are both the same function, or in the case of IE (8 and under?), [<span class="string">two copies of the function</span>][<span class="symbol">7</span>] (<span class="code">`foo3 !== foo4`</span>). </span><br><span class="line"></span><br><span class="line"><span class="section">## Quiz 3</span></span><br></pre></td></tr></table></figure></p>
<p>var foo;<br>foo = function () {};<br><code>`</code></p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-About-peerDependencies" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/About-peerDependencies/" class="article-date">
  <time datetime="2016-01-20T08:44:22.000Z" itemprop="datePublished">2016-01-20</time>
</a>
		</span>
		<span class="meta-elements author">root</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/About-peerDependencies/">About peerDependencies</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Peer dependencies express the relationship between a “plugin package”, such as <code>jquery-lazy</code>, and its host, <code>jquery</code>. If <code>jquery-lazy</code> claims it works with <code>jquery@&lt;2</code>, then installing it will also install a copy of <a href="mailto:`jquery@1.9" target="_blank" rel="external">`jquery@1.9</a>`.</p>
<h1 id="Fixing-peerDependencies-errors"><a href="#Fixing-peerDependencies-errors" class="headerlink" title="Fixing peerDependencies errors"></a>Fixing <code>peerDependencies</code> errors</h1><p>If you are installing a package, say, <a href="https://github.com/rossmartin/cordova-uglify" target="_blank" rel="external"><code>cordova-uglify</code></a>, and see this in npm 2:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm WARN peerDependencies The<span class="built_in"> peer </span>dependency uglify-js@2.4.14 included <span class="keyword">from</span> cordova-uglify will <span class="literal">no</span></span><br><span class="line">npm WARN peerDependencies longer be automatically installed <span class="keyword">to</span> fulfill the peerDependency</span><br><span class="line">npm WARN peerDependencies <span class="keyword">in</span> npm 3+. Your application will need <span class="keyword">to</span> depend on it explicitly.</span><br><span class="line">npm WARN peerDependencies The<span class="built_in"> peer </span>dependency ng-annotate@0.15.4 included <span class="keyword">from</span> cordova-uglify will <span class="literal">no</span></span><br><span class="line">npm WARN peerDependencies longer be automatically installed <span class="keyword">to</span> fulfill the peerDependency</span><br><span class="line">npm WARN peerDependencies <span class="keyword">in</span> npm 3+. Your application will need <span class="keyword">to</span> depend on it explicitly.</span><br><span class="line">npm WARN peerDependencies The<span class="built_in"> peer </span>dependency clean-css@2.2.2 included <span class="keyword">from</span> cordova-uglify will <span class="literal">no</span></span><br><span class="line">npm WARN peerDependencies longer be automatically installed <span class="keyword">to</span> fulfill the peerDependency</span><br><span class="line">npm WARN peerDependencies <span class="keyword">in</span> npm 3+. Your application will need <span class="keyword">to</span> depend on it explicitly.</span><br></pre></td></tr></table></figure>
<p>It is telling us that <code>cordova-uglify</code> (the package in your <code>package.json</code>) claims to be compatible with <a href="mailto:`uglify-js@2.4.14" target="_blank" rel="external">`uglify-js@2.4.14</a><code>,</code><a href="mailto:ng-annotate@0.15.4" target="_blank" rel="external">ng-annotate@0.15.4</a><code>, and</code><a href="mailto:clean-css@2.2.2" target="_blank" rel="external">clean-css@2.2.2</a>`, but your project does not install them.</p>
<p>The solution is to add these dependencies to your own <code>package.json</code>, or kindly ask your package maintainer to <a href="https://github.com/rossmartin/cordova-uglify/issues/16" target="_blank" rel="external">fix the problem</a>.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="extend next" rel="next" href="page/2/">Next &raquo;</a>
    </nav>
  

    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.ohai.ca">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">root&#39;s Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2019 root<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="../../js/script.js"></script>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    var sc_project=4446854;
    var sc_invisible=0;
    var sc_security="74785e80";
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write(
      "<sc"+"ript type='text/javascript' src='" +
      scJsHost +
      "statcounter.com/counter/counter_xhtml.js'></" +
      "script>"
    );
    //]]>
  </script>
  <noscript>
    <img style="display: none"
         src="http://c.statcounter.com/4446854/0/74785e80/0/" />
  </noscript><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
