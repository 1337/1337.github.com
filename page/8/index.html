<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Brian&#39;s Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Why do you ask my name? It is beyond understanding.">
<meta property="og:type" content="website">
<meta property="og:title" content="Brian's Blog">
<meta property="og:url" content="http://blog.ohai.ca/page/8/index.html">
<meta property="og:site_name" content="Brian's Blog">
<meta property="og:description" content="Why do you ask my name? It is beyond understanding.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brian's Blog">
<meta name="twitter:description" content="Why do you ask my name? It is beyond understanding.">
  
    <link rel="alternative" href="/atom.xml" title="Brian&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="../../css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ohai.ca"></form>
	</div>
</header>
    <div id="main">
      
  
    <article id="post-Writing-Fast-JavaScript" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Writing-Fast-JavaScript/" class="article-date">
  <time datetime="2016-06-22T18:04:54.000Z" itemprop="datePublished">2016-06-22</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Writing-Fast-JavaScript/">Writing Fast JavaScript</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>As a JavaScript user of one of the companies you may or may not have heard of, I am scheduled to give a talk about writing fast and maintainable JavaScript, perhaps by reading off this blog post.<br>However, as many of us may know, <a href="https://www.w3.org/community/webed/wiki/A_Short_History_of_JavaScript" target="_blank" rel="external">JS was created by Brendan Eich in ten days</a>, meant to move monkeys around on the screen (even <a href="https://brendaneich.com/2011/06/new-javascript-engine-module-owner/" target="_blank" rel="external">he said it himself</a>, so you know it’s legit), it is impossible even for a god like Eich to have his cake and eat it too.</p>
<p>This post addresses the <em>fast</em> part of writing fast and maintainable JavaScript.</p>
<h1 id="quot-use-strict-quot"><a href="#quot-use-strict-quot" class="headerlink" title="&quot;use strict&quot;"></a><code>&quot;use strict&quot;</code></h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode" target="_blank" rel="external">Using <code>&quot;use strict&quot;</code> removes many run-time checks that would otherwise have considerable performance cost</a>:</p>
<blockquote>
<p>A few strict mode tweaks, plus requiring that user-submitted JavaScript be strict mode code and that it be invoked in a certain manner, substantially reduce the need for those runtime checks.</p>
</blockquote>
<p>This is also one of the few tips here that actually make the code more maintainable, though not by much.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><p>Function declarations are faster than function expressions. <a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a> Function declarations are compiled ahead of time.<br>In other words, named functions are faster than anonymous functions. Unless you waste your time assigning a declaration to an expression again.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Do</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line"><span class="comment">// Don't</span></div><div class="line"><span class="keyword">var</span> foo2 = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="comment">// Waste of everyone's time</span></div><div class="line"><span class="keyword">var</span> foo4 = <span class="function"><span class="keyword">function</span> <span class="title">foo3</span><span class="params">()</span> </span>&#123;&#125;  <span class="comment">// Quiz 1 (answer below)</span></div></pre></td></tr></table></figure>
<p><strong>Quiz 2</strong>: How do you write a declared function in CoffeeScript?</p>
<h2 id="Avoid-Closures"><a href="#Avoid-Closures" class="headerlink" title="Avoid Closures"></a>Avoid Closures</h2><p>Unless you have a reason to, <a href="https://jslinterrors.com/dont-make-functions-within-a-loop" target="_blank" rel="external">avoid making functions</a> or <a href="http://stackoverflow.com/questions/8228281/what-is-the-function-construct-in-javascript" target="_blank" rel="external">IIFEs</a>, especially in a loop.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</div><div class="line">    <span class="comment">// Do</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</div><div class="line">    (<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// Don't, unless you have a reason to</span></div><div class="line">    &#125;());</div><div class="line">    </div><div class="line">    dom.addEvent(eventHandler);  <span class="comment">// Do</span></div><div class="line">    </div><div class="line">    dom.addEvent(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// Don't    </span></div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Similarly-avoid-nesting-functions"><a href="#Similarly-avoid-nesting-functions" class="headerlink" title="Similarly, avoid nesting functions"></a>Similarly, avoid nesting functions</h2><p>Even if you use function declarations like this post said earlier, it doesn’t mean much if you do <em>a lot</em> in those function declarations. For example, if you call a function like this:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar1</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar2</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar3</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">5</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://reaktor.com/blog/javascript-performance-fundamentals-make-bluebird-fast/" target="_blank" rel="external">Separate instances of <code>bar1</code>, <code>bar2</code>, and <code>bar3</code> will be created every time <code>foo()</code> is called, whether of not those functions are used at all</a>. So, to write perfectly fast code, you should write:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar1</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar2</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar3</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">5</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>(Sometimes, this is not possible.)</p>
<h2 id="Avoid-arguments"><a href="#Avoid-arguments" class="headerlink" title="Avoid arguments"></a>Avoid <code>arguments</code></h2><p><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#2-unsupported-syntax" target="_blank" rel="external">Using arguments improperly</a> may render a function unoptimisable. Assigning a value to any arguments where a function uses <code>arguments</code> will stop optimisation:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</div><div class="line">        b = <span class="number">5</span>;  <span class="comment">// Don't (modify an argument when you are in an argument condition)</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>An easy way to work around this is to assign it elsewhere:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> b2 = b;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</div><div class="line">        b2 = <span class="number">5</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>(But how about just not modifying the argument in the first place, you degenerate?)</p>
<p>###</p>
<h2 id="Don’t-be-clever"><a href="#Don’t-be-clever" class="headerlink" title="Don’t be clever"></a>Don’t be clever</h2><p>If you <a href="http://stackoverflow.com/a/23925102/1558430" target="_blank" rel="external">try to be clever</a>, <a href="https://github.com/twbs/bootstrap/issues/3057#issuecomment-5135512" target="_blank" rel="external">Crockford will kill you.</a> These are function expressions turned into IIFEs through forced evaluation:</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Don't</span></div><div class="line">!<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span>  <span class="comment">// =&gt; true</span></div><div class="line">~<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span> <span class="comment">// =&gt; -1</span></div><div class="line">+<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span> <span class="comment">// =&gt; NaN</span></div><div class="line">-<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">&#123;&#125;</span><span class="params">()</span>;</span>  <span class="comment">// =&gt; NaN</span></div></pre></td></tr></table></figure>
<p>Doing these stupid things, as opposed to using a conventional IIFE, has no performance gains.</p>
<p><strong>Quiz 3</strong>: What does CoffeeScript turn this into?</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">foo</span> = <span class="params">()</span> -&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h2><p>Don’t be clever. Each recursion introduces a stack. The higher the stack, the slower the function.<br><a href="http://stackoverflow.com/questions/23260390/node-js-tail-call-optimization-possible-or-not" target="_blank" rel="external">Don’t rely on TCO. As of now, pretend it does not exist.</a></p>
<h2 id="Prototypes"><a href="#Prototypes" class="headerlink" title="Prototypes"></a>Prototypes</h2><p>To be fast, you have to be ugly. <a href="https://developers.google.com/speed/articles/optimizing-javascript" target="_blank" rel="external">Prototypes are best put outside the constructor.</a> </p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Do</span></div><div class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;&#125;</div><div class="line">Bar.prototype.foo = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123; &#125;</div><div class="line"></div><div class="line"><span class="comment">// Don't</span></div><div class="line"><span class="keyword">var</span> Bar = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.foo = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Avoid-calling-the-same-function-with-multiple-types-of-arguments"><a href="#Avoid-calling-the-same-function-with-multiple-types-of-arguments" class="headerlink" title="Avoid calling the same function with multiple types of arguments"></a><a href="http://mythbusters.js.org/v8-tips/monomorphic.html" target="_blank" rel="external">Avoid calling the same function with multiple types of arguments</a></h2><p>Consider a function <code>add()</code>:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="title">add</span> (x, y) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="type">x</span> + y</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If you call <code>add(1, 2)</code> and <code>add(3, 4)</code>, the same function is used.<br>If you then call <code>add(&#39;a&#39;, &#39;b&#39;)</code>, then “the + in add becomes polymorphic”, which hurts performance.<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># Classes</span></div><div class="line"></div><div class="line"><span class="comment">## Avoid Classes</span></div><div class="line"></div><div class="line">Classes are currently transpiled <span class="keyword">into</span> simple functions, even <span class="keyword">in</span> V8 itself. They are syntactic sugar, currently <span class="keyword">with</span> no performance benefits. It <span class="keyword">is</span> best <span class="keyword">to</span> avoid classes <span class="keyword">for</span> now.</div><div class="line"></div><div class="line"><span class="comment">## Don't assign random attributes to instances</span></div><div class="line"></div><div class="line">Apparently, <span class="keyword">if</span> you assign an unknown attribute <span class="keyword">to</span> a <span class="built_in">class</span> <span class="keyword">with</span> a <span class="built_in">list</span> <span class="keyword">of</span> known attributes <span class="keyword">on</span> construction, <span class="keyword">then</span> [<span class="keyword">the</span> classes diverge][<span class="number">13</span>], taking <span class="built_in">time</span>:</div></pre></td></tr></table></figure></p>
<p>class Point {<br>    constructor (x, y) {<br>        this.x = x;<br>        this.y = y;<br>    }<br>}</p>
<p>var p1 = new Point(11, 22);<br>var p2 = new Point(33, 44);<br>// At this point, p1 and p2 have a shared hidden class<br>p2.z = 55;<br>// warning! p1 and p2 now have different hidden classes!<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># Variables</span></div><div class="line"></div><div class="line"><span class="comment">## Don't use global variables</span></div><div class="line"></div><div class="line"><span class="attribute">Global</span> variables are never garbage-collected.</div></pre></td></tr></table></figure></p>
<p>var WILLET = { … };  // No</p>
<p>// Start of module<br>var PAYMENTS = function () {<br>    // No<br>};</p>
<p>// Start of module<br>(function () {<br>    export default function () {<br>         // Yes<br>    };<br>}());<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">## Place variables in the innermost scope</span></div><div class="line"></div><div class="line">![](/image/js4_0401.gif)</div><div class="line"></div><div class="line">Declaring variables where they are needed helps with garbage collection. [<span class="string">Variable read time is also faster.</span>][<span class="symbol">6</span>] (The term may be [<span class="string">"variable scope resolution"</span>][<span class="symbol">27</span>].)</div></pre></td></tr></table></figure></p>
<p>(function () {<br>    (function () {<br>        var i = 0;  // Do<br>        i++;<br>        console.log(i);<br>    }());<br>}());</p>
<p>(function () {<br>    var i = 0;  // Don’t<br>    (function () {<br>        i++;<br>        console.log(i);<br>    }());<br>}());<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Well, that is <span class="keyword">the</span> theory, anyway. If you leak <span class="keyword">any</span> <span class="keyword">of</span> your variables through events <span class="keyword">and</span> callbacks, <span class="keyword">then</span> <span class="literal">none</span> <span class="keyword">of</span> <span class="keyword">the</span> scopes are garbage collected.</div><div class="line"></div><div class="line"><span class="comment">## Don't use `delete`</span></div><div class="line"></div><div class="line">`<span class="built_in">delete</span>` does nothing useful related <span class="built_in">to</span> memory <span class="keyword">in</span> JavaScript.</div><div class="line"></div><div class="line"><span class="comment">## `foo = null` does nothing</span></div><div class="line"></div><div class="line">Do <span class="keyword">not</span> assign `<span class="literal">null</span>` <span class="built_in">to</span> <span class="keyword">any</span> <span class="built_in">variable</span> <span class="keyword">with</span> <span class="keyword">the</span> intention <span class="keyword">of</span> allowing <span class="keyword">it</span> <span class="built_in">to</span> be garbage-collected. If <span class="keyword">the</span> <span class="built_in">variable</span> is no longer accessible <span class="keyword">in</span> <span class="keyword">any</span> scope, <span class="keyword">it</span> will be garbage collected automatically.</div><div class="line"></div><div class="line"><span class="comment">## [Compare with the fastest possible operator][32]</span></div><div class="line"></div><div class="line">Since this is about speed, choose whichever <span class="literal">one</span> you want here.</div></pre></td></tr></table></figure></p>
<p>array.length === 0  // faster<br>array.length &lt;= 0  // slower<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">## Arrays</span></div><div class="line"></div><div class="line">Arrays are actually objects, so using them does not save you any memory. However, [<span class="string">there are speed differences how an array is constructed</span>][<span class="symbol">5</span>]:</div></pre></td></tr></table></figure></p>
<p>var a = [1,2,3,4];  // Do</p>
<p>var b = new Array();  // Don’t<br>b.push(1);<br>b.push(2);<br>b.push(3);<br>b.push(4);</p>
<p>var c = new Array(4);  // Don’t do pre-allocate for large numbers<br>c.push(1);<br>c.push(2);<br>c.push(3);<br>c.push(4);<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Defined<span class="built_in"> array </span>literals can also help the compiler understand when<span class="built_in"> not </span>to optimise one:</div></pre></td></tr></table></figure></p>
<p>var array = [ 77, 88, 0.5, true ]  // Do</p>
<p>var array = []<br>array[0] = 77<br>array<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> = 88<br>array<a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a> = 0.5  // I thought this was supposed to be an array of integers, oh no. Will convert entire array to a more generic Number array<br>array<a href="http://stackoverflow.com/questions/8228281/what-is-the-function-construct-in-javascript" target="_blank" rel="external">3</a> = true // I thought this was supposed to be an array of integers, oh no. Will convert entire array to a more generic Object array<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">### Don't muck about with Arrays</span></div><div class="line"></div><div class="line">If an<span class="built_in"> array </span>has something other than `0` as its first key, its speed is 2x slower:</div></pre></td></tr></table></figure></p>
<p>var a = [];<br>a[0] = 1;  // Ok</p>
<p>var b = [];<br>b<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a> = 1;  // No, start with 0<br>b[‘foo’] = 1;  // No<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">### Don't pre-allocate large Arrays</span></div><div class="line"></div><div class="line">Pre-allocating an<span class="built_in"> array </span>more than 64k elements is a waste of time.</div><div class="line"></div><div class="line"><span class="comment">### [`shift` is slower than `pop`][34]</span></div><div class="line"></div><div class="line">`pop()` simply subtracts 1 from the array's length, making it a lot faster than `shift()`, which causes all<span class="built_in"> array </span>items to be readdressed.</div><div class="line"></div><div class="line"><span class="comment">## Objects</span></div><div class="line"></div><div class="line">`foo.bar` is faster than `foo['bar']`, but [only in Safari][16].</div><div class="line"></div><div class="line">Since access takes time, retain your references:</div></pre></td></tr></table></figure></p>
<p>// Do<br>var a = foo.bar.baz.a,<br>    b = foo.bar.baz.b;<br>foo(a, b, a, b);</p>
<p>// Don’t<br>foo(foo.bar.baz.a, foo.bar.baz.b, foo.bar.baz.a, foo.bar.baz.b);<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">## Errors</span></div><div class="line"></div><div class="line">Always `<span class="javascript"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'a string'</span>)</span>`.</div></pre></td></tr></table></figure></p>
<p>throw new Error(‘a string’)  // Do<br>throw Error(‘a string’)  // Avoid<br>throw ‘a string’  // Don’t<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[<span class="string">Don't just `throw Error('a string')`, or `throw 'a string'`.</span>][<span class="symbol">10</span>] The former is just for consistency, but the second one is unforgivable. Errors have <span class="code">`.message`</span>; strings don't.</div><div class="line">Of course, because this is JavaScript we are talking about, [<span class="string">throwing a string is faster than throwing Error objects.</span>][<span class="symbol">11</span>]</div><div class="line"></div><div class="line"><span class="section"># Flow control</span></div><div class="line"></div><div class="line"><span class="section">## Conditionals</span></div><div class="line"></div><div class="line">For the pure sake of being fast, [<span class="string">follow these rules</span>][<span class="symbol">6</span>], whenever the logic applies:</div><div class="line"></div><div class="line"><span class="bullet">* </span>Use <span class="code">`if`</span> if there are no more than two conditions.</div><div class="line"><span class="bullet">* </span>Use <span class="code">`switch`</span> if there are between three to ten conditions. (See also: [<span class="string">switches not optimisable beyond 128 branches in older engines</span>][<span class="symbol">36</span>])</div><div class="line"><span class="bullet">* </span>Use a map (key lookup) if there are more than ten conditions.</div><div class="line"></div><div class="line"><span class="section">## Loops</span></div><div class="line"></div><div class="line"><span class="section">### For loops</span></div><div class="line"></div><div class="line">For critical loops for which you know its bounds, consider unrolling them.</div></pre></td></tr></table></figure></p>
<p>for (var i = 0; i &lt; 10; i++) {<br>    foo(i);  // Do<br>}</p>
<p>foo(0);  // Worth a shot<br>foo(1);<br>foo(2);<br>foo(3);<br>foo(4);<br>foo(5);<br>foo(6);<br>foo(7);<br>foo(8);<br>foo(9);<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">#### [Don't loop backwards][15]</span></div><div class="line"></div><div class="line">According to [<span class="string">source 15</span>][<span class="symbol">15</span>], although looping backwards (<span class="code">`while (i--)`</span> sort of thing) saves two CPU instructions, it causes more branch misses than you would like.</div><div class="line"></div><div class="line"><span class="section">### For-in</span></div><div class="line"></div><div class="line">Avoid the <span class="code">`for-in`</span> loop. Then again, sometimes you need the for-in loop. I am just here to tell you it is slow.</div><div class="line"></div><div class="line">[<span class="string">The `for-in` loop cannot be optimised by any JS engine if the key is not in the exact scope.</span>][<span class="symbol">37</span>] Take this, for example:</div></pre></td></tr></table></figure></p>
<p>function nonLocalKey1() {<br>    var obj = {}<br>    for(var key in obj) {  // key from outside<br>        return key;<br>    };<br>}<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">The solution <span class="keyword">is</span>... <span class="keyword">not</span> <span class="keyword">to</span> use <span class="keyword">for</span>-<span class="keyword">in</span> loops.</div><div class="line"></div><div class="line"><span class="comment"># Libraries</span></div><div class="line"></div><div class="line"><span class="comment">## `Math`</span></div><div class="line"></div><div class="line">Although technically <span class="keyword">not</span> a library, `Math` <span class="keyword">is</span> an object <span class="keyword">that</span> can be very slow, depending <span class="keyword">on</span> what you do <span class="keyword">with</span> <span class="keyword">it</span>.</div></pre></td></tr></table></figure></p>
<p>Math.exp(1)  // Slow<br>Math.E  // Fast</p>
<p>Math.log(2)  // Slow<br>Math.LN2  // Fast</p>
<p>Math.floor(2.70)  // 2<br>~~-2.70  // Fast floor for everything except NaN<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">## `Date`</span></div><div class="line"></div><div class="line"><span class="code">`Date.now()`</span>, being a static method, is faster than <span class="code">`(new Date).getTime()`</span>.</div><div class="line"></div><div class="line"><span class="section">## **Don't load multiple versions of the same library**</span></div><div class="line"></div><div class="line">[<span class="string">Browserify and Webpack *et al.*</span>][<span class="symbol">30</span>] allow you to pack multiple libraries into your project, essentially doing this bullshit:</div></pre></td></tr></table></figure></p>
<p><script src="foo.1.2.3.js"></script></p>
<p><script src="foo.1.2.4.js"></script></p>
<p><script src="foo.1.2.5.js"></script><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">If you won't <span class="keyword">do</span> that yourself, why would you <span class="keyword">do</span> it <span class="keyword">with</span> Browserify? [It comes <span class="keyword">with</span> a dedupe thing that might <span class="keyword">or</span> might <span class="keyword">not</span> <span class="keyword">work</span>][<span class="number">31</span>], <span class="keyword">and</span> <span class="string">`npm dedupe`</span> has a chance <span class="keyword">of</span> breaking everything, so good luck <span class="keyword">with</span> Ionic <span class="number">2.</span></div><div class="line"></div><div class="line">## jQuery</div><div class="line"></div><div class="line">jQuery <span class="keyword">is</span> a great <span class="keyword">library</span> that sorts everything <span class="keyword">out</span> <span class="keyword">for</span> you, <span class="keyword">from</span> browser quirks, requests, promises, <span class="keyword">to</span> animations <span class="keyword">without</span> CSS. The <span class="keyword">cost</span> <span class="keyword">of</span> that <span class="keyword">is</span> <span class="keyword">performance</span>, so this post will recommend you <span class="keyword">not</span> <span class="keyword">to</span> <span class="keyword">use</span> it.</div><div class="line"><span class="keyword">If</span> you must <span class="keyword">use</span> jQuery, see <span class="keyword">if</span> you need <span class="keyword">to</span> support IE6, <span class="number">7</span>, <span class="keyword">and</span> <span class="number">8.</span> <span class="keyword">If</span> <span class="keyword">not</span>, jQuery <span class="number">3</span> took <span class="keyword">out</span> the support code <span class="keyword">for</span> them, making it faster <span class="keyword">than</span> jQuery <span class="number">1.</span>x <span class="keyword">to</span> run.</div><div class="line"></div><div class="line">## Angular</div><div class="line"></div><div class="line">### Avoid <span class="keyword">using</span> useless functions</div></pre></td></tr></table></figure></p>
<p>typeof thing === ‘undefined’  // Do<br>thing === undefined  // Better, if thing is a variable for sure<br>angular.isUndefined(thing)  // Don’t<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">### Consider using lightweight functions instead</span></div><div class="line"></div><div class="line">If you look at the [<span class="string">angular source for `angular.equals`</span>][<span class="symbol">28</span>], you can see that it supports recursive comparison of objects and arrays, so this works:</div></pre></td></tr></table></figure></p>
<p>angular.equals([<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>], [<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>])  // true<br>[<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>] == [<a href="https://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/" target="_blank" rel="external">1</a>, <a href="https://jsperf.com/fn-expression-vs-statement" target="_blank" rel="external">2</a>]  // false<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">It also decides which dates, scopes, <span class="keyword">and</span> functions are considered equal.</div><div class="line"></div><div class="line">That <span class="keyword">is</span> a valid <span class="keyword">use</span> <span class="keyword">case</span> <span class="keyword">for</span> `angular.equals`. However, <span class="keyword">for</span> any primitive data <span class="keyword">type</span>, you should <span class="keyword">use</span> `===` instead, saving even the <span class="keyword">function</span> <span class="title">call.</span></div><div class="line"></div><div class="line">### Don't use `$watch`</div><div class="line"></div><div class="line">`$watch` <span class="keyword">is</span> awful. It <span class="keyword">is</span> virtually untestable, <span class="keyword">and</span> it <span class="keyword">is</span> inefficient as a way to <span class="keyword">do</span> things. Here are <span class="keyword">some</span> things you might have done <span class="keyword">with</span> `$watch`:</div></pre></td></tr></table></figure></p>
<p>// No<br>$scope.$watch(‘something’, function () {<br>    if ($scope.something === some state) {<br>        changeTheValueOf($scope.somethingElse);<br>    }<br>});</p>
<div ng-if="somethingElse"></div>

<p>// Yes (this is a one-way digest)<br>$scope.isSomethingElse = function () {<br>    return $scope.something === some state;<br>};</p>
<div ng-if="isSomethingElse()"></div>

<p>// No<br>$scope.$watch(‘something’, function () {<br>    $scope.somethingElse = foo($scope…);<br>});</p>
<p>// Yes</p>
<p><input ng-model="something" ng-change="doFoo()">&lt;…&gt;<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">### `ng-bind` just once</span></div><div class="line"></div><div class="line">[<span class="string">`::` mean "once" in AngularJS 1.3 and up.</span>][<span class="symbol">21</span>]</div><div class="line">[<span class="string">`ng-bind` is twice as fast as &amp;#123;&amp;#123;` expression `&#125;&#125;</span>][<span class="symbol">22</span>]. Use <span class="code">`ng-bind`</span> instead.</div></pre></td></tr></table></figure></p>
<!-- Do -->
<p><div ng-bind="::item"></div><br><!-- Don't --></p>
<p><div>&#123;&#123; ::item }}</div><br><!-- Do --></p>
<p><div ng-repeat="item in ::items" ng-bind="item"></div><br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">### Place methods in the smallest possible "scope"</span></div><div class="line"></div><div class="line">Don't make "global" controller methods. They are both slow and hard to destroy.</div><div class="line"></div><div class="line"><span class="section">### Disable debugging</span></div><div class="line"></div><div class="line">[<span class="string">A common mistake that slows down the app.</span>][<span class="symbol">23</span>]</div></pre></td></tr></table></figure></p>
<p>$compileProvider.debugInfoEnabled(false);<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="section">### Avoid `$log`</span></div><div class="line"></div><div class="line">You may notice that, even if you set <span class="code">`debugInfoEnabled(false)`</span>, that <span class="code">`adb logcat`</span> still contains warnings and errors. Actual errors are cool and all, but [<span class="string">if you log an object, it cannot be garbage-collected</span>][<span class="symbol">24</span>]. For this reason, avoid <span class="code">`$log`</span>ging objects, or better, avoid logging useless things.</div><div class="line"></div><div class="line"><span class="section">## Underscore vs Lodash</span></div><div class="line"></div><div class="line">Lodash is a larger, yet [<span class="string">faster</span>][<span class="symbol">20</span>] fork of underscore. So, for faster code, use lodash.</div><div class="line"></div><div class="line"><span class="section">### `[].forEach` vs `_.each([])` vs `angular.forEach([])`</span></div><div class="line"></div><div class="line">You may find that [<span class="string">`[</span>].forEach<span class="code">` exists][18]. If you have no regard for browser compatibility, you may use it. Otherwise, `</span>_.each` is faster than the other two, [<span class="string">with caveats</span>][<span class="symbol">19</span>].</div><div class="line"></div><div class="line"><span class="section">### [Lazy evaluation][20]</span></div><div class="line"></div><div class="line">Using lodash in a functional manner allows certain <span class="code">`map`</span> and <span class="code">`filter`</span> operations to be lazy-evaluated. It has some performance benefits when there is a <span class="code">`take()`</span> involved.</div></pre></td></tr></table></figure></p>
<p>_(phoneNumbers).map(String).filter(contains55).take(100);  // Do</p>
<p>// Don’t<br><em>.take(</em>.each(phoneNumbers, function (phoneNumber) {<br>    if (contains55(phoneNumber)) {<br>        return String(phoneNumber);<br>    }<br>}), 100);<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># Profiling</span></div><div class="line"></div><div class="line">Left <span class="keyword">for</span> another <span class="built_in">post</span>.</div><div class="line"></div><div class="line"><span class="comment">## Debuggers</span></div><div class="line"></div><div class="line"><span class="comment">### Don't leave in `debugger`, not even once</span></div><div class="line"></div><div class="line">If you leave <span class="keyword">in</span> `debugger;` somewhere <span class="keyword">in</span> <span class="keyword">the</span> <span class="function"><span class="keyword">function</span>, <span class="title">even</span> <span class="title">like</span> <span class="title">this</span>:</span></div></pre></td></tr></table></figure></p>
<p>if (false) {<br>    debugger;<br>}<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Then [<span class="string">V8 will not optimise the entire function</span>][<span class="symbol">14</span>].</div><div class="line"></div><div class="line"><span class="section"># Answers</span></div><div class="line"></div><div class="line"><span class="section">## Quiz 1</span></div><div class="line"></div><div class="line">You can't</div><div class="line"></div><div class="line"><span class="section">## Quiz 2</span></div><div class="line"></div><div class="line"><span class="code">`var foo4 = function foo3() &#123;&#125;`</span> generates <span class="code">`foo3`</span> and <span class="code">`foo4`</span> that are both the same function, or in the case of IE (8 and under?), [<span class="string">two copies of the function</span>][<span class="symbol">7</span>] (<span class="code">`foo3 !== foo4`</span>). </div><div class="line"></div><div class="line"><span class="section">## Quiz 3</span></div></pre></td></tr></table></figure></p>
<p>var foo;<br>foo = function () {};<br>```</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/">JavaScript</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Tuning-Android-IO-Schedulers" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Tuning-Android-IO-Schedulers/" class="article-date">
  <time datetime="2016-06-10T14:52:25.000Z" itemprop="datePublished">2016-06-10</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Tuning-Android-IO-Schedulers/">Tuning Android IO Schedulers</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>If <a href="http://appleinsider.com/articles/13/06/18/googles-nexus-7-tablets-dying-early-possibly-due-to-cheap-memory" target="_blank" rel="external">for whatever reason</a> you feel like you should tune your Android device’s IO scheduler, despite it <a href="http://betanews.com/2014/11/21/android-5-0-lollipop-encryption-severely-impacts-performance/" target="_blank" rel="external">rarely lags</a>, then <a href="http://cromwell-intl.com/linux/performance-tuning/disks.html" target="_blank" rel="external">this guide</a> is for you. Otherwise, the cheatsheet below might be more appropriate.</p>
<p>This post does not apply to you and/or your device.</p>
<h1 id="First-choice-ROW"><a href="#First-choice-ROW" class="headerlink" title="First choice: ROW"></a>First choice: <a href="http://forum.xda-developers.com/showthread.php?t=1558153" target="_blank" rel="external">ROW</a></h1><blockquote>
<p>ROW stands for “READ Over WRITE” which is the main requests dispatch policy of this algorithm. The ROW IO scheduler was developed with the mobile devices needs in mind. In mobile devices we favor user experience upon everything else,thus we want to give READ IO requests as much priority as possible. (…)</p>
</blockquote>
<p>I have never had a problem with ROW. If you don’t have ROW available from the kernel, maybe…</p>
<h1 id="Second-choice-Deadline"><a href="#Second-choice-Deadline" class="headerlink" title="Second choice: Deadline"></a>Second choice: <a href="http://cromwell-intl.com/linux/performance-tuning/disks.html" target="_blank" rel="external">Deadline</a></h1><p>With separate read and write <a href="https://en.wikipedia.org/wiki/Priority_queue" target="_blank" rel="external">priority queues</a>, Deadline also gives read a higher priority. You might need to tune the behaviour to favour read even more, however.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attr">fifo_batch</span> = <span class="number">2</span></div><div class="line"><span class="attr">front_merges</span> = <span class="number">1</span></div><div class="line"><span class="attr">read_expire</span> = <span class="number">100</span></div><div class="line"><span class="attr">write_expire</span> = <span class="number">5000</span></div><div class="line"><span class="attr">writes_starved</span> = <span class="number">10</span></div></pre></td></tr></table></figure>
<h1 id="Default-Last-resort-CFQ"><a href="#Default-Last-resort-CFQ" class="headerlink" title="Default / Last resort: CFQ"></a>Default / Last resort: CFQ</h1><p>Processes can have an IO priority. The scheduler is a bit more for rotating disks than it is for solid state memory.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">fifo_expire_async</span> = <span class="number">100</span></div><div class="line"><span class="attr">fifo_expire_sync</span> = <span class="number">100</span></div><div class="line"><span class="attr">slice_idle</span> = <span class="number">0</span></div></pre></td></tr></table></figure>
<h1 id="Last-resort-NOOP"><a href="#Last-resort-NOOP" class="headerlink" title="Last resort: NOOP"></a>Last resort: NOOP</h1><p>Leaves it to the IO controller. It might be beneficial to encrypted devices, but I personally see more lags here and there.</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Android/">Android</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-So-you-want-to-use-the-exclamation-mark" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/So-you-want-to-use-the-exclamation-mark/" class="article-date">
  <time datetime="2016-06-08T23:00:52.000Z" itemprop="datePublished">2016-06-08</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/So-you-want-to-use-the-exclamation-mark/">So You Want to Use the Exclamation Mark</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<blockquote>
<p><a href="http://ggsymbols.weebly.com/about-fitzgerald.html" target="_blank" rel="external">“Cut out all these exclamation points. An exclamation point is like laughing at your own joke.”</a> - F. Scott Fitzgerald</p>
</blockquote>
<p>There is absolutely no place for the exclamation mark, except if you are quoting someone else. These uses of the exclamation mark are expressly prohibited:</p>
<ul>
<li>You are quoting yourself.</li>
<li>You are composing a sentence.</li>
<li><a href="https://www.reddit.com/r/pics/comments/4n6n51/the_ingredient_list_on_this_rosewater_is_the/d41fkc4" target="_blank" rel="external">You are exclaiming yourself.</a></li>
<li>You are generating strings for an app.</li>
<li>You are trying to be friendly by yelling everything.</li>
<li>You are trying to make a point by yelling everything.</li>
</ul>
<p>In conclusion, please make sure you never use the exclamation mark for any reason. There are no exceptions!</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Literature/">Literature</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Utilising-Android-system-memory-with-minfree-controls" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Utilising-Android-system-memory-with-minfree-controls/" class="article-date">
  <time datetime="2016-06-07T14:36:17.000Z" itemprop="datePublished">2016-06-07</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Utilising-Android-system-memory-with-minfree-controls/">Utilising Android System Memory With Sysctl and Minfree</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<h2 id="Article-Pre-requisites"><a href="#Article-Pre-requisites" class="headerlink" title="Article Pre-requisites"></a>Article Pre-requisites</h2><ul>
<li>A rooted device with debug enabled</li>
<li>Linux knowledge</li>
<li>ADB server</li>
<li>Read/write permissions on <code>/</code></li>
<li>A working recovery partition</li>
</ul>
<h2 id="What’s-happening"><a href="#What’s-happening" class="headerlink" title="What’s happening?"></a>What’s happening?</h2><p>If you have a mid-range Android device (hereafter referred to as a “phone”, whether or not yours is a phone), chances are that you have opened one app, opened another app, then switched back to the first app, just to see that the first app had been killed, and <a href="https://www.reddit.com/r/MotoG/comments/2tfh49/multitasking_and_minfree_settings_on_lollipop_vs/" target="_blank" rel="external">you had to start it again</a>. “Oh,” you thought to yourself, “maybe my phone is just old. Maybe it is running out of memory,” but you would (often) be wrong. To see for yourself (on a moderately recent build of Android), go to Settings &gt; Memory, and you will see a memory bar chart that is <em>never</em> full:</p>
<p><img src="/image/Screenshot_20160607-104123.png" alt="Memory usage"></p>
<h2 id="Tuning-Sysctl"><a href="#Tuning-Sysctl" class="headerlink" title="Tuning Sysctl"></a>Tuning Sysctl</h2><p>Internally, Android uses Linux (often with kernel versions below 4.x), which comes with a tool that helps you control its behaviour, including how it uses its memory. For Android, <a href="http://www.imoseyon.com/2011/01/sysctl-tweaking-for-faster-longer.html" target="_blank" rel="external">some of the relevant parameters</a> include:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vm<span class="selector-class">.dirty_ratio</span> = <span class="number">90</span></div><div class="line">vm<span class="selector-class">.dirty_background_ratio</span> = <span class="number">70</span></div><div class="line">vm<span class="selector-class">.vfs_cache_pressure</span> = <span class="number">1</span></div><div class="line">vm<span class="selector-class">.dirty_writeback_centisecs</span> = <span class="number">500</span></div><div class="line">vm<span class="selector-class">.dirty_expire_centisecs</span> = <span class="number">3000</span></div><div class="line">vm<span class="selector-class">.swappiness</span> = <span class="number">0</span></div></pre></td></tr></table></figure>
<p>See also: <a href="https://lonesysadmin.net/2013/12/22/better-linux-disk-caching-performance-vm-dirty_ratio/" target="_blank" rel="external">Linux-specific parameters</a> and <a href="https://www.kernel.org/doc/Documentation/sysctl/vm.txt" target="_blank" rel="external">Official documentation</a>. This article might also benefit ordinary Linux users.</p>
<p>Depending on the specifications of your device, I have several parameters I might personally use:</p>
<h3 id="High-end-16GB-of-memory-or-more-no-recent-crashes-or-reboots"><a href="#High-end-16GB-of-memory-or-more-no-recent-crashes-or-reboots" class="headerlink" title="High end (16GB of memory or more, no recent crashes or reboots)"></a>High end (16GB of memory or more, no recent crashes or reboots)</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">vm</span>.dirty_background_ratio = <span class="number">10</span>  # Start writing data asynchronously when this percentage <span class="keyword">is</span> used <span class="keyword">for</span> caching.</div><div class="line"><span class="keyword">vm</span>.dirty_ratio = <span class="number">90</span>  # Start writing synchronously when this percentage <span class="keyword">is</span> used <span class="keyword">for</span> caching.</div><div class="line"><span class="keyword">vm</span>.vfs_cache_pressure = <span class="number">1</span>  # Keep directory <span class="built_in">and</span> inode caches almost indefinitely.</div><div class="line"><span class="keyword">vm</span>.dirty_writeback_centisecs = <span class="number">50000</span>  # <span class="number">0</span> will disable periodic writeback altogether.</div><div class="line"><span class="keyword">vm</span>.dirty_expire_centisecs = <span class="number">3000</span>  # Data which <span class="built_in">has</span> been dirty in-memory <span class="keyword">for</span> longer than this interval will <span class="keyword">be</span> written out <span class="keyword">next</span> time <span class="keyword">a</span> flusher thread wakes <span class="keyword">up</span>.</div><div class="line"><span class="keyword">vm</span>.swappiness = <span class="number">0</span>  # Not relevant <span class="keyword">to</span> swap-less devices, which includes most phones</div></pre></td></tr></table></figure>
<p>Note! Setting <code>dirty_*centisecs</code> too high for your system will cause it to freeze.</p>
<h3 id="Mid-range-2GB-of-memory-or-more"><a href="#Mid-range-2GB-of-memory-or-more" class="headerlink" title="Mid range (2GB of memory or more)"></a>Mid range (2GB of memory or more)</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vm<span class="selector-class">.dirty_background_ratio</span> = <span class="number">5</span></div><div class="line">vm<span class="selector-class">.dirty_ratio</span> = <span class="number">10</span></div><div class="line">vm<span class="selector-class">.vfs_cache_pressure</span> = <span class="number">50</span></div><div class="line">vm<span class="selector-class">.dirty_writeback_centisecs</span> = <span class="number">1000</span></div><div class="line">vm<span class="selector-class">.dirty_expire_centisecs</span> = <span class="number">1000</span></div><div class="line">vm<span class="selector-class">.swappiness</span> = <span class="number">0</span></div></pre></td></tr></table></figure>
<h3 id="Low-end-1GB-of-memory-or-more"><a href="#Low-end-1GB-of-memory-or-more" class="headerlink" title="Low end (1GB of memory or more)"></a>Low end (1GB of memory or more)</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vm<span class="selector-class">.dirty_background_ratio</span> = <span class="number">5</span></div><div class="line">vm<span class="selector-class">.dirty_ratio</span> = <span class="number">5</span></div><div class="line">vm<span class="selector-class">.vfs_cache_pressure</span> = <span class="number">150</span></div><div class="line">vm<span class="selector-class">.dirty_writeback_centisecs</span> = <span class="number">1000</span></div><div class="line">vm<span class="selector-class">.dirty_expire_centisecs</span> = <span class="number">1000</span></div><div class="line">vm<span class="selector-class">.swappiness</span> = <span class="number">0</span></div></pre></td></tr></table></figure>
<h3 id="FAQ-Doesn’t-this-prevent-Android-from-maximising-app-caching"><a href="#FAQ-Doesn’t-this-prevent-Android-from-maximising-app-caching" class="headerlink" title="FAQ: Doesn’t this prevent Android from maximising app caching?"></a>FAQ: Doesn’t this prevent Android from maximising app caching?</h3><p>Maybe, but your phone is running on flash memory, so saving memory to cache the (stopped) apps themselves are not that useful.</p>
<h3 id="FAQ-Should-I-disable-my-ZRAM-compcache"><a href="#FAQ-Should-I-disable-my-ZRAM-compcache" class="headerlink" title="FAQ: Should I disable my ZRAM (compcache)?"></a>FAQ: Should I disable my ZRAM (compcache)?</h3><p><a href="https://code.google.com/archive/p/compcache/" target="_blank" rel="external">Compcache</a> compresses memory using additional CPU power. If your phone falls within the “high end” group, you can get an unnoticeable increase in battery life by disabling compcache.</p>
<p>To check if your phone supports compcache in the first place, run this in <code>adb shell</code>:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">compcache</span></div></pre></td></tr></table></figure>
<p>Then, if the command succeeds, <a href="https://code.google.com/archive/p/compcache/" target="_blank" rel="external">the documentation</a> says you may stop compcache with:</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compcache <span class="built_in">stop</span></div></pre></td></tr></table></figure>
<h2 id="Tuning-Minfree-LMK"><a href="#Tuning-Minfree-LMK" class="headerlink" title="Tuning Minfree/LMK"></a>Tuning Minfree/LMK</h2><p><a href="http://www.androidcentral.com/fine-tuning-minfree-settings-improving-androids-multi-tasking" target="_blank" rel="external">Minfree</a> is Android’s own implementation of user-level memory management, on top of the kernel’s kernel-level memory management. It is also known as the LowMemoryKiller (LMK). It is responsible for the apps being killed in a timely manner. The parameters are as follows:</p>
<ul>
<li>FOREGROUND_APP: The active app</li>
<li>VISIBLE_APP: Usually an app that is not the active one, but still visible (e.g. with an active notification, or <a href="https://play.google.com/store/apps/details?id=com.easytouch.assistivetouch&amp;hl=en" target="_blank" rel="external">some overlay thing</a> you are running)</li>
<li>SECONDARY_SERVER: Like your launcher.</li>
<li>HIDDEN_APP: Idle apps.</li>
<li>CONTENT_PROVIDER: Services that provide content, e.g. contacts and calendar services.</li>
<li>EMPTY_APP: Apps not doing any work.</li>
</ul>
<p>Often, your phone ships with ridiculously high values like these:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">18432</span>, <span class="number">23040</span>, <span class="number">27648</span>, <span class="number">32256</span>, <span class="number">56250</span>, <span class="number">81250</span></div></pre></td></tr></table></figure>
<p>(Divide each number by 256 to get the number of MB for each category)</p>
<p>The values above tell Android to start killing apps when there are 318MB of free memory, and kill visible apps when there are 90MB left. This causes the regular “my app is killed” problem. They are set so high because it is nicer for the manufacturer to kill the apps for the user, than it is to have them reboot their devices when an OOM (out of memory) event occurs. Higher minfree values also allow manufacturers to report (slightly) higher battery life when tests are conducted in a laboratory setting.</p>
<p>To change these values to more reasonable ones, type this into the device’s rooted shell:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo <span class="string">"1536,2048,4096,5120,15360,23040"</span> &gt; <span class="regexp">/sys/m</span>odule<span class="regexp">/lowmemorykiller/</span>parameters<span class="regexp">/minfree</span></div></pre></td></tr></table></figure>
<p>Progressively lower values will work better for higher end phones.</p>
<h3 id="FAQ-Does-keeping-apps-in-memory-increase-battery-usage"><a href="#FAQ-Does-keeping-apps-in-memory-increase-battery-usage" class="headerlink" title="FAQ: Does keeping apps in memory increase battery usage?"></a>FAQ: Does keeping apps in memory increase battery usage?</h3><p>Yes. Any app kept running, even in the background, will cost CPU cycles. Be careful what you wish for. Consider using <a href="https://play.google.com/store/apps/details?id=com.oasisfeng.greenify&amp;hl=en" target="_blank" rel="external">Greenify</a> to make sure certain apps (Facebook, I am looking at you) never run in the background.<br>On the plus side, if you don’t use your phone a lot, this makes your user experience vastly better. </p>
<h3 id="FAQ-Should-I-wipe-my-apps-out-of-the-recent-apps-screen"><a href="#FAQ-Should-I-wipe-my-apps-out-of-the-recent-apps-screen" class="headerlink" title="FAQ: Should I wipe my apps out of the recent apps screen?"></a>FAQ: Should I wipe my apps out of the recent apps screen?</h3><p>Keeping them there will not hurt.</p>
<h3 id="FAQ-Will-tuning-my-memory-impact-my-read-write-speed"><a href="#FAQ-Will-tuning-my-memory-impact-my-read-write-speed" class="headerlink" title="FAQ: Will tuning my memory impact my read/write speed?"></a>FAQ: Will tuning my memory impact my read/write speed?</h3><p>Yes. Occasionally, there may be a positive effect.</p>
<h2 id="Tuning-background-apps-limit-Oneplus-3-Only"><a href="#Tuning-background-apps-limit-Oneplus-3-Only" class="headerlink" title="Tuning background apps limit (Oneplus 3 Only)"></a>Tuning background apps limit (Oneplus 3 Only)</h2><p><a href="http://www.xda-developers.com/how-to-fix-the-oneplus-3s-memory-management-almost-double-the-apps-in-memory/" target="_blank" rel="external">An article</a> claims that, by editing <code>ro.sys.fw.bg_apps_limit</code> in the device’s <code>build.prop</code> file from 20 to 40, more apps will be kept in memory for longer.</p>
<h2 id="Setting-values-permanently"><a href="#Setting-values-permanently" class="headerlink" title="Setting values permanently"></a>Setting values permanently</h2><p>Knowing minfree values are reset on reboot (sometimes reset immediately after setting, as well), you might want to apply the values every reboot. You have three choices:</p>
<ol>
<li>Use a kernel manager to set values for you on reboot. Some good ones: <a href="https://play.google.com/store/apps/details?id=com.bigeyes0x0.trickstermod&amp;hl=en" target="_blank" rel="external">Trickster MOD</a>, <a href="https://play.google.com/store/apps/details?id=com.grarak.kerneladiutor&amp;hl=en" target="_blank" rel="external">Kernel Adiutor</a>, <a href="https://play.google.com/store/apps/details?id=com.af.synapse&amp;hl=en" target="_blank" rel="external">Synapse</a>,</li>
<li>Create an executable <code>/etc/init.d/123_script_file</code> to apply the values for you, or</li>
<li>Flash the <a href="http://forum.xda-developers.com/showthread.php?t=991276" target="_blank" rel="external">V6 SuperCharger Script</a> through the device’s recovery.</li>
</ol>
<h3 id="FAQ-Should-I-download-a-memory-booster"><a href="#FAQ-Should-I-download-a-memory-booster" class="headerlink" title="FAQ: Should I download a memory booster?"></a>FAQ: Should I download a memory booster?</h3><p><a href="http://www.makeuseof.com/tag/ram-boosters-task-killers-bad-android/" target="_blank" rel="external">No.</a></p>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><p>Contrary to your original intention, adjusting memory parameters incorrectly can lead to a slower device. If you do mess up, see if flushing the filesystem cache restores performance:</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># <span class="keyword">If</span> this improves performance immediately, your vm.vfs_cache_pressure is <span class="keyword">set</span> too <span class="comment">low for your device.</span></div><div class="line">echo <span class="comment">3</span> |<span class="comment"> tee</span> /proc/<span class="comment">sys</span>/vm/<span class="comment">drop_caches</span></div></pre></td></tr></table></figure>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Android/">Android</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
    <article id="post-Cheapest-booze-from-LCBO" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2016/Cheapest-booze-from-LCBO/" class="article-date">
  <time datetime="2016-05-13T23:59:41.000Z" itemprop="datePublished">2016-05-13</time>
</a>
		</span>
		<span class="meta-elements author">Brian</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 itemprop="name" class="entry-title">
      <a class="article-title" href="/2016/Cheapest-booze-from-LCBO/">Cheapest Booze From LCBO</a>
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p><strong>tl;dr</strong>: Buy sherry.</p>
<p>Sure, sure, LCBO rips you off. Sure, sure, dangers of alcohol consumption. But, for the poor and desperate, the quest for the cheapest booze must continue. But what if you are already drunk, and cannot do the maths? This is the post for you.</p>
<h2 id="Sourcing"><a href="#Sourcing" class="headerlink" title="Sourcing"></a>Sourcing</h2><p>Back in 2013, it was possible to search for <code>*</code> on lcbo.com, and have it throw up an entire database worth of data. Data mining was easy. All you needed was a web browser and some script. Such a scraping effort was recorded <a href="https://gist.github.com/1337/6190299/cd04e29988a4ca78f4e682e7f38dece56e310e23" target="_blank" rel="external">in the form of a JSON file</a>.</p>
<p>It was good while it lasted. Today, you can no longer search for <code>*</code> and get something reasonable. You will need <a href="https://lcboapi.com/" target="_blank" rel="external">an API</a> for that.<br>Thankfully, the unofficial LCBO API, for whatever reason, allows me to paginate through their entire database. Here is my sloppy code:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">page = <span class="number">1</span></div><div class="line">next_page_path = <span class="string">'/products?per_page=100&amp;page=&#123;&#125;&amp;where_not=is_dead,is_discontinued'</span>.format(page)</div><div class="line"><span class="keyword">while</span> True:</div><div class="line">    resp = requests.<span class="keyword">get</span>(<span class="string">'https://lcboapi.com&#123;&#125;'</span>.format(next_page_path),</div><div class="line">                        headers=&#123;</div><div class="line">                            <span class="string">'Authorization'</span>: <span class="string">'Token (get your own token)'</span></div><div class="line">                        &#125;)</div><div class="line">    <span class="keyword">data</span> = resp.json()</div><div class="line">    print(<span class="keyword">data</span>)</div><div class="line"></div><div class="line">    with <span class="keyword">open</span>(<span class="string">'lcbo-2016.json'</span>, <span class="string">'a+'</span>) <span class="keyword">as</span> f:</div><div class="line">        f.writelines(json.dumps(<span class="keyword">data</span>[<span class="string">'result'</span>], indent=<span class="number">4</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">data</span>[<span class="string">'pager'</span>][<span class="string">'next_page_path'</span>]:</div><div class="line">        next_page_path = <span class="keyword">data</span>[<span class="string">'pager'</span>][<span class="string">'next_page_path'</span>]</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">break</span></div></pre></td></tr></table></figure>
<p>Once you manage to run it, you will end up with a <code>lcbo-2016.json</code>, full of raw entries like this one:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"origin"</span>: <span class="string">"Canada, Ontario"</span>,</div><div class="line">    <span class="attr">"is_ocb"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"package_unit_type"</span>: <span class="string">"bottle"</span>,</div><div class="line">    <span class="attr">"secondary_category"</span>: <span class="string">"Lager"</span>,</div><div class="line">    <span class="attr">"serving_suggestion"</span>: <span class="string">"Party fare"</span>,</div><div class="line">    <span class="attr">"updated_at"</span>: <span class="string">"2016-05-13T14:28:22.216Z"</span>,</div><div class="line">    <span class="attr">"price_in_cents"</span>: <span class="number">3950</span>,</div><div class="line">    <span class="attr">"sugar_content"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"stock_type"</span>: <span class="string">"LCBO"</span>,</div><div class="line">    <span class="attr">"inventory_volume_in_milliliters"</span>: <span class="number">613800</span>,</div><div class="line">    <span class="attr">"sugar_in_grams_per_liter"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"inventory_count"</span>: <span class="number">75</span>,</div><div class="line">    <span class="attr">"producer_name"</span>: <span class="string">"Labatt Breweries Ontario"</span>,</div><div class="line">    <span class="attr">"is_vqa"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"primary_category"</span>: <span class="string">"Beer"</span>,</div><div class="line">    <span class="attr">"price_per_liter_of_alcohol_in_cents"</span>: <span class="number">965</span>,</div><div class="line">    <span class="attr">"style"</span>: <span class="string">"Light &amp; Malty"</span>,</div><div class="line">    <span class="attr">"has_bonus_reward_miles"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"is_discontinued"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"is_dead"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"package_unit_volume_in_milliliters"</span>: <span class="number">341</span>,</div><div class="line">    <span class="attr">"id"</span>: <span class="number">914028</span>,</div><div class="line">    <span class="attr">"inventory_price_in_cents"</span>: <span class="number">296250</span>,</div><div class="line">    <span class="attr">"total_package_units"</span>: <span class="number">24</span>,</div><div class="line">    <span class="attr">"volume_in_milliliters"</span>: <span class="number">8184</span>,</div><div class="line">    <span class="attr">"limited_time_offer_ends_on"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"product_no"</span>: <span class="number">914028</span>,</div><div class="line">    <span class="attr">"value_added_promotion_description"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"image_thumb_url"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"bonus_reward_miles"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"description"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"tags"</span>: <span class="string">"labatt genuine draft beer lager canada ontario breweries bottle"</span>,</div><div class="line">    <span class="attr">"tertiary_category"</span>: <span class="string">"pale lager"</span>,</div><div class="line">    <span class="attr">"tasting_note"</span>: <span class="string">"Pale amber; cooked cereal, light hop aroma; light, crisp flavour."</span>,</div><div class="line">    <span class="attr">"varietal"</span>: <span class="string">"North American Lager"</span>,</div><div class="line">    <span class="attr">"price_per_liter_in_cents"</span>: <span class="number">482</span>,</div><div class="line">    <span class="attr">"is_kosher"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"bonus_reward_miles_ends_on"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"clearance_sale_savings_in_cents"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"alcohol_content"</span>: <span class="number">500</span>,</div><div class="line">    <span class="attr">"released_on"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"has_clearance_sale"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Labatt Genuine Draft"</span>,</div><div class="line">    <span class="attr">"has_value_added_promotion"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"package"</span>: <span class="string">"24x341 mL bottle"</span>,</div><div class="line">    <span class="attr">"has_limited_time_offer"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"regular_price_in_cents"</span>: <span class="number">3950</span>,</div><div class="line">    <span class="attr">"image_url"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">"is_seasonal"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"limited_time_offer_savings_in_cents"</span>: <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Too much information. No one needs that.</p>
<h2 id="Extraction"><a href="#Extraction" class="headerlink" title="Extraction"></a>Extraction</h2><p>Since you are only interested in the products that are the best bang for the buck, you feed that raw JSON into a filter:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">replacements = []</div><div class="line">entries = json.load(open(<span class="symbol">'lcbo</span>-<span class="number">2016</span>.json', <span class="string">'r'</span>))</div><div class="line"><span class="keyword">for</span> <span class="keyword">entry</span> <span class="keyword">in</span> entries:</div><div class="line">    try:</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">entry</span>[<span class="symbol">'regular_price_in_cents</span>']:</div><div class="line">            continue</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">entry</span>[<span class="symbol">'volume_in_milliliters</span>']:</div><div class="line">            continue</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">entry</span>[<span class="symbol">'alcohol_content</span>']:</div><div class="line">            continue</div><div class="line">        replacements.append(&#123;</div><div class="line">            <span class="symbol">'id</span>': <span class="keyword">entry</span>[<span class="symbol">'id</span>'],</div><div class="line">            <span class="symbol">'name</span>': <span class="keyword">entry</span>[<span class="symbol">'name</span>'],</div><div class="line">            <span class="symbol">'package</span>': <span class="keyword">entry</span>[<span class="symbol">'package</span>'],</div><div class="line">            <span class="symbol">'primary_category</span>': <span class="keyword">entry</span>[<span class="symbol">'primary_category</span>'],</div><div class="line">            <span class="symbol">'regular_price</span>': <span class="keyword">entry</span>[<span class="symbol">'regular_price_in_cents</span>'] / <span class="number">100.0</span>,</div><div class="line">            <span class="symbol">'alcohol_content</span>': <span class="keyword">entry</span>[<span class="symbol">'alcohol_content</span>'] / <span class="number">100.0</span>,</div><div class="line">            <span class="symbol">'volume</span>': <span class="keyword">entry</span>[<span class="symbol">'volume_in_milliliters</span>'],</div><div class="line">        &#125;)</div><div class="line">    except KeyError:</div><div class="line">        continue</div><div class="line"></div><div class="line"><span class="keyword">with</span> open(<span class="symbol">'lcbo</span>-<span class="number">2016</span>-<span class="keyword">new</span>.json', <span class="string">'w'</span>) as f:</div><div class="line">    sorted_replacements = sorted(replacements, key=lambda <span class="keyword">entry</span>: (<span class="keyword">entry</span>[<span class="symbol">'regular_price</span>'] <span class="keyword">or</span> <span class="number">100</span>) / (<span class="keyword">entry</span>[<span class="symbol">'volume</span>'] <span class="keyword">or</span> <span class="number">1</span>) / (<span class="keyword">entry</span>[<span class="symbol">'alcohol_content</span>'] <span class="keyword">or</span> <span class="number">1</span>))</div><div class="line">    json.dump(sorted_replacements[:<span class="number">1000</span>], f, indent=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>The entries are now sorted by ‘the most bang for the buck’, i.e. (price / volume / alcohol %). It looks like this:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"Kelly's"</span>,</div><div class="line">        <span class="attr">"regular_price"</span>: <span class="number">9.44</span>,</div><div class="line">        <span class="attr">"package"</span>: <span class="string">"1000 mL bottle"</span>,</div><div class="line">        <span class="attr">"id"</span>: <span class="number">113332</span>,</div><div class="line">        <span class="attr">"volume"</span>: <span class="number">1000</span>,</div><div class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</div><div class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"Andr\u00e8s Fine Old Apera"</span>,</div><div class="line">        <span class="attr">"regular_price"</span>: <span class="number">7.45</span>,</div><div class="line">        <span class="attr">"package"</span>: <span class="string">"750 mL bottle"</span>,</div><div class="line">        <span class="attr">"id"</span>: <span class="number">19265</span>,</div><div class="line">        <span class="attr">"volume"</span>: <span class="number">750</span>,</div><div class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</div><div class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"Imperial Apera"</span>,</div><div class="line">        <span class="attr">"regular_price"</span>: <span class="number">7.95</span>,</div><div class="line">        <span class="attr">"package"</span>: <span class="string">"750 mL bottle"</span>,</div><div class="line">        <span class="attr">"id"</span>: <span class="number">69351</span>,</div><div class="line">        <span class="attr">"volume"</span>: <span class="number">750</span>,</div><div class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</div><div class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"Brights Pale Dry Select"</span>,</div><div class="line">        <span class="attr">"regular_price"</span>: <span class="number">7.95</span>,</div><div class="line">        <span class="attr">"package"</span>: <span class="string">"750 mL bottle"</span>,</div><div class="line">        <span class="attr">"id"</span>: <span class="number">111476</span>,</div><div class="line">        <span class="attr">"volume"</span>: <span class="number">750</span>,</div><div class="line">        <span class="attr">"alcohol_content"</span>: <span class="number">20.0</span>,</div><div class="line">        <span class="attr">"primary_category"</span>: <span class="string">"Wine"</span></div><div class="line">    &#125;,</div><div class="line">    ...</div><div class="line">]</div></pre></td></tr></table></figure>
<p>Looking good. From what we can see here, Kelly’s (whatever it is) is the cheapest offering by LCBO.</p>
<h2 id="The-Winners"><a href="#The-Winners" class="headerlink" title="The Winners"></a>The Winners</h2><p>For the record, here is a list of the province’s cheapest offerings by alcohol content.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>price ($)</th>
<th>alcohol (%)</th>
<th>volume (mL)</th>
</tr>
</thead>
<tbody>
<tr>
<td>113332<br>Kelly’s 1000 mL bottle<br>Wine</td>
<td>9.44</td>
<td>20.0</td>
<td>1000</td>
</tr>
<tr>
<td>19265<br>Andrès Fine Old Apera 750 mL bottle<br>Wine</td>
<td>7.45</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>69351<br>Imperial Apera 750 mL bottle<br>Wine</td>
<td>7.95</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>111476<br>Brights Pale Dry Select 750 mL bottle<br>Wine</td>
<td>7.95</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>19273<br>Brights Cream Apera 750 mL bottle<br>Wine</td>
<td>7.95</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>90860<br>Kittling Ridge Kingsgate Apera 750 mL bottle<br>Wine</td>
<td>8.25</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>5579<br>Andrès Golden Cream Apera 750 mL bottle<br>Wine</td>
<td>7.45</td>
<td>18.0</td>
<td>750</td>
</tr>
<tr>
<td>20248<br>Andrès Almond Cream Apera 750 mL bottle<br>Wine</td>
<td>7.45</td>
<td>18.0</td>
<td>750</td>
</tr>
<tr>
<td>6759<br>Brights 74 Apera 1000 mL bottle<br>Wine</td>
<td>11.95</td>
<td>20.0</td>
<td>1000</td>
</tr>
<tr>
<td>444539<br>Yanghe Daqu 750 mL bottle<br>Spirits</td>
<td>26.95</td>
<td>55.0</td>
<td>750</td>
</tr>
<tr>
<td>4382<br>Brights 74 Tawny 750 mL bottle<br>Wine</td>
<td>8.94</td>
<td>18.0</td>
<td>750</td>
</tr>
<tr>
<td>9530<br>Cartier Private Stock Tawny 750 mL bottle<br>Wine</td>
<td>9.94</td>
<td>20.0</td>
<td>750</td>
</tr>
<tr>
<td>306019<br>Colio Extra Dry White Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>306001<br>Colio Dry White Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>108688<br>Domaine D’Or Red 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>257998<br>Emu Amontillado Medium Dry 750 mL bottle<br>Wine</td>
<td>8.8</td>
<td>17.5</td>
<td>750</td>
</tr>
<tr>
<td>600486<br>Arak Al Shallal 750 mL bottle<br>Spirits</td>
<td>25.3</td>
<td>50.0</td>
<td>750</td>
</tr>
<tr>
<td>123133<br>Ouzo 12 750 mL bottle<br>Spirits</td>
<td>20.45</td>
<td>40.0</td>
<td>750</td>
</tr>
<tr>
<td>37184<br>Fontana Di Papa Castelli Romani 2000 mL bottle<br>Wine</td>
<td>16.45</td>
<td>12.0</td>
<td>2000</td>
</tr>
<tr>
<td>341511<br>Greek Spirit Romios 700 mL bottle<br>Spirits</td>
<td>19.25</td>
<td>40.0</td>
<td>700</td>
</tr>
<tr>
<td>512335<br>Fantini Farnese Montepulciano Dabruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>78840<br>Citra Montepulciano D’Abruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>588988<br>Spinelli Quartana Montepulciano D’Abruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>510008<br>Luxardo Sambuca Dei Cesari 1140 mL bottle<br>Spirits</td>
<td>29.95</td>
<td>38.0</td>
<td>1140</td>
</tr>
<tr>
<td>237792<br>Icebox Long Island Iced Tea 1140 mL bottle<br>Spirits</td>
<td>30.0</td>
<td>38.0</td>
<td>1140</td>
</tr>
<tr>
<td>106179<br>Domaine D’Or White 4000 mL bagnbox<br>Wine</td>
<td>31.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>497032<br>Faxe 10% Extra Strong 500 mL can<br>Beer</td>
<td>3.5</td>
<td>10.0</td>
<td>500</td>
</tr>
<tr>
<td>456202<br>Crest Super Lager 500 mL can<br>Beer</td>
<td>3.5</td>
<td>10.0</td>
<td>500</td>
</tr>
<tr>
<td>40196<br>Luxardo Sambuca Dei Cesari 750 mL bottle<br>Spirits</td>
<td>19.95</td>
<td>38.0</td>
<td>750</td>
</tr>
<tr>
<td>544312<br>Foris Pinot Gris 750 mL bottle<br>Wine</td>
<td>7.35</td>
<td>14.0</td>
<td>750</td>
</tr>
<tr>
<td>35659<br>Bosco Anice 750 mL bottle<br>Spirits</td>
<td>22.1</td>
<td>42.0</td>
<td>750</td>
</tr>
<tr>
<td>184143<br>Boxer Ice 710 mL can<br>Beer</td>
<td>2.75</td>
<td>5.5</td>
<td>710</td>
</tr>
<tr>
<td>224840<br>Colt 45 710 mL can<br>Beer</td>
<td>4.0</td>
<td>8.0</td>
<td>710</td>
</tr>
<tr>
<td>459222<br>Dry Hopped Keg 58000 mL can<br>Beer</td>
<td>306.5</td>
<td>7.5</td>
<td>58000</td>
</tr>
<tr>
<td>321687<br>Schlitz Malt Liquor 946 mL bottle<br>Beer</td>
<td>4.0</td>
<td>6.0</td>
<td>946</td>
</tr>
<tr>
<td>465849<br>Concha Y Toro Frontera Chardonnay 1500 mL bottle<br>Wine</td>
<td>13.85</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>113019<br>Concha Y Toro Frontera Sauvignon Blanc 1500 mL bottle<br>Wine</td>
<td>13.85</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>676783<br>Faxe Strong 500 mL can<br>Beer</td>
<td>2.85</td>
<td>8.0</td>
<td>500</td>
</tr>
<tr>
<td>447466<br>Santa Carolina Cabernet Merlot 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>306472<br>Cono Sur Tocornal Sauvignon Blanc 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>589069<br>French Cross Red Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>80788<br>Hochtaler 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>589028<br>French Cross Blush Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>188292<br>Hochtaler Dry 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.5</td>
<td>4000</td>
</tr>
<tr>
<td>28647<br>Cantine Due Palme Canonico Negroamaro Salento Igp 2000 mL bottle<br>Wine</td>
<td>17.95</td>
<td>12.5</td>
<td>2000</td>
</tr>
<tr>
<td>275099<br>Jackson-Triggs Vidal 4000 mL bagnbox<br>Wine</td>
<td>35.95</td>
<td>12.5</td>
<td>4000</td>
</tr>
<tr>
<td>572891<br>Sola Nero White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>128520<br>L’Epayrie Special Reserve Rouge 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>165308<br>Colio Extra Dry White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>87981<br>Domaine D’Or White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>193821<br>Domaine D’Or Superieur White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>85456<br>Colio Dry White 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>3038<br>Fontana Di Papa Castelli Romani 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>85464<br>Colio Dry Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>87965<br>Domaine D’Or Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>193813<br>Domaine D’Or Superieur Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>572917<br>Sola Nero Red 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>16139<br>Brights 74 Tawny 1000 mL bottle<br>Wine</td>
<td>12.95</td>
<td>18.0</td>
<td>1000</td>
</tr>
<tr>
<td>218891<br>Dos Amigos Tinto Red 3000 mL bottle<br>Wine</td>
<td>25.95</td>
<td>12.0</td>
<td>3000</td>
</tr>
<tr>
<td>315846<br>Wellington Pub Pack 4x473 mL can<br>Beer</td>
<td>10.95</td>
<td>8.0</td>
<td>1892</td>
</tr>
<tr>
<td>217182<br>Pabst Olde English 800 1180 mL bottle<br>Beer</td>
<td>6.75</td>
<td>7.9</td>
<td>1180</td>
</tr>
<tr>
<td>199851<br>Okocim Mocne 500 mL can<br>Beer</td>
<td>2.54</td>
<td>7.0</td>
<td>500</td>
</tr>
<tr>
<td>346247<br>Dab Maibock 500 mL can<br>Beer</td>
<td>2.54</td>
<td>7.0</td>
<td>500</td>
</tr>
<tr>
<td>88815<br>Tatra Beer 500 mL can<br>Beer</td>
<td>2.0</td>
<td>5.5</td>
<td>500</td>
</tr>
<tr>
<td>431239<br>Faxe Premium Lager 500 mL can<br>Beer</td>
<td>2.0</td>
<td>5.5</td>
<td>500</td>
</tr>
<tr>
<td>589051<br>French Cross Dry White 4000 mL bagnbox<br>Wine</td>
<td>34.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>68544<br>Sawmill Creek Dry Red Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>34.95</td>
<td>12.0</td>
<td>4000</td>
</tr>
<tr>
<td>378158<br>Pabst Blue Ribbon 5.9%. 6x473 mL can<br>Beer</td>
<td>12.25</td>
<td>5.9</td>
<td>2838</td>
</tr>
<tr>
<td>253914<br>Martini Dry Vermouth White 1000 mL bottle<br>Wine</td>
<td>13.25</td>
<td>18.0</td>
<td>1000</td>
</tr>
<tr>
<td>160358<br>Donini Merlot 1000 mL bottle<br>Wine</td>
<td>9.94</td>
<td>13.5</td>
<td>1000</td>
</tr>
<tr>
<td>318337<br>Er Qu 500 mL bottle<br>Spirits</td>
<td>18.95</td>
<td>51.4</td>
<td>500</td>
</tr>
<tr>
<td>605709<br>Ramazzotti Sambuca 1140 mL bottle<br>Spirits</td>
<td>31.95</td>
<td>38.0</td>
<td>1140</td>
</tr>
<tr>
<td>280719<br>Gato Negro Cabernet Sauvignon 1500 mL bottle<br>Wine</td>
<td>14.95</td>
<td>13.5</td>
<td>1500</td>
</tr>
<tr>
<td>286187<br>Concha Y Toro Frontera Cabernet Sauvignon 1500 mL bottle<br>Wine</td>
<td>13.85</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>322727<br>Santa Carolina Chardonnay 1500 mL bottle<br>Wine</td>
<td>14.45</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>14878<br>Velletri Le Contrade Red Igp 2000 mL bottle<br>Wine</td>
<td>17.8</td>
<td>12.0</td>
<td>2000</td>
</tr>
<tr>
<td>213900<br>Alpenbitter No. 7 750 mL bottle<br>Spirits</td>
<td>22.25</td>
<td>40.0</td>
<td>750</td>
</tr>
<tr>
<td>540468<br>Lezajsk Beer 500 mL bottle<br>Beer</td>
<td>2.04</td>
<td>5.5</td>
<td>500</td>
</tr>
<tr>
<td>679860<br>Red Bull Beer 710 mL can<br>Beer</td>
<td>3.75</td>
<td>7.1</td>
<td>710</td>
</tr>
<tr>
<td>504340<br>Santa Carolina Merlot 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>226969<br>Pelee Pebbles Vidal Hibernal 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>554527<br>Kourtakis Apelia Agiorgitiko Red Peloponnese Igp 1500 mL bottle<br>Wine</td>
<td>13.95</td>
<td>12.5</td>
<td>1500</td>
</tr>
<tr>
<td>679738<br>James Ready 5.5. 24x341 mL bottle<br>Beer</td>
<td>33.5</td>
<td>5.5</td>
<td>8184</td>
</tr>
<tr>
<td>615112<br>Lakeport Ice 24x341 mL bottle<br>Beer</td>
<td>33.5</td>
<td>5.5</td>
<td>8184</td>
</tr>
<tr>
<td>31971<br>Fantini Farnese Sangiovese IGT 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>79046<br>Citra Trebbiano D’Abruzzo 1500 mL bottle<br>Wine</td>
<td>13.45</td>
<td>12.0</td>
<td>1500</td>
</tr>
<tr>
<td>48140<br>Fontana Di Papa Colli Albani 2000 mL bottle<br>Wine</td>
<td>16.45</td>
<td>11.0</td>
<td>2000</td>
</tr>
<tr>
<td>107193<br>Gray Fox Chardonnay 1500 mL bottle<br>Wine</td>
<td>14.6</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>107201<br>Gray Fox Cabernet Sauvignon 1500 mL bottle<br>Wine</td>
<td>14.6</td>
<td>13.0</td>
<td>1500</td>
</tr>
<tr>
<td>207852<br>L’Ambiance Red 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.0</td>
<td>4000</td>
</tr>
<tr>
<td>207860<br>L’Ambiance White 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.0</td>
<td>4000</td>
</tr>
<tr>
<td>68528<br>Sawmill Creek Autumn Blush Bag in Box 4000 mL bagnbox<br>Wine</td>
<td>32.95</td>
<td>11.0</td>
<td>4000</td>
</tr>
<tr>
<td>363507<br>Prince Igor Extreme Vodka 1750 mL bottle<br>Spirits</td>
<td>59.0</td>
<td>45.0</td>
<td>1750</td>
</tr>
<tr>
<td>248146<br>Laker Ice 15x355 mL can<br>Beer</td>
<td>21.95</td>
<td>5.5</td>
<td>5325</td>
</tr>
<tr>
<td>142620<br>Laker Ice 473 mL can<br>Beer</td>
<td>1.95</td>
<td>5.5</td>
<td>473</td>
</tr>
<tr>
<td>382291<br>Laker Red 473 mL can<br>Beer</td>
<td>1.95</td>
<td>5.5</td>
<td>473</td>
</tr>
<tr>
<td>28951<br>Paarl Cape Ruby 750 mL bottle<br>Wine</td>
<td>9.85</td>
<td>17.5</td>
<td>750</td>
</tr>
<tr>
<td>109017<br>L’Epayrie Blanc 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>11.5</td>
<td>1500</td>
</tr>
<tr>
<td>203646<br>Andrès Sparkling 1500 mL bottle<br>Wine</td>
<td>12.95</td>
<td>11.5</td>
<td>1500</td>
</tr>
<tr>
<td>273268<br>Spirytus Gdanski 76% 700 mL bottle<br>Spirits</td>
<td>39.95</td>
<td>76.0</td>
<td>700</td>
</tr>
<tr>
<td>280644<br>Carlo Rossi California Red 3000 mL bottle<br>Wine</td>
<td>25.95</td>
<td>11.5</td>
<td>3000</td>
</tr>
</tbody>
</table>
<p>Guess what, that is also made with Python. Here is the code:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">with open(<span class="string">'lcbo-2016-new.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> <span class="string">f:</span></div><div class="line">    writer = csv.DictWriter(f, fieldnames=[<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'package'</span>, <span class="string">'primary_category'</span>, <span class="string">'regular_price'</span>, <span class="string">'alcohol_content'</span>, <span class="string">'volume'</span>])</div><div class="line">    writer.writeheader()</div><div class="line">    <span class="keyword">for</span> repl <span class="keyword">in</span> <span class="string">sorted_replacements:</span></div><div class="line">        writer.writerow(repl)</div></pre></td></tr></table></figure>
<p><a href="https://gist.github.com/1337/6190299" target="_blank" rel="external">Click here</a> for the complete dump.</p>
<p>At last, Ontarians need not be ripped off by the LCBO. Or, you know, you can always brew…</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/General/">General</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Python/">Python</a></li></ul>

			</span>
		</div>
	</footer>
	
</article>


	<hr class="article-devider">



  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="../7/">&laquo; Prev</a><a class="page-number" href="../../index.html">1</a><span class="space">&hellip;</span><a class="page-number" href="../6/">6</a><a class="page-number" href="../7/">7</a><span class="page-number current">8</span><a class="page-number" href="../9/">9</a><a class="page-number" href="../10/">10</a><span class="space">&hellip;</span><a class="page-number" href="../15/">15</a><a class="extend next" rel="next" href="../9/">Next &raquo;</a>
    </nav>
  

    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.ohai.ca">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">Brian&#39;s Blog</a>
	</h1>
	<span class="copyright">
		&copy; 2017 Brian<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="../../js/script.js"></script>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    var sc_project=4446854;
    var sc_invisible=0;
    var sc_security="74785e80";
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write(
      "<sc"+"ript type='text/javascript' src='" +
      scJsHost +
      "statcounter.com/counter/counter_xhtml.js'></" +
      "script>"
    );
    //]]>
  </script>
  <noscript>
    <img style="display: none"
         src="http://c.statcounter.com/4446854/0/74785e80/0/" />
  </noscript>
</body>
</html>
